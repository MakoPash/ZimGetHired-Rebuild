
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>ZimGetHired - The fastest way to hire and get hired in Zimbabwe</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='25' fill='%23047857'/><rect y='25' width='100' height='25' fill='%23FCD116'/><rect y='50' width='100' height='25' fill='%23DE2010'/><rect y='75' width='100' height='25' fill='%231f2937'/><text x='50' y='55' font-size='40' font-weight='bold' fill='white' text-anchor='middle'>Z</text></svg>">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.4/dist/umd/supabase.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<style>
* { margin:0; padding:0; box-sizing:border-box; }

:root {
  --emerald: #047857;
  --deep-emerald: #065f46;
  --gold: #D4AF37;
  --charcoal: #1f2937;
  --light-gold: #fef3c7;
  --zim-green: #00843D;
  --zim-yellow: #FCD116;
  --zim-red: #DE2010;
  --glass-bg: rgba(255,255,255,0.88);
  --glass-border: rgba(255,255,255,0.3);
  --shadow-soft: 0 8px 32px rgba(4,120,87,0.12);
  --shadow-hover: 0 12px 40px rgba(4,120,87,0.18);
  --bg-primary: #f9fafb;
  --text-dark: #111827;
  --text-muted: #6b7280;
  --whatsapp-green: #25D366;
}

body {
  font-family: 'Poppins', sans-serif;
  background: linear-gradient(135deg, #f9fafb 0%, #ecfdf5 100%);
  background-attachment: fixed;
  color: var(--text-dark);
  line-height: 1.6;
}

body::before {
  content: '';
  position: fixed;
  top:0; left:0; width:100%; height:100%;
  background-image:
    radial-gradient(circle at 20% 30%, rgba(4,120,87,0.04) 0%, transparent 50%),
    radial-gradient(circle at 80% 70%, rgba(212,175,55,0.04) 0%, transparent 50%);
  pointer-events: none;
  z-index: -1;
}

.container { max-width:1400px; margin:0 auto; padding:0 20px; }

/* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
header {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border-bottom: 1px solid var(--glass-border);
  padding: 14px 0;
  box-shadow: var(--shadow-soft);
  position: sticky;
  top: 0;
  z-index: 100;
}

.header-content {
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-wrap: wrap;
  gap: 20px;
}

.logo {
  font-size: 28px;
  font-weight: 800;
  background: linear-gradient(135deg, var(--emerald) 0%, var(--deep-emerald) 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  letter-spacing: -0.5px;
  cursor: pointer;
}

.logo span {
  background: linear-gradient(135deg, var(--gold) 0%, #b8860b 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.header-right {
  display: flex;
  align-items: center;
  gap: 15px;
  flex-wrap: wrap;
}

.nav-tabs {
  display: flex;
  gap: 12px;
  flex-wrap: wrap;
}

.nav-tab {
  padding: 12px 28px;
  background: white;
  border: 2px solid transparent;
  color: var(--text-dark);
  cursor: pointer;
  border-radius: 50px;
  font-weight: 600;
  font-size: 14px;
  font-family: 'Poppins', sans-serif;
  transition: all 0.4s cubic-bezier(0.4,0,0.2,1);
}

.nav-tab:hover {
  background: var(--emerald);
  color: white;
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(4,120,87,0.3);
}

.nav-tab.active {
  background: linear-gradient(135deg, var(--emerald) 0%, var(--deep-emerald) 100%);
  color: white;
  box-shadow: 0 8px 20px rgba(4,120,87,0.4);
}

.nav-tab.hidden { display: none; }

/* Auth section */
.auth-buttons { display: flex; gap: 10px; }

.btn-login, .btn-signup {
  padding: 10px 24px;
  border: none;
  border-radius: 50px;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  font-family: 'Poppins', sans-serif;
}

.btn-login {
  background: white;
  color: var(--emerald);
  border: 2px solid var(--emerald);
}
.btn-login:hover { background: var(--emerald); color: white; }

.btn-signup {
  background: linear-gradient(135deg, var(--emerald) 0%, var(--deep-emerald) 100%);
  color: white;
}
.btn-signup:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(4,120,87,0.3);
}

.btn-logout {
  padding: 8px 20px;
  background: #dc2626;
  color: white;
  border: none;
  border-radius: 50px;
  font-size: 13px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  font-family: 'Poppins', sans-serif;
}
.btn-logout:hover { background: #991b1b; transform: translateY(-2px); }

.user-menu {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 10px 20px;
  background: white;
  border-radius: 50px;
  border: 2px solid rgba(4,120,87,0.1);
}
.user-avatar {
  width: 35px; height: 35px; border-radius: 50%;
  background: linear-gradient(135deg, var(--emerald) 0%, var(--deep-emerald) 100%);
  color: white;
  display: flex; align-items: center; justify-content: center;
  font-weight: 700; font-size: 14px;
}
.user-name { font-weight: 600; font-size: 14px; color: var(--text-dark); }
.user-role { font-size: 11px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; }

/* ‚îÄ‚îÄ TICKER ‚îÄ‚îÄ */
.ticker-wrap {
  background: linear-gradient(135deg, var(--charcoal) 0%, #374151 100%);
  color: white;
  padding: 15px 20px;
  border-radius: 20px;
  margin: 20px 0;
  font-size: 0.9em;
  display: flex;
  align-items: center;
  gap: 15px;
  box-shadow: var(--shadow-soft);
  overflow: hidden;
}

.ticker-badge {
  background: var(--gold);
  color: var(--charcoal);
  padding: 4px 12px;
  border-radius: 8px;
  font-weight: 700;
  font-size: 11px;
  letter-spacing: 1px;
  white-space: nowrap;
  flex-shrink: 0;
}

.ticker-scroll-wrap {
  overflow: hidden;
  flex: 1;
  position: relative;
}

.ticker-track {
  display: inline-block;
  white-space: nowrap;
  animation: ticker-scroll 30s linear infinite;
}

.ticker-track:hover { animation-play-state: paused; }

@keyframes ticker-scroll {
  0%   { transform: translateX(0); }
  100% { transform: translateX(-50%); }
}

/* ‚îÄ‚îÄ SECTIONS ‚îÄ‚îÄ */
.section { display: none; padding: 40px 0; min-height: 80vh; }
.section.active {
  display: block;
  animation: fadeIn 0.5s ease-in;
}

@keyframes fadeIn {
  from { opacity:0; transform:translateY(20px); }
  to   { opacity:1; transform:translateY(0); }
}

/* ‚îÄ‚îÄ HERO ‚îÄ‚îÄ */
.hero {
  background:
    linear-gradient(135deg, rgba(4,120,87,0.95) 0%, rgba(6,95,70,0.95) 100%),
    url('https://i.imgur.com/ScImUS2.jpeg');
  background-size: cover;
  background-position: center;
  color: white;
  border-radius: 30px;
  padding: 80px 40px;
  text-align: center;
  margin-bottom: 40px;
  box-shadow: var(--shadow-hover);
  position: relative;
  overflow: hidden;
}

.hero::before {
  content: '';
  position: absolute;
  top: -50%; right: -10%;
  width: 500px; height: 500px;
  background: rgba(212,175,55,0.15);
  border-radius: 50%;
  animation: float 6s ease-in-out infinite;
}

@keyframes float {
  0%, 100% { transform: translateY(0) rotate(0deg); }
  50%       { transform: translateY(-15px) rotate(3deg); }
}

.hero h1 {
  font-size: 3em; margin-bottom: 20px; font-weight: 800;
  position: relative; z-index: 1;
}

.hero p {
  font-size: 1.3em; opacity: 0.95;
  position: relative; z-index: 1;
}

.hero-stats-grid {
  display: grid;
  grid-template-columns: repeat(3,1fr);
  gap: 20px;
  margin-top: 40px;
  position: relative;
  z-index: 1;
}

.hero-stat {
  background: rgba(255,255,255,0.15);
  border-radius: 20px;
  padding: 20px;
  text-align: center;
}

.hero-stat-num {
  display: block;
  font-size: 2.2em;
  font-weight: 800;
  line-height: 1;
  letter-spacing: -1px;
}

.hero-stat-label {
  font-size: 13px;
  opacity: 0.85;
  margin-top: 6px;
  display: block;
}

/* ‚îÄ‚îÄ VALUE PROPS ‚îÄ‚îÄ */
.value-props {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(320px,1fr));
  gap: 30px;
  margin-top: 40px;
}

.value-card {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  padding: 40px;
  border-radius: 25px;
  border: 1px solid var(--glass-border);
  box-shadow: var(--shadow-soft);
  transition: all 0.4s cubic-bezier(0.4,0,0.2,1);
  position: relative;
  overflow: hidden;
}

.value-card::before {
  content: '';
  position: absolute;
  top:0; left:0; width:100%; height:5px;
  background: linear-gradient(90deg, var(--emerald), var(--gold));
}

.value-card:hover {
  transform: translateY(-5px);
  box-shadow: var(--shadow-hover);
}

.value-card h3 {
  color: var(--emerald);
  margin-bottom: 20px;
  font-size: 1.6em;
  font-weight: 700;
}

.value-card .highlight {
  font-size: 1.2em;
  font-weight: 600;
  color: var(--charcoal);
  margin: 25px 0;
  padding: 20px;
  background: linear-gradient(135deg, var(--light-gold) 0%, #fef9e7 100%);
  border-radius: 15px;
  border-left: 4px solid var(--gold);
}

/* ‚îÄ‚îÄ FORMS ‚îÄ‚îÄ */
.form-container {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  padding: 40px;
  border-radius: 25px;
  border: 1px solid var(--glass-border);
  box-shadow: var(--shadow-soft);
  margin-bottom: 30px;
}

.form-group { margin-bottom: 25px; }

label {
  display: block;
  margin-bottom: 10px;
  font-weight: 600;
  color: var(--text-dark);
  font-size: 14px;
  letter-spacing: 0.3px;
}

input[type="text"],
input[type="email"],
input[type="password"],
input[type="tel"],
input[type="date"],
input[type="time"],
input[type="number"],
input[type="url"],
textarea,
select {
  width: 100%;
  padding: 14px 20px;
  border: 2px solid rgba(4,120,87,0.1);
  border-radius: 15px;
  font-size: 15px;
  font-family: 'Poppins', sans-serif;
  transition: all 0.3s ease;
  background: white;
  color: var(--text-dark);
}

input:focus, textarea:focus, select:focus {
  outline: none;
  border-color: var(--emerald);
  box-shadow: 0 0 0 4px rgba(4,120,87,0.1);
}

textarea { min-height: 120px; resize: vertical; }

.form-row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 20px;
  margin-bottom: 25px;
}

/* ‚îÄ‚îÄ BUTTONS ‚îÄ‚îÄ */
.btn {
  padding: 16px 32px;
  border: none;
  border-radius: 50px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.4s cubic-bezier(0.4,0,0.2,1);
  position: relative;
  overflow: hidden;
  font-family: 'Poppins', sans-serif;
  display: inline-flex;
  align-items: center;
  gap: 8px;
  text-decoration: none;
}

.btn::before {
  content: '';
  position: absolute;
  top:50%; left:50%;
  width:0; height:0;
  border-radius: 50%;
  background: rgba(255,255,255,0.3);
  transform: translate(-50%,-50%);
  transition: width 0.6s, height 0.6s;
}
.btn:hover::before { width:300px; height:300px; }

.btn-primary {
  background: linear-gradient(135deg, var(--emerald) 0%, var(--deep-emerald) 100%);
  color: white;
  box-shadow: 0 8px 20px rgba(4,120,87,0.3);
}
.btn-primary:hover {
  transform: translateY(-3px);
  box-shadow: 0 12px 30px rgba(4,120,87,0.4);
}

.btn-secondary {
  background: linear-gradient(135deg, var(--gold) 0%, #b8860b 100%);
  color: white;
  box-shadow: 0 8px 20px rgba(212,175,55,0.3);
}
.btn-secondary:hover { transform: translateY(-3px); }

.btn-danger {
  background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
  color: white;
  box-shadow: 0 8px 20px rgba(220,38,38,0.3);
}

.btn-ghost {
  background: transparent;
  border: 1.5px solid rgba(107,114,128,0.4);
  color: var(--text-muted);
}
.btn-ghost:hover { border-color: var(--emerald); color: var(--emerald); }

.btn-success {
  background: linear-gradient(135deg, var(--whatsapp-green) 0%, #128c7e 100%);
  color: white;
  box-shadow: 0 8px 20px rgba(37,211,102,0.3);
}

.btn-sm {
  padding: 10px 20px;
  font-size: 13px;
}

.btn-xs {
  padding: 6px 14px;
  font-size: 12px;
}

.btn-block { width: 100%; justify-content: center; }

.btn:disabled { opacity: 0.6; cursor: not-allowed; }

/* ‚îÄ‚îÄ JOB BOARD ‚îÄ‚îÄ */
.job-filter-bar {
  display: flex;
  gap: 12px;
  flex-wrap: wrap;
  margin-bottom: 30px;
}

.job-filter-bar input,
.job-filter-bar select {
  flex: 1;
  min-width: 180px;
  border-radius: 15px;
  padding: 14px 20px;
  margin-bottom: 0;
}

.job-board-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(350px,1fr));
  gap: 25px;
}

.job-card {
  background: var(--glass-bg);
  padding: 30px;
  border-radius: 25px;
  border: 1px solid var(--glass-border);
  box-shadow: var(--shadow-soft);
  transition: all 0.3s ease;
  position: relative;
}

.job-card:hover {
  transform: translateY(-5px);
  box-shadow: var(--shadow-hover);
}

.job-card.inactive { opacity: 0.6; filter: grayscale(50%); }

.job-card-header {
  display: flex;
  align-items: flex-start;
  justify-content: space-between;
  gap: 12px;
  margin-bottom: 15px;
}

.job-title-text {
  font-size: 1.05em;
  font-weight: 700;
  color: var(--text-dark);
  flex: 1;
  line-height: 1.35;
}

.job-status-badge {
  padding: 6px 14px;
  border-radius: 15px;
  font-size: 11px;
  font-weight: 700;
  letter-spacing: 0.5px;
  white-space: nowrap;
  flex-shrink: 0;
}

.job-status-live   { background: linear-gradient(135deg,#10b981,#059669); color:white; }
.job-status-paused { background: linear-gradient(135deg,#f59e0b,#d97706); color:white; }
.job-status-closed { background: linear-gradient(135deg,#dc2626,#991b1b); color:white; }
.job-status-draft  { background: linear-gradient(135deg,#f59e0b,#d97706); color:white; }
.job-status-active { background: linear-gradient(135deg,#10b981,#059669); color:white; }
.job-status-urgent { background: linear-gradient(135deg,#dc2626,#991b1b); color:white; }

.job-meta {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
  margin-bottom: 15px;
}

.meta-chip {
  padding: 5px 12px;
  background: rgba(4,120,87,0.06);
  border: 1px solid rgba(4,120,87,0.12);
  border-radius: 20px;
  font-size: 12px;
  color: var(--text-muted);
  font-weight: 500;
}

.meta-chip.sal { color: var(--emerald); border-color: rgba(4,120,87,0.25); }

.skill-tags {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
  margin: 12px 0;
}

.skill-tag {
  padding: 5px 12px;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 600;
  letter-spacing: 0.3px;
}

.skill-tag.em {
  background: linear-gradient(135deg, var(--emerald) 0%, var(--deep-emerald) 100%);
  color: white;
}

.skill-tag.plain {
  background: rgba(4,120,87,0.08);
  color: var(--emerald);
  border: 1px solid rgba(4,120,87,0.2);
}

.job-desc-preview {
  font-size: 13px;
  color: var(--text-muted);
  line-height: 1.55;
  margin: 10px 0;
  display: -webkit-box;
  -webkit-line-clamp: 3;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.job-actions {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
  align-items: center;
  margin-top: 20px;
  padding-top: 18px;
  border-top: 1px solid rgba(4,120,87,0.08);
}

/* ‚îÄ‚îÄ MATCH SCORES ‚îÄ‚îÄ */
.match-score-badge {
  padding: 5px 12px;
  border-radius: 15px;
  font-size: 12px;
  font-weight: 700;
  white-space: nowrap;
}
.match-premium { background: linear-gradient(135deg,#d4af37,#b8860b); color:white; }
.match-strong  { background: linear-gradient(135deg,#10b981,#059669); color:white; }
.match-fit     { background: linear-gradient(135deg,#3b82f6,#2563eb); color:white; }
.match-gem     { background: linear-gradient(135deg,#8b5cf6,#6d28d9); color:white; }

/* ‚îÄ‚îÄ CANDIDATES ‚îÄ‚îÄ */
.candidates-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(320px,1fr));
  gap: 25px;
}

.candidate-card {
  background: var(--glass-bg);
  padding: 25px;
  border-radius: 20px;
  border: 1px solid var(--glass-border);
  box-shadow: var(--shadow-soft);
  transition: all 0.3s ease;
}

.candidate-card:hover { transform: translateY(-3px); box-shadow: var(--shadow-hover); }

.candidate-header {
  display: flex;
  align-items: center;
  gap: 15px;
  margin-bottom: 15px;
}

.candidate-avatar {
  width: 48px; height: 48px; border-radius: 50%;
  background: linear-gradient(135deg, var(--emerald) 0%, var(--deep-emerald) 100%);
  color: white;
  display: flex; align-items: center; justify-content: center;
  font-weight: 700; font-size: 16px;
  flex-shrink: 0;
}

.candidate-name { font-weight: 700; font-size: 15px; color: var(--text-dark); }
.candidate-role { font-size: 12px; color: var(--text-muted); margin-top: 2px; }

.match-score-label { text-align: center; }
.match-score-pct {
  display: block;
  font-size: 1.6em;
  font-weight: 800;
  color: var(--emerald);
  line-height: 1;
  letter-spacing: -1px;
}
.match-score-sub { font-size: 11px; color: var(--text-muted); }

.match-breakdown { margin: 15px 0; }
.match-breakdown-row {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 8px;
}
.breakdown-label { font-size: 12px; color: var(--text-muted); width: 80px; flex-shrink: 0; }
.breakdown-bar-wrap {
  flex: 1;
  height: 6px;
  background: rgba(4,120,87,0.1);
  border-radius: 3px;
  overflow: hidden;
}
.breakdown-bar {
  height: 100%;
  background: linear-gradient(90deg, var(--emerald), var(--gold));
  border-radius: 3px;
  transition: width 0.8s ease;
}
.breakdown-score { font-size: 11px; color: var(--text-muted); width: 40px; text-align: right; }

.whatsapp-btn {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 10px 18px;
  background: linear-gradient(135deg, var(--whatsapp-green) 0%, #128c7e 100%);
  color: white;
  border-radius: 50px;
  font-size: 13px;
  font-weight: 600;
  text-decoration: none;
  transition: all 0.3s ease;
  font-family: 'Poppins', sans-serif;
}
.whatsapp-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 16px rgba(37,211,102,0.35); }

/* ‚îÄ‚îÄ CHIPS ‚îÄ‚îÄ */
.chips-list { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 8px; }
.chip-removable {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 6px 14px;
  background: var(--emerald);
  color: white;
  border-radius: 20px;
  font-size: 13px;
  font-weight: 600;
}
.chip-remove {
  cursor: pointer;
  font-size: 14px;
  opacity: 0.75;
  line-height: 1;
}
.chip-remove:hover { opacity: 1; }

/* ‚îÄ‚îÄ ANALYTICS GRID ‚îÄ‚îÄ */
.analytics-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(160px,1fr));
  gap: 20px;
  margin-bottom: 30px;
}

.analytics-card {
  background: var(--glass-bg);
  padding: 25px;
  border-radius: 20px;
  border: 1px solid var(--glass-border);
  box-shadow: var(--shadow-soft);
  text-align: center;
}

.analytics-num {
  display: block;
  font-size: 2.2em;
  font-weight: 800;
  color: var(--emerald);
  line-height: 1;
  letter-spacing: -1px;
}

.analytics-label {
  display: block;
  font-size: 12px;
  color: var(--text-muted);
  margin-top: 8px;
  font-weight: 500;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

/* ‚îÄ‚îÄ TABLES ‚îÄ‚îÄ */
.table-wrap {
  overflow-x: auto;
  border-radius: 15px;
  box-shadow: var(--shadow-soft);
}

.admin-table {
  width: 100%;
  background: white;
  border-collapse: collapse;
  border-radius: 15px;
  overflow: hidden;
}

.admin-table th {
  background: linear-gradient(135deg, var(--emerald) 0%, var(--deep-emerald) 100%);
  color: white;
  padding: 15px;
  text-align: left;
  font-weight: 600;
  font-size: 13px;
}

.admin-table td {
  padding: 14px 15px;
  border-bottom: 1px solid rgba(4,120,87,0.08);
  font-size: 13px;
}

.admin-table tr:last-child td { border-bottom: none; }
.admin-table tr:hover td { background: rgba(4,120,87,0.04); }

/* ‚îÄ‚îÄ SALARY TABLE ‚îÄ‚îÄ */
.salary-table {
  width: 100%;
  border-collapse: collapse;
}

.salary-table th {
  background: linear-gradient(135deg, var(--emerald) 0%, var(--deep-emerald) 100%);
  color: white;
  padding: 15px;
  text-align: left;
  font-weight: 600;
  font-size: 13px;
}

.salary-table td {
  padding: 14px 15px;
  border-bottom: 1px solid rgba(4,120,87,0.08);
  font-size: 13px;
  color: var(--text-dark);
}

.salary-table tr:last-child td { border-bottom: none; }
.salary-table tr:hover td { background: rgba(4,120,87,0.04); }

/* ‚îÄ‚îÄ NEWS GRID ‚îÄ‚îÄ */
.news-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px,1fr));
  gap: 25px;
  margin-top: 30px;
}

.news-card {
  background: var(--glass-bg);
  padding: 30px;
  border-radius: 25px;
  border: 1px solid var(--glass-border);
  box-shadow: var(--shadow-soft);
  transition: all 0.3s ease;
  cursor: pointer;
}

.news-card:hover {
  transform: translateY(-5px);
  box-shadow: var(--shadow-hover);
}

.news-category {
  display: inline-block;
  padding: 4px 12px;
  background: var(--emerald);
  color: white;
  border-radius: 15px;
  font-size: 11px;
  font-weight: 600;
  margin-bottom: 12px;
  letter-spacing: 0.5px;
}

.news-title {
  font-size: 1.05em;
  font-weight: 700;
  color: var(--emerald);
  margin-bottom: 12px;
  line-height: 1.4;
}

.news-excerpt {
  font-size: 13px;
  color: var(--text-muted);
  line-height: 1.65;
  margin-bottom: 12px;
}

.news-date {
  font-size: 12px;
  color: var(--text-muted);
  font-weight: 500;
}

/* ‚îÄ‚îÄ CV GRID ‚îÄ‚îÄ */
.cv-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px,1fr));
  gap: 25px;
  margin-top: 30px;
}

.cv-card {
  background: white;
  padding: 30px;
  border-radius: 20px;
  border: 2px solid rgba(4,120,87,0.1);
  transition: all 0.3s ease;
  text-align: center;
}

.cv-card:hover {
  border-color: var(--emerald);
  box-shadow: 0 8px 20px rgba(4,120,87,0.15);
  transform: translateY(-5px);
}

.cv-icon { font-size: 36px; display: block; margin-bottom: 15px; }
.cv-title { font-weight: 700; font-size: 1.05em; color: var(--emerald); margin-bottom: 12px; }
.cv-desc  { font-size: 13px; color: var(--text-muted); line-height: 1.65; margin-bottom: 20px; }

/* ‚îÄ‚îÄ SECTION LABELS ‚îÄ‚îÄ */
.section-label {
  font-size: 12px;
  font-weight: 600;
  letter-spacing: 2px;
  text-transform: uppercase;
  color: var(--emerald);
  margin-bottom: 8px;
}

.section-title {
  font-size: clamp(1.5rem, 2.5vw, 2rem);
  font-weight: 800;
  color: var(--text-dark);
  margin-bottom: 12px;
  line-height: 1.2;
}

.section-title em { font-style: normal; color: var(--emerald); }

.section-sub {
  font-size: 15px;
  color: var(--text-muted);
  line-height: 1.65;
  max-width: 600px;
  margin-bottom: 30px;
}

/* ‚îÄ‚îÄ DASHBOARD ‚îÄ‚îÄ */
.dash-wrap {
  display: grid;
  grid-template-columns: 240px 1fr;
  min-height: calc(100vh - 0px);
  max-width: 1400px;
  margin: 0 auto;
}

.dash-sidebar {
  background: var(--glass-bg);
  border-right: 1px solid var(--glass-border);
  padding: 30px 20px;
  position: sticky;
  top: 0;
  height: 100vh;
  overflow-y: auto;
  box-shadow: 4px 0 20px rgba(4,120,87,0.06);
}

.dash-user-info {
  text-align: center;
  padding-bottom: 25px;
  border-bottom: 1px solid rgba(4,120,87,0.1);
  margin-bottom: 20px;
}

.dash-avatar {
  width: 60px; height: 60px; border-radius: 50%;
  background: linear-gradient(135deg, var(--emerald) 0%, var(--deep-emerald) 100%);
  color: white;
  display: flex; align-items: center; justify-content: center;
  font-weight: 700; font-size: 20px;
  margin: 0 auto 12px;
  box-shadow: 0 8px 20px rgba(4,120,87,0.3);
}

.dash-user-name {
  font-weight: 700;
  font-size: 15px;
  color: var(--text-dark);
  margin-bottom: 4px;
}

.dash-user-role {
  font-size: 12px;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 1px;
  font-weight: 600;
}

.dash-nav { display: flex; flex-direction: column; gap: 6px; }

.dash-nav-item {
  padding: 12px 18px;
  background: transparent;
  border: none;
  border-radius: 15px;
  font-weight: 600;
  font-size: 14px;
  cursor: pointer;
  transition: all 0.3s ease;
  font-family: 'Poppins', sans-serif;
  color: var(--text-muted);
  text-align: left;
  display: flex;
  align-items: center;
  gap: 10px;
}

.dash-nav-item:hover {
  background: rgba(4,120,87,0.08);
  color: var(--emerald);
}

.dash-nav-item.active {
  background: linear-gradient(135deg, var(--emerald) 0%, var(--deep-emerald) 100%);
  color: white;
  box-shadow: 0 6px 16px rgba(4,120,87,0.3);
}

.dash-content { padding: 35px; background: var(--bg-primary); overflow-y: auto; }

.dash-panel { display: none; }
.dash-panel.active { display: block; animation: fadeIn 0.4s ease-in; }

.panel-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 30px;
  flex-wrap: wrap;
  gap: 15px;
}

.panel-title {
  font-size: 1.6em;
  font-weight: 800;
  color: var(--text-dark);
  letter-spacing: -0.5px;
}

.panel-sub {
  font-size: 14px;
  color: var(--text-muted);
  margin-top: 4px;
}

/* Profile completion */
.profile-progress {
  background: var(--glass-bg);
  border: 1px solid var(--glass-border);
  border-radius: 20px;
  padding: 25px;
  margin-bottom: 25px;
  box-shadow: var(--shadow-soft);
}

.completion-bar-wrap {
  height: 10px;
  background: rgba(4,120,87,0.1);
  border-radius: 10px;
  overflow: hidden;
  margin: 10px 0;
}

.completion-bar {
  height: 100%;
  background: linear-gradient(90deg, var(--emerald), var(--gold));
  border-radius: 10px;
  transition: width 0.8s ease;
}

/* ‚îÄ‚îÄ MODALS ‚îÄ‚îÄ */
.modal-overlay {
  display: none;
  position: fixed;
  top:0; left:0; right:0; bottom:0;
  background: rgba(0,0,0,0.7);
  backdrop-filter: blur(10px);
  z-index: 1000;
  align-items: center;
  justify-content: center;
  padding: 20px;
}

.modal-overlay.open { display: flex; animation: fadeIn 0.3s ease; }

.modal {
  background: var(--glass-bg);
  backdrop-filter: blur(30px);
  padding: 40px;
  border-radius: 30px;
  max-width: 520px;
  width: 100%;
  max-height: 90vh;
  overflow-y: auto;
  box-shadow: 0 20px 60px rgba(0,0,0,0.3);
  border: 1px solid var(--glass-border);
  position: relative;
}

.modal-wide { max-width: 700px; }

.modal-title {
  font-size: 1.5em;
  font-weight: 800;
  color: var(--emerald);
  margin-bottom: 8px;
  letter-spacing: -0.5px;
}

.modal-sub {
  font-size: 14px;
  color: var(--text-muted);
  margin-bottom: 25px;
  line-height: 1.5;
}

.modal-close {
  position: absolute;
  top: 20px; right: 20px;
  font-size: 24px;
  cursor: pointer;
  color: var(--text-muted);
  background: none;
  border: none;
  transition: all 0.3s ease;
  font-family: 'Poppins', sans-serif;
  line-height: 1;
}

.modal-close:hover { color: #dc2626; transform: rotate(90deg); }

/* Form fields in modals */
.form-field { margin-bottom: 20px; }
.form-label { display: block; margin-bottom: 8px; font-weight: 600; font-size: 14px; color: var(--text-dark); }
.form-input, .form-select, .form-textarea {
  width: 100%;
  padding: 13px 18px;
  border: 2px solid rgba(4,120,87,0.1);
  border-radius: 15px;
  font-size: 14px;
  font-family: 'Poppins', sans-serif;
  transition: all 0.3s ease;
  background: white;
  color: var(--text-dark);
}
.form-input:focus, .form-select:focus, .form-textarea:focus {
  outline: none;
  border-color: var(--emerald);
  box-shadow: 0 0 0 4px rgba(4,120,87,0.1);
}
.form-textarea { min-height: 100px; resize: vertical; }

/* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
.toast {
  display: none;
  padding: 14px 20px;
  border-radius: 15px;
  font-size: 14px;
  font-weight: 600;
  margin-bottom: 20px;
}

.toast.show { display: block; }

.toast.success {
  background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
  border: 2px solid var(--emerald);
  color: var(--deep-emerald);
}

.toast.error {
  background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
  border: 2px solid #dc2626;
  color: #991b1b;
}

/* ‚îÄ‚îÄ EMPTY STATE ‚îÄ‚îÄ */
.empty-state {
  text-align: center;
  padding: 50px 30px;
  background: var(--glass-bg);
  border-radius: 25px;
  border: 2px dashed rgba(4,120,87,0.2);
}

.empty-icon { font-size: 48px; display: block; opacity: 0.5; margin-bottom: 15px; }
.empty-title { font-size: 1.1em; font-weight: 700; color: var(--text-dark); margin-bottom: 8px; }
.empty-sub   { font-size: 14px; color: var(--text-muted); }

/* ‚îÄ‚îÄ SPINNER ‚îÄ‚îÄ */
.spinner {
  width: 18px; height: 18px;
  border: 2px solid rgba(4,120,87,0.15);
  border-top-color: var(--emerald);
  border-radius: 50%;
  display: inline-block;
  animation: spin 0.7s linear infinite;
  vertical-align: middle;
  margin-right: 6px;
}
@keyframes spin { to { transform: rotate(360deg); } }

/* ‚îÄ‚îÄ LIVE DOT ‚îÄ‚îÄ */
.live-dot {
  display: inline-block;
  width: 8px; height: 8px;
  border-radius: 50%;
  background: #22c55e;
  vertical-align: middle;
  flex-shrink: 0;
  animation: pulse-dot 2s ease-in-out infinite;
}
@keyframes pulse-dot {
  0%, 100% { opacity: 1; transform: scale(1); }
  50%       { opacity: 0.6; transform: scale(1.2); }
}

/* ‚îÄ‚îÄ VIRTUAL JOB FAIR BADGE ‚îÄ‚îÄ */
.vjf-badge {
  position: fixed;
  bottom: 25px; right: 25px;
  background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
  color: white;
  padding: 15px 22px;
  border-radius: 20px;
  z-index: 98;
  cursor: pointer;
  box-shadow: 0 8px 25px rgba(220,38,38,0.4);
  font-weight: 600;
  font-size: 14px;
  display: flex;
  align-items: center;
  gap: 8px;
  animation: pulse-badge 3s ease-in-out infinite;
  font-family: 'Poppins', sans-serif;
  border: none;
}

@keyframes pulse-badge {
  0%, 100% { box-shadow: 0 8px 25px rgba(220,38,38,0.4); }
  50%       { box-shadow: 0 12px 35px rgba(220,38,38,0.6); }
}

/* ‚îÄ‚îÄ STATS BAR ‚îÄ‚îÄ */
.stats-bar {
  background: var(--glass-bg);
  border-radius: 20px;
  padding: 20px 30px;
  margin-bottom: 35px;
  box-shadow: var(--shadow-soft);
  border: 1px solid var(--glass-border);
}

.stats-bar-inner {
  display: grid;
  grid-template-columns: repeat(4,1fr);
  gap: 20px;
}

.stat-pill { text-align: center; }
.stat-pill-num {
  display: block;
  font-size: 1.8em;
  font-weight: 800;
  color: var(--emerald);
  line-height: 1;
  letter-spacing: -1px;
}
.stat-pill-label {
  display: block;
  font-size: 12px;
  color: var(--text-muted);
  margin-top: 5px;
  font-weight: 500;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

/* ‚îÄ‚îÄ DATA SAVER TOGGLE ‚îÄ‚îÄ */
.data-saver-toggle {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 13px;
  color: var(--text-muted);
  cursor: pointer;
  user-select: none;
}

.toggle-pill {
  width: 36px; height: 20px;
  border-radius: 10px;
  background: rgba(4,120,87,0.15);
  border: 1px solid rgba(4,120,87,0.2);
  position: relative;
  transition: all 0.3s ease;
  cursor: pointer;
  display: inline-block;
  flex-shrink: 0;
}

.toggle-pill.on { background: var(--emerald); border-color: var(--emerald); }
.toggle-knob {
  width: 14px; height: 14px;
  border-radius: 50%;
  background: white;
  position: absolute;
  top: 2px; left: 2px;
  transition: all 0.3s ease;
  box-shadow: 0 1px 3px rgba(0,0,0,0.2);
}
.toggle-pill.on .toggle-knob { left: 18px; }

/* ‚îÄ‚îÄ EXPLANATION BOXES ‚îÄ‚îÄ */
.explanation {
  background: linear-gradient(135deg, var(--light-gold) 0%, #fef9e7 100%);
  padding: 20px;
  border-radius: 15px;
  border-left: 5px solid var(--gold);
  margin: 20px 0;
  font-size: 14px;
}

.explanation strong { color: var(--emerald); font-weight: 700; }

/* ‚îÄ‚îÄ FOOTER ‚îÄ‚îÄ */
footer {
  background: linear-gradient(135deg, var(--charcoal) 0%, #374151 100%);
  color: white;
  padding: 60px 0 30px;
  margin-top: 60px;
}

.footer-inner { max-width: 1400px; margin: 0 auto; padding: 0 20px; }

.footer-grid {
  display: grid;
  grid-template-columns: 2fr 1fr 1fr 1fr;
  gap: 40px;
  margin-bottom: 40px;
}

.footer-brand-name {
  font-size: 1.4em;
  font-weight: 800;
  margin-bottom: 12px;
  background: linear-gradient(135deg, #ffffff 0%, rgba(255,255,255,0.8) 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.footer-brand-name em { font-style: normal; color: var(--gold); -webkit-text-fill-color: var(--gold); }

.footer-desc {
  font-size: 14px;
  color: rgba(255,255,255,0.6);
  line-height: 1.7;
  max-width: 280px;
}

.footer-col-title {
  font-size: 12px;
  font-weight: 700;
  letter-spacing: 2px;
  text-transform: uppercase;
  color: var(--gold);
  margin-bottom: 16px;
}

.footer-link {
  display: block;
  font-size: 14px;
  color: rgba(255,255,255,0.6);
  margin-bottom: 10px;
  transition: color 0.3s ease;
  cursor: pointer;
}
.footer-link:hover { color: white; }

.footer-bottom {
  border-top: 1px solid rgba(255,255,255,0.1);
  padding-top: 25px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-wrap: wrap;
  gap: 12px;
}

.footer-copy { font-size: 13px; color: rgba(255,255,255,0.45); }

.zim-flag {
  display: flex;
  gap: 3px;
  align-items: center;
}
.zim-flag-stripe {
  width: 18px; height: 9px; border-radius: 2px;
}

/* ‚îÄ‚îÄ RESPONSIVE ‚îÄ‚îÄ */
@media (max-width: 900px) {
  .dash-wrap { grid-template-columns: 1fr; }
  .dash-sidebar { position: static; height: auto; }
  .footer-grid { grid-template-columns: 1fr 1fr; }
}

@media (max-width: 768px) {
  .hero h1 { font-size: 2em; }
  .hero { padding: 50px 25px; }
  .hero-stats-grid { grid-template-columns: 1fr 1fr; }
  .value-props { grid-template-columns: 1fr; }
  .job-board-grid { grid-template-columns: 1fr; }
  .candidates-grid { grid-template-columns: 1fr; }
  .news-grid { grid-template-columns: 1fr; }
  .cv-grid { grid-template-columns: 1fr; }
  .stats-bar-inner { grid-template-columns: 1fr 1fr; }
  .form-row { grid-template-columns: 1fr; }
  .footer-grid { grid-template-columns: 1fr; }
  .header-right { width: 100%; }
  .vjf-badge { display: none; }
}

@media (max-width: 480px) {
  .analytics-grid { grid-template-columns: 1fr 1fr; }
  .hero-stats-grid { grid-template-columns: 1fr; }
}

/* ‚îÄ‚îÄ SCROLLBAR ‚îÄ‚îÄ */
::-webkit-scrollbar { width: 10px; }
::-webkit-scrollbar-track { background: #f1f1f1; }
::-webkit-scrollbar-thumb { background: var(--emerald); border-radius: 5px; }
::-webkit-scrollbar-thumb:hover { background: var(--deep-emerald); }

::selection { background: var(--emerald); color: white; }

/* ‚îÄ‚îÄ HIDDEN ‚îÄ‚îÄ */
.hidden { display: none !important; }

/* HAMBURGER */
.hamburger-btn { display:none; flex-direction:column; gap:5px; cursor:pointer; padding:8px; border:none; background:none; z-index:210; }
.hamburger-btn span { display:block; width:24px; height:2px; background:var(--text-dark); border-radius:2px; transition:all 0.3s ease; }
.mobile-nav-item-btn { padding:16px 40px; font-size:18px; font-weight:600; color:var(--text-dark); border:none; background:none; cursor:pointer; font-family:'Poppins',sans-serif; border-radius:15px; width:80%; text-align:center; transition:all 0.2s ease; }
.mobile-nav-item-btn:hover { background:rgba(4,120,87,0.08); color:var(--emerald); }
@media(max-width:900px) {
  .nav-tabs { display:none; }
  .hamburger-btn { display:flex; }
}
</style>
</head>
<body>

<!-- MOBILE MENU OVERLAY -->
<div id="mobile-menu" style="display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(255,255,255,0.98);backdrop-filter:blur(20px);z-index:500;flex-direction:column;align-items:center;justify-content:center;gap:18px;">
  <button id="mobile-menu-close" style="position:absolute;top:20px;right:20px;font-size:28px;cursor:pointer;border:none;background:none;color:#6b7280;font-family:'Poppins',sans-serif;">‚úï</button>
  <button class="mobile-nav-item-btn" id="mob-home">üè† Home</button>
  <button class="mobile-nav-item-btn" id="mob-jobs">üìã Job Board</button>
  <button class="mobile-nav-item-btn" id="mob-salaries">üí∞ Salaries</button>
  <button class="mobile-nav-item-btn" id="mob-news">üì∞ Market Pulse</button>
  <button class="mobile-nav-item-btn hidden" id="mob-dash">‚öôÔ∏è Dashboard</button>
  <div style="display:flex;gap:12px;margin-top:10px;">
    <button type="button" style="padding:12px 24px;background:white;color:#047857;border:2px solid #047857;border-radius:50px;font-size:14px;font-weight:600;cursor:pointer;font-family:'Poppins',sans-serif;" id="mob-signin">Sign In</button>
    <button type="button" style="padding:12px 24px;background:linear-gradient(135deg,#047857,#065f46);color:white;border:none;border-radius:50px;font-size:14px;font-weight:600;cursor:pointer;font-family:'Poppins',sans-serif;" id="mob-signup">Get Started ‚Üí</button>
  </div>
</div>

<!-- TICKER (CSS animation, no deprecated marquee) -->
<div class="container" id="ticker-wrap">
<div class="ticker-wrap" style="margin:15px 0 0;">
  <span class="ticker-badge">üí° LIVE</span>
  <div class="ticker-scroll-wrap">
    <span class="ticker-track">
      Job Seekers: Profiles with Video Intros get 4x more WhatsApp interview requests! &nbsp;|&nbsp;
      Employers: <span id="ticker-seekers">134</span>+ active candidates ready to start immediately &nbsp;|&nbsp;
      New: Apply directly from our Job Board &nbsp;|&nbsp;
      Pro Tip: Complete your profile for cross-role discovery! &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
      Job Seekers: Profiles with Video Intros get 4x more WhatsApp interview requests! &nbsp;|&nbsp;
      Employers: active candidates ready to start immediately &nbsp;|&nbsp;
      New: Apply directly from our Job Board &nbsp;|&nbsp;
      Pro Tip: Complete your profile for cross-role discovery!
    </span>
  </div>
</div>
</div>

<!-- HEADER -->
<header>
  <div class="container">
    <div class="header-content">
      <div class="logo" id="logo-btn" role="button" tabindex="0" aria-label="Go to homepage">Zim<span>Get</span>Hired</div>
      <div class="header-right">
        <nav class="nav-tabs" aria-label="Main navigation">
          <button type="button" class="nav-tab active" id="tab-home">üè† Home</button>
          <button type="button" class="nav-tab"        id="tab-jobs">üìã Job Board</button>
          <button type="button" class="nav-tab"        id="tab-salaries">üí∞ Salaries</button>
          <button type="button" class="nav-tab"        id="tab-news">üì∞ Market Pulse</button>
          <button type="button" class="nav-tab hidden" id="tab-dash">‚öôÔ∏è Dashboard</button>
        </nav>
        <div style="display:flex;align-items:center;gap:12px">
          <div class="data-saver-toggle" id="data-saver-toggle" role="button" tabindex="0" aria-label="Toggle data saver">
            <div class="toggle-pill" id="ds-pill"><div class="toggle-knob"></div></div>
            <span>Data Saver</span>
          </div>
          <div id="auth-section">
            <div class="auth-buttons">
              <button type="button" class="btn-login" id="nav-login-btn">Sign In</button>
              <button type="button" class="btn-signup" id="nav-signup-btn">Get Started ‚Üí</button>
            </div>
          </div>
          <button class="hamburger-btn" id="hamburger-btn" aria-label="Open menu">
            <span></span><span></span><span></span>
          </button>
        </div>
      </div>
    </div>
  </div>
</header>

<!-- PUBLIC AREA -->
<div id="public-area">
<div class="container">

<!-- HERO SECTION -->
<section id="home-section" style="padding-top:35px">
  <div class="hero">
    <h1>üáøüáº Welcome to ZimGetHired</h1>
    <p>The fastest way to hire and get hired in Zimbabwe</p>
    <div class="hero-stats-grid">
      <div class="hero-stat">
        <span class="hero-stat-num" id="hero-stat-jobs">29</span>
        <span class="hero-stat-label">Open Positions</span>
      </div>
      <div class="hero-stat">
        <span class="hero-stat-num" id="hero-stat-seekers">134</span>
        <span class="hero-stat-label">Professionals</span>
      </div>
      <div class="hero-stat">
        <span class="hero-stat-num" id="hero-stat-employers">89</span>
        <span class="hero-stat-label">Employers</span>
      </div>
    </div>
  </div>

  <!-- STATS BAR -->
  <div class="stats-bar">
    <div class="stats-bar-inner">
      <div class="stat-pill">
        <span class="stat-pill-num" id="sb-jobs">29</span>
        <span class="stat-pill-label"><span class="live-dot" style="width:7px;height:7px;margin-right:4px"></span> Live Positions</span>
      </div>
      <div class="stat-pill">
        <span class="stat-pill-num" id="sb-seekers">134</span>
        <span class="stat-pill-label">Job Seekers</span>
      </div>
      <div class="stat-pill">
        <span class="stat-pill-num" id="sb-employers">89</span>
        <span class="stat-pill-label">Employers</span>
      </div>
      <div class="stat-pill">
        <span class="stat-pill-num" id="sb-applications">62</span>
        <span class="stat-pill-label">Applications</span>
      </div>
    </div>
  </div>

  <!-- VALUE PROPS -->
  <div class="value-props">
    <div class="value-card">
      <h3>üíº For Employers</h3>
      <p style="color:var(--text-muted);font-size:14px;line-height:1.7">Stop wasting weeks reviewing hundreds of CVs. Our AI discovers hidden talent across roles and delivers instant matches with WhatsApp contact.</p>
      <div class="highlight">"See unlimited matched candidates instantly with direct WhatsApp contact."</div>
      <ul style="list-style:none;padding:0;margin:0 0 25px;display:grid;gap:8px">
        <li style="font-size:13px;color:var(--text-dark);display:flex;align-items:center;gap:8px"><span style="color:var(--emerald);font-weight:700">‚úì</span> AI-powered cross-role discovery</li>
        <li style="font-size:13px;color:var(--text-dark);display:flex;align-items:center;gap:8px"><span style="color:var(--emerald);font-weight:700">‚úì</span> Direct WhatsApp contact for all candidates</li>
        <li style="font-size:13px;color:var(--text-dark);display:flex;align-items:center;gap:8px"><span style="color:var(--emerald);font-weight:700">‚úì</span> Job persistence with alerts for new matches</li>
        <li style="font-size:13px;color:var(--text-dark);display:flex;align-items:center;gap:8px"><span style="color:var(--emerald);font-weight:700">‚úì</span> Premium Top 5 + unlimited additional matches</li>
      </ul>
      <button type="button" class="btn btn-primary" id="hero-get-started-btn">Post a Job Free ‚Üí</button>
    </div>
    <div class="value-card">
      <h3>üë§ For Job Seekers</h3>
      <p style="color:var(--text-muted);font-size:14px;line-height:1.7">Create one profile and get discovered for ALL matching roles. Apply directly from our Job Board or get contacted automatically when you're a match.</p>
      <div class="highlight">"Get discovered for roles you didn't even apply to."</div>
      <ul style="list-style:none;padding:0;margin:0 0 25px;display:grid;gap:8px">
        <li style="font-size:13px;color:var(--text-dark);display:flex;align-items:center;gap:8px"><span style="color:var(--emerald);font-weight:700">‚úì</span> Select unlimited professional roles</li>
        <li style="font-size:13px;color:var(--text-dark);display:flex;align-items:center;gap:8px"><span style="color:var(--emerald);font-weight:700">‚úì</span> Direct WhatsApp communication</li>
        <li style="font-size:13px;color:var(--text-dark);display:flex;align-items:center;gap:8px"><span style="color:var(--emerald);font-weight:700">‚úì</span> Browse &amp; apply from Job Board</li>
        <li style="font-size:13px;color:var(--text-dark);display:flex;align-items:center;gap:8px"><span style="color:var(--emerald);font-weight:700">‚úì</span> Professional personality assessment</li>
      </ul>
      <button type="button" class="btn btn-secondary" id="hero-post-job-btn">Create Free Profile ‚Üí</button>
    </div>
    <div class="value-card">
      <h3>üîí Secure by Default</h3>
      <p style="color:var(--text-muted);font-size:14px;line-height:1.7">Built with row-level security. Your data is yours ‚Äî employers see only candidates who match their roles.</p>
      <div class="highlight">"Zimbabwe's most trusted hiring platform."</div>
      <ul style="list-style:none;padding:0;margin:0 0 25px;display:grid;gap:8px">
        <li style="font-size:13px;color:var(--text-dark);display:flex;align-items:center;gap:8px"><span style="color:var(--emerald);font-weight:700">‚úì</span> Row-level security on all data</li>
        <li style="font-size:13px;color:var(--text-dark);display:flex;align-items:center;gap:8px"><span style="color:var(--emerald);font-weight:700">‚úì</span> AI-powered Hidden Gem discovery</li>
        <li style="font-size:13px;color:var(--text-dark);display:flex;align-items:center;gap:8px"><span style="color:var(--emerald);font-weight:700">‚úì</span> USD &amp; ZWL salary benchmarks</li>
        <li style="font-size:13px;color:var(--text-dark);display:flex;align-items:center;gap:8px"><span style="color:var(--emerald);font-weight:700">‚úì</span> Proudly Zimbabwean üáøüáº</li>
      </ul>
      <button type="button" class="btn btn-primary" id="hero-view-jobs-btn">View Open Jobs ‚Üí</button>
    </div>
  </div>
</section>

<!-- JOB BOARD SECTION -->
<section style="padding:40px 0" id="job-board-section">
  <div class="form-container">
    <div class="section-label">Job Board</div>
    <h2 class="section-title">Browse <em>Open Positions</em></h2>
    <p class="section-sub">All active roles posted by verified Zimbabwe employers. Apply directly or sign in for AI-matched recommendations.</p>
    <div class="job-filter-bar">
      <input type="text" id="pub-search" placeholder="üîç Search jobs, skills, titles..." aria-label="Search jobs"/>
      <select id="pub-location" aria-label="Filter by location">
        <option value="">All Locations</option>
        <option value="Harare">Harare</option>
        <option value="Bulawayo">Bulawayo</option>
        <option value="Mutare">Mutare</option>
        <option value="Gweru">Gweru</option>
        <option value="Remote">Remote</option>
      </select>
      <select id="pub-employment" aria-label="Filter by employment type">
        <option value="">All Types</option>
        <option value="full-time">Full-time</option>
        <option value="part-time">Part-time</option>
        <option value="contract">Contract</option>
        <option value="freelance">Freelance</option>
        <option value="internship">Internship</option>
      </select>
    </div>
  </div>
  <div id="public-jobs-grid"><div class="empty-state"><span class="spinner"></span></div></div>
</section>

<!-- SALARY GUIDE -->
<section style="padding:40px 0" id="salary-section">
  <div class="form-container">
    <div class="section-label">Compensation Intelligence</div>
    <h2 class="section-title" style="font-size:1.8em">üí∞ Zimbabwe <em>Salary Guide</em> 2024</h2>
    <p class="section-sub">USD-denominated salary benchmarks across Zimbabwe's key professional sectors. Updated quarterly.</p>
    <input type="text" id="salarySearch" placeholder="üîç Search by role (e.g., 'Developer', 'Sales')..." aria-label="Search salary table" style="margin-bottom:20px"/>
  </div>
  <div class="form-container" style="padding:0;overflow:hidden">
    <div style="overflow-x:auto">
      <table class="salary-table" id="salaryTable">
        <thead>
          <tr><th>Role</th><th>Sector</th><th>Min (USD)</th><th>Mid (USD)</th><th>Max (USD)</th><th>YoY Trend</th></tr>
        </thead>
        <tbody id="salary-tbody"></tbody>
      </table>
    </div>
  </div>
</section>

<!-- NEWS / MARKET PULSE -->
<section style="padding:40px 0" id="news-section">
  <div class="form-container">
    <div class="section-label">Market Pulse</div>
    <h2 class="section-title" style="font-size:1.8em">üì∞ Zimbabwe <em>Business</em> Intelligence</h2>
    <p class="section-sub">Stay informed about Zimbabwe's economy and job market trends.</p>
  </div>
  <div class="news-grid" id="news-grid"></div>
</section>

<!-- CV RESOURCES -->
<section style="padding:40px 0">
  <div class="form-container">
    <div class="section-label">Career Centre</div>
    <h2 class="section-title" style="font-size:1.8em">üìÑ CV &amp; Career <em>Resources</em></h2>
    <p class="section-sub">Expert guidance tailored to the Zimbabwe job market.</p>
  </div>
  <div class="cv-grid">
    <div class="cv-card">
      <span class="cv-icon">üìÑ</span>
      <div class="cv-title">CV Templates</div>
      <div class="cv-desc">4 professional CV templates designed for Zimbabwe employers ‚Äî Tech, Finance, Mining, and Sales.</div>
      <button type="button" class="btn btn-primary btn-sm" id="cv-btn-templates">Download Free</button>
    </div>
    <div class="cv-card">
      <span class="cv-icon">üéØ</span>
      <div class="cv-title">The STAR Method</div>
      <div class="cv-desc">Situation, Task, Action, Result ‚Äî the proven framework for writing achievement-focused CVs that stand out.</div>
      <button type="button" class="btn btn-primary btn-sm" id="cv-btn-star">Learn More</button>
    </div>
    <div class="cv-card">
      <span class="cv-icon">üì±</span>
      <div class="cv-title">WhatsApp CV Tips</div>
      <div class="cv-desc">Use a professional WhatsApp DP, respond within 2 hours, and always send your CV as a PDF.</div>
      <button type="button" class="btn btn-primary btn-sm" id="cv-btn-whatsapp">Read Tips</button>
    </div>
    <div class="cv-card">
      <span class="cv-icon">‚ö†Ô∏è</span>
      <div class="cv-title">Common CV Mistakes</div>
      <div class="cv-desc">Avoid unprofessional emails, listing duties instead of achievements, and generic objective statements.</div>
      <button type="button" class="btn btn-primary btn-sm" id="cv-btn-mistakes">See Checklist</button>
    </div>
    <div class="cv-card">
      <span class="cv-icon">üîç</span>
      <div class="cv-title">Interview Prep</div>
      <div class="cv-desc">Common interview questions from top Zimbabwe companies, with model answers and preparation frameworks.</div>
      <button type="button" class="btn btn-primary btn-sm" id="cv-btn-interview">Prepare Now</button>
    </div>
    <div class="cv-card" style="border:2px solid rgba(4,120,87,0.2);position:relative;overflow:hidden">
      <div style="position:absolute;top:12px;right:12px;background:linear-gradient(135deg,var(--emerald),var(--deep-emerald));color:white;padding:3px 10px;border-radius:20px;font-size:10px;font-weight:700;letter-spacing:0.5px">COMING SOON</div>
      <span class="cv-icon">ü§ñ</span>
      <div class="cv-title">AI CV Editor</div>
      <div class="cv-desc">Paste your CV and our AI rewrites it using STAR, optimised for Zimbabwe employers and matched to job descriptions.</div>
      <button type="button" class="btn btn-secondary btn-sm" id="cv-btn-ai">See Preview</button>
    </div>
  </div>
</section>

</div><!-- /container -->
</div><!-- /public-area -->

<!-- DASHBOARD AREA -->
<div id="dashboard-area" style="display:none;background:var(--bg-primary);min-height:100vh">
  <div class="dash-wrap">
    <aside class="dash-sidebar" id="dash-sidebar">
      <div class="dash-user-info">
        <div class="dash-avatar" id="dash-avatar">?</div>
        <div class="dash-user-name" id="dash-name">‚Äî</div>
        <div class="dash-user-role" id="dash-role-badge">‚Äî</div>
      </div>
      <nav class="dash-nav" id="dash-nav" aria-label="Dashboard navigation"></nav>
      <div style="margin-top:20px;border-top:1px solid rgba(4,120,87,0.1);padding-top:15px;display:flex;flex-direction:column;gap:8px">
        <button type="button" class="btn btn-secondary btn-sm" style="justify-content:center" id="dash-go-public-btn">‚Üê Public Site</button>
        <button type="button" class="btn btn-danger btn-sm" style="justify-content:center" id="dash-logout-btn">Sign Out</button>
      </div>
    </aside>
    <main class="dash-content" id="dash-main"></main>
  </div>
</div>

<!-- AUTH MODAL -->
<div class="modal-overlay" id="auth-modal" role="dialog" aria-modal="true" aria-label="Authentication">
  <div class="modal">
    <button type="button" class="modal-close" id="auth-modal-close" aria-label="Close modal">‚úï</button>
    <div id="auth-modal-login">
      <div class="modal-title">Welcome Back üëã</div>
      <div class="modal-sub">Sign in to your ZimGetHired account</div>
      <div id="auth-toast" class="toast" role="alert"></div>
      <div class="form-field">
        <label class="form-label" for="auth-email">Email Address</label>
        <input class="form-input" id="auth-email" type="email" placeholder="you@example.co.zw" autocomplete="email" required/>
      </div>
      <div class="form-field">
        <label class="form-label" for="auth-password">Password</label>
        <input class="form-input" id="auth-password" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password" required/>
      </div>
      <button type="button" class="btn btn-primary" style="width:100%;justify-content:center;margin-top:8px" id="login-btn">Sign In ‚Üí</button>
      <p style="text-align:center;font-size:13px;color:var(--text-muted);margin-top:14px">
        <span style="color:var(--emerald);cursor:pointer;font-weight:600" id="forgot-password-btn">Forgot password?</span>
      </p>
      <p style="text-align:center;font-size:13px;color:var(--text-muted);margin-top:10px">
        No account? <span style="color:var(--emerald);cursor:pointer;font-weight:700" id="switch-to-signup">Create one free ‚Üí</span>
      </p>
    </div>
    <!-- FORGOT PASSWORD TAB -->
    <div id="auth-modal-forgot" class="hidden">
      <div class="modal-title">Reset Password üîë</div>
      <div class="modal-sub">Enter your email and we'll send a reset link</div>
      <div id="forgot-toast" class="toast" role="alert"></div>
      <div class="form-field">
        <label class="form-label" for="forgot-email">Email Address</label>
        <input class="form-input" id="forgot-email" type="email" placeholder="you@example.co.zw"/>
      </div>
      <button type="button" class="btn btn-primary" style="width:100%;justify-content:center;margin-top:8px" id="forgot-submit-btn">Send Reset Link ‚Üí</button>
      <p style="text-align:center;font-size:13px;color:var(--text-muted);margin-top:14px">
        <span style="color:var(--emerald);cursor:pointer;font-weight:600" id="back-to-login-btn">‚Üê Back to Sign In</span>
      </p>
    </div>
    <div id="auth-modal-signup" class="hidden">
      <div class="modal-title">Join ZimGetHired üöÄ</div>
      <div class="modal-sub">Zimbabwe's leading talent platform ‚Äî free forever</div>
      <div id="signup-toast" class="toast" role="alert"></div>
      <div class="form-field">
        <label class="form-label" for="su-name">Full Name</label>
        <input class="form-input" id="su-name" type="text" placeholder="Tatenda Moyo" autocomplete="name" required/>
      </div>
      <div class="form-field">
        <label class="form-label" for="su-email">Email Address</label>
        <input class="form-input" id="su-email" type="email" placeholder="tatenda@example.co.zw" autocomplete="email" required/>
      </div>
      <div class="form-field">
        <label class="form-label" for="su-password">Password</label>
        <input class="form-input" id="su-password" type="password" placeholder="Minimum 8 characters" autocomplete="new-password" required/>
      </div>
      <div class="form-field">
        <label class="form-label" for="su-role">I am a...</label>
        <select class="form-select" id="su-role">
          <option value="jobseeker">Job Seeker ‚Äî Looking for work</option>
          <option value="employer">Employer ‚Äî Hiring talent</option>
        </select>
      </div>
      <button type="button" class="btn btn-primary" style="width:100%;justify-content:center;margin-top:8px" id="signup-btn">Create Account ‚Üí</button>
      <p style="text-align:center;font-size:13px;color:var(--text-muted);margin-top:20px">
        Have an account? <span style="color:var(--emerald);cursor:pointer;font-weight:700" id="switch-to-login">Sign in ‚Üí</span>
      </p>
    </div>
  </div>
</div>

<!-- JOB DETAIL MODAL -->
<div class="modal-overlay" id="job-detail-modal" role="dialog" aria-modal="true" aria-label="Job Detail">
  <div class="modal modal-wide">
    <button type="button" class="modal-close" id="job-detail-close" aria-label="Close modal">‚úï</button>
    <div id="job-detail-content"></div>
  </div>
</div>

<!-- POST JOB MODAL -->
<div class="modal-overlay" id="post-job-modal" role="dialog" aria-modal="true" aria-label="Post a Job">
  <div class="modal modal-wide">
    <button type="button" class="modal-close" id="post-job-close" aria-label="Close modal">‚úï</button>
    <div class="modal-title">Post a Position üíº</div>
    <div class="modal-sub">Fill in the details below ‚Äî all fields map directly to the <code style="font-family:monospace;font-size:12px;color:var(--emerald)">posted_jobs</code> schema</div>
    <div id="post-job-toast" class="toast" role="alert"></div>
    <div class="form-row">
      <div class="form-field"><label class="form-label" for="pj-title">Job Title</label><input class="form-input" id="pj-title" type="text" placeholder="e.g. Senior Software Engineer" required/></div>
      <div class="form-field"><label class="form-label" for="pj-primary-role">Primary Role</label><input class="form-input" id="pj-primary-role" type="text" placeholder="e.g. Engineering"/></div>
    </div>
    <div class="form-row">
      <div class="form-field"><label class="form-label" for="pj-industry">Industry</label>
        <select class="form-select" id="pj-industry">
          <option value="">Select industry...</option>
          <option value="technology">Technology</option>
          <option value="finance">Finance</option>
          <option value="healthcare">Healthcare</option>
          <option value="retail">Retail</option>
          <option value="manufacturing">Manufacturing</option>
          <option value="education">Education</option>
          <option value="government">Government</option>
          <option value="agriculture">Agriculture</option>
          <option value="logistics">Logistics</option>
          <option value="real_estate">Real Estate</option>
          <option value="hospitality">Hospitality</option>
          <option value="construction">Construction</option>
          <option value="other">Other</option>
        </select>
      </div>
      <div class="form-field"><label class="form-label" for="pj-employment">Employment Type</label>
        <select class="form-select" id="pj-employment">
          <option value="">Select type...</option>
          <option value="full_time">Full-time</option>
          <option value="part_time">Part-time</option>
          <option value="contract">Contract</option>
          <option value="freelance">Freelance</option>
          <option value="internship">Internship</option>
        </select>
      </div>
    </div>
    <div class="form-row">
      <div class="form-field"><label class="form-label" for="pj-province">Province</label>
        <select class="form-select" id="pj-province">
          <option value="">Select province...</option>
          <option value="harare">Harare</option>
          <option value="bulawayo">Bulawayo</option>
          <option value="manicaland">Manicaland</option>
          <option value="mashonaland_central">Mashonaland Central</option>
          <option value="mashonaland_east">Mashonaland East</option>
          <option value="mashonaland_west">Mashonaland West</option>
          <option value="masvingo">Masvingo</option>
          <option value="matabeleland_north">Matabeleland North</option>
          <option value="matabeleland_south">Matabeleland South</option>
          <option value="midlands">Midlands</option>
          <option value="other">Other</option>
        </select>
      </div>
      <div class="form-field"><label class="form-label" for="pj-town">Town</label>
        <select class="form-select" id="pj-town">
          <option value="">Select province first...</option>
        </select>
      </div>
    </div>
    <div class="form-row">
      <div class="form-field"><label class="form-label" for="pj-work-type">Work Type</label>
        <select class="form-select" id="pj-work-type">
          <option value="">Select work type...</option>
          <option value="onsite">On-site</option>
          <option value="hybrid">Hybrid</option>
          <option value="remote">Remote</option>
        </select>
      </div>
      <div class="form-field"><label class="form-label" for="pj-experience">Experience Required</label><select class="form-select" id="pj-experience"><option value="">Select level...</option><option value="entry">Entry Level</option><option value="junior">Junior</option><option value="mid">Mid-Level</option><option value="senior">Senior</option><option value="lead">Lead</option></select></div>
    </div>
    <div class="form-row">
      <div class="form-field"><label class="form-label" for="pj-urgency">Urgency Level</label>
        <select class="form-select" id="pj-urgency">
          <option value="">Standard</option>
          <option value="urgent">&#128308; Urgent</option>
          <option value="low">Low Priority</option>
        </select>
      </div>
      <div class="form-field"></div>
    </div>
    <div class="form-field">
      <label class="form-label">Required Skills</label>
      <div id="pj-skills-tags" style="display:flex;flex-wrap:wrap;gap:8px;min-height:42px;padding:8px 12px;border:1.5px solid #e5e7eb;border-radius:10px;background:#fff;align-items:center;cursor:text;" onclick="document.getElementById('pj-skills-input').focus()"></div>
      <input class="form-input" id="pj-skills-input" type="text" placeholder="Type a skill and press Enter..." style="margin-top:8px"/>
    </div>
    <div class="form-row">
      <div class="form-field"><label class="form-label" for="pj-salary-min">Salary Min (USD)</label><input class="form-input" id="pj-salary-min" type="number" placeholder="500" min="0"/></div>
      <div class="form-field"><label class="form-label" for="pj-salary-max">Salary Max (USD)</label><input class="form-input" id="pj-salary-max" type="number" placeholder="1500" min="0"/></div>
    </div>
    <div class="form-field"><label class="form-label" for="pj-description">Job Description</label><textarea class="form-textarea" id="pj-description" rows="5" placeholder="Describe the role, responsibilities, requirements, and what makes this opportunity unique..." required></textarea></div>
    <div class="form-row">
      <div class="form-field"><label class="form-label" for="pj-expires">Closing Date</label><input class="form-input" id="pj-expires" type="date"/></div>
      <div class="form-field"><label class="form-label" for="pj-status">Publication Status</label>
        <select class="form-select" id="pj-status">
          <option value="active">Active ‚Äî visible to candidates</option>
          <option value="draft">Draft ‚Äî saved, not published</option>
        </select>
      </div>
    </div>
    <button type="button" class="btn btn-primary" style="width:100%;justify-content:center;margin-top:10px" id="pj-submit-btn">Post Position ‚Üí</button>
  </div>
</div>

<!-- CANDIDATE DETAIL MODAL -->
<div class="modal-overlay" id="candidate-modal" role="dialog" aria-modal="true" aria-label="Candidate Profile">
  <div class="modal modal-wide">
    <button type="button" class="modal-close" id="candidate-modal-close" aria-label="Close modal">‚úï</button>
    <div id="candidate-detail-content"></div>
  </div>
</div>

<!-- CAREER CENTRE MODAL -->
<div class="modal-overlay" id="career-modal" role="dialog" aria-modal="true" aria-label="Career Resources">
  <div class="modal modal-wide" style="max-width:780px">
    <button type="button" class="modal-close" id="career-modal-close" aria-label="Close modal">‚úï</button>
    <div class="modal-title" id="career-modal-title">Career Resources</div>
    <div style="overflow-y:auto;max-height:72vh;padding-right:5px" id="career-modal-body"></div>
  </div>
</div>

<!-- ADMIN PORTAL MODAL -->
<div class="modal-overlay" id="admin-portal-modal">
  <div class="modal" style="max-width:380px">
    <button class="modal-close" id="admin-portal-close">‚úï</button>
    <div class="modal-title">üîê Admin Portal</div>
    <div class="modal-sub">Enter the admin password to access the control panel</div>
    <div id="admin-portal-toast" class="toast" role="alert"></div>
    <div class="form-field">
      <label class="form-label" for="admin-portal-pass">Admin Password</label>
      <input class="form-input" id="admin-portal-pass" type="password" placeholder="Enter password..."/>
    </div>
    <button type="button" class="btn btn-primary" style="width:100%;justify-content:center;margin-top:8px" id="admin-portal-submit">Access Admin ‚Üí</button>
  </div>
</div>

<!-- WA INTERVIEW MODAL -->
<div class="modal-overlay" id="wa-interview-modal">
  <div class="modal" style="max-width:480px">
    <button class="modal-close" id="wa-interview-close">‚úï</button>
    <div class="modal-title">üí¨ Book Interview via WhatsApp</div>
    <div class="modal-sub">Customise your message before sending</div>
    <div class="form-field">
      <label class="form-label" for="wa-interview-date">Preferred Date</label>
      <input class="form-input" id="wa-interview-date" type="date"/>
    </div>
    <div class="form-field">
      <label class="form-label" for="wa-interview-time">Preferred Time</label>
      <input class="form-input" id="wa-interview-time" type="time" value="10:00"/>
    </div>
    <div class="form-field">
      <label class="form-label" for="wa-interview-msg">Message Preview (editable)</label>
      <textarea class="form-textarea" id="wa-interview-msg" rows="5"></textarea>
    </div>
    <a class="btn btn-block" id="wa-interview-send" href="#" target="_blank" rel="noopener noreferrer" style="justify-content:center;background:linear-gradient(135deg,#25D366,#128c7e);color:white;font-weight:600;border-radius:50px;padding:13px;text-align:center;text-decoration:none;display:block;margin-top:8px;">
      üì≤ Open WhatsApp ‚Üí
    </a>
  </div>
</div>

<!-- SEEKER SELF MATCH MODAL -->
<div class="modal-overlay" id="seeker-match-modal">
  <div class="modal modal-wide">
    <button class="modal-close" id="seeker-match-close">‚úï</button>
    <div class="modal-title">ü§ñ AI Match Test</div>
    <div class="modal-sub" id="seeker-match-sub">Testing your profile against this job...</div>
    <div id="seeker-match-content"></div>
  </div>
</div>

<!-- DELETE ACCOUNT MODAL -->
<div class="modal-overlay" id="delete-account-modal">
  <div class="modal" style="max-width:400px">
    <button class="modal-close" id="delete-account-modal-close">‚úï</button>
    <div class="modal-title" style="color:#dc2626">‚ö†Ô∏è Delete Account</div>
    <div class="modal-sub">This action is permanent and cannot be undone. All your data will be removed from ZimGetHired.</div>
    <div id="delete-account-toast" class="toast" role="alert"></div>
    <div class="form-field">
      <label class="form-label" for="delete-confirm-text">Type <strong>DELETE</strong> to confirm</label>
      <input class="form-input" id="delete-confirm-text" type="text" placeholder="Type DELETE here"/>
    </div>
    <button type="button" class="btn btn-danger btn-block" id="delete-account-confirm-btn" style="justify-content:center;margin-top:8px">üóëÔ∏è Permanently Delete Account</button>
  </div>
</div>

<!-- VIRTUAL JOB FAIR BADGE -->
<button type="button" class="vjf-badge" id="vjf-badge" aria-label="Virtual Job Fair - Sign up">
  <span class="live-dot"></span>
  Virtual Job Fair ‚Äî Dec 20
</button>

<!-- FOOTER -->
<footer id="main-footer">
  <div class="footer-inner">
    <div class="footer-grid">
      <div>
        <div class="footer-brand-name">Zim<em>Get</em>Hired</div>
        <p class="footer-desc">Zimbabwe's AI-powered talent intelligence platform. Connecting the country's professionals with its most ambitious employers.</p>
        <div style="margin-top:15px;font-size:13px;color:rgba(255,255,255,0.5)">Proudly Zimbabwean üáøüáº</div>
      </div>
      <div>
        <div class="footer-col-title">Platform</div>
        <span class="footer-link" id="footer-jobs">Job Board</span>
        <span class="footer-link" id="footer-post">Post a Job</span>
        <span class="footer-link" id="footer-salary">Salary Guide</span>
        <span class="footer-link" id="footer-news">Market Pulse</span>
      </div>
      <div>
        <div class="footer-col-title">Job Seekers</div>
        <span class="footer-link" onclick="openAuth('signup')">Create Profile</span>
        <span class="footer-link" onclick="openAuth('login')">Sign In</span>
        <span class="footer-link" id="footer-cv-templates">CV Templates</span>
        <span class="footer-link" id="footer-salary2">Salary Guide</span>
      </div>
      <div>
        <div class="footer-col-title">Employers</div>
        <span class="footer-link" onclick="openAuth('signup')">Post a Job Free</span>
        <span class="footer-link" onclick="openAuth('login')">Employer Login</span>
        <span class="footer-link" id="footer-market-pulse">Market Pulse</span>
      </div>
    </div>
    <div class="footer-bottom">
      <span class="footer-copy">¬© 2025 ZimGetHired. Proudly Zimbabwean üáøüáº</span>
      <div style="display:flex;align-items:center;gap:16px;">
        <span style="font-size:12px;color:rgba(255,255,255,0.4)">Made with ‚ù§Ô∏è for Zimbabwe's workforce</span>
        <button id="admin-portal-btn" style="font-size:11px;color:rgba(255,255,255,0.35);cursor:pointer;background:none;border:none;font-family:'Poppins',sans-serif;transition:color 0.3s ease;padding:4px 8px;border-radius:6px;" onmouseover="this.style.color='rgba(255,255,255,0.7)'" onmouseout="this.style.color='rgba(255,255,255,0.35)'">üîê Admin Portal</button>
      </div>
    </div>
  </div>
</footer>

<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ZimGetHired ‚Äî v10
// v10: Clean BASE_STATS social-proof inflation (client-side only, no DB writes).
//      BASE_STATS adds baseline to live Supabase counts for hero stats, stats bar,
//      and ticker. Demo seekers/jobs remain client-side for matching engine only.
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const ZGH = (() => {
  'use strict'

  // ===== CONFIG =============================================================
  const SUPABASE_URL  = 'https://sbqylafkgsrorzbhgras.supabase.co'
  const SUPABASE_ANON = 'sb_publishable_nVTWcqmNvsKYZiXp8i6dDQ_n1BmwHs-'
  const ADMIN_EMAILS  = ['admin@zimgethired.co.zw']

  // ===== STATIC DATA ========================================================


  const SALARY_DATA = [
    { role:'Software Engineer',    sector:'Technology',      min:600,  mid:1200, max:2500, trend:'+28% ‚Üë', up:true },
    { role:'Data Analyst',         sector:'Technology',      min:450,  mid:850,  max:1600, trend:'+34% ‚Üë', up:true },
    { role:'Accountant',           sector:'Finance',         min:500,  mid:900,  max:1800, trend:'+12% ‚Üë', up:true },
    { role:'Civil Engineer',       sector:'Construction',    min:700,  mid:1100, max:2000, trend:'+18% ‚Üë', up:true },
    { role:'Marketing Manager',    sector:'Business',        min:400,  mid:750,  max:1400, trend:'+15% ‚Üë', up:true },
    { role:'Sales Representative', sector:'Sales',           min:350,  mid:600,  max:1000, trend:'+10% ‚Üë', up:true },
    { role:'Nurse / Midwife',      sector:'Healthcare',      min:300,  mid:550,  max:900,  trend:'+22% ‚Üë', up:true },
    { role:'Teacher',              sector:'Education',       min:200,  mid:380,  max:650,  trend:'+8% ‚Üë',  up:true },
    { role:'Graphic Designer',     sector:'Creative',        min:250,  mid:500,  max:1000, trend:'+20% ‚Üë', up:true },
    { role:'Project Manager',      sector:'Management',      min:600,  mid:1050, max:1900, trend:'+16% ‚Üë', up:true },
    { role:'HR Manager',           sector:'Human Resources', min:750,  mid:1100, max:1800, trend:'+14% ‚Üë', up:true },
    { role:'Admin Assistant',      sector:'Administration',  min:280,  mid:420,  max:650,  trend:'+6% ‚Üë',  up:true },
    { role:'Driver / Logistics',   sector:'Logistics',       min:180,  mid:300,  max:500,  trend:'-3% ‚Üì',  up:false }
  ]

  const NEWS_DATA = [
    { cat:'TELECOM',     title:'Econet InfraCo Expands Fiber Network Across Zimbabwe', excerpt:'Econet InfraCo has announced a massive fiber optic expansion across Harare, Bulawayo, Gweru, Mutare, and Masvingo ‚Äî creating over 400 technical jobs in the next 12 months. Roles include fiber technicians, network engineers, customer service reps, and sales professionals.', date:'Jan 2026' },
    { cat:'MINING',      title:'Zimbabwe\'s Lithium Mining Boom Creates 5,000+ Jobs', excerpt:'New mines opening in Goromonzi, Mutoko, and the Midlands region are projected to create over 5,000 direct and 15,000 indirect jobs by end of 2026. Entry-level positions start at $600‚Äì$800/month; experienced professionals earn $1,500‚Äì$3,000.', date:'Jan 2026' },
    { cat:'AGRICULTURE', title:'Record Tobacco Season Opens Strong ‚Äî Thousands of Jobs', excerpt:'Zimbabwe\'s 2026 tobacco season has opened with record volumes. Over 8,000 seasonal and permanent positions are available across farms, auction floors, processing facilities, and logistics. Peak hiring runs through March across Harare, Chinhoyi, Karoi.', date:'Jan 2026' },
    { cat:'ECONOMY',     title:'Zimbabwe GDP Growth Hits 8.5% ‚Äî Economic Expansion Creates Jobs', excerpt:'The IMF projects Zimbabwe\'s economy to grow 8.5% in 2026, driven by mining, agriculture, and tourism. Over 200,000 new formal-sector jobs are projected. In-demand skills: digital literacy, financial management, customer service, and technical specialisations.', date:'Jan 2026' },
    { cat:'TECH HUB',    title:'Victoria Falls Tech Hub Launches ‚Äî 200+ Digital Jobs Created', excerpt:'A new technology and innovation hub in Victoria Falls has officially launched, creating over 200 jobs in its first year. Starting salaries range from $800‚Äì$1,500/month. Free training in coding, digital marketing, and graphic design is available for qualifying applicants.', date:'Dec 2025' }
  ]

  // ===== PLATFORM BASE STATS ================================================
  // Social-proof baseline ‚Äî added to live Supabase counts before rendering.
  // These are client-side constants only. No DB writes. No table required.
  const BASE_STATS = { jobs:29, seekers:134, employers:89, applications:62 }  // baseline displayed; live DB counts add on top

  // ===== DEMO SEED DATA (injected into matching engine only ‚Äî no DB writes) ==
  const DEMO_SEEKERS = [
    { user_id:'demo-1', full_name:'Tendai Moyo',       location:'Harare',   roles:['Software Engineer','Frontend Developer'], skills:['React','JavaScript','HTML','CSS','Node.js'], experience_level:'mid',    personality_type:'analytical', bio:'5 years building web apps.' },
    { user_id:'demo-2', full_name:'Rudo Ncube',        location:'Bulawayo', roles:['Data Analyst','BI Developer'],             skills:['Python','SQL','Power BI','Excel','Tableau'], experience_level:'junior', personality_type:'analytical', bio:'Turning data into decisions.' },
    { user_id:'demo-3', full_name:'Farai Zimba',       location:'Harare',   roles:['Project Manager','Operations Manager'],   skills:['Agile','Scrum','Risk Management','MS Project','Communication'], experience_level:'senior', personality_type:'leader', bio:'Delivered 20+ projects on time.' },
    { user_id:'demo-4', full_name:'Chiedza Maposa',    location:'Harare',   roles:['Marketing Manager','Digital Marketer'],   skills:['SEO','Google Ads','Social Media','Content Marketing','Analytics'], experience_level:'mid',    personality_type:'creative', bio:'Grew brand reach by 300%.' },
    { user_id:'demo-5', full_name:'Tafadzwa Banda',    location:'Gweru',    roles:['Civil Engineer','Site Engineer'],          skills:['AutoCAD','Structural Analysis','Project Management','Safety','Concrete'], experience_level:'mid',    personality_type:'executor', bio:'Built infrastructure across 3 provinces.' },
    { user_id:'demo-6', full_name:'Nyasha Mutasa',     location:'Harare',   roles:['Accountant','Financial Analyst'],          skills:['IFRS','QuickBooks','Excel','Budgeting','Tax Compliance'], experience_level:'senior', personality_type:'analytical', bio:'CPA with 8 years in corporate finance.' },
    { user_id:'demo-7', full_name:'Simba Chikwanda',   location:'Harare',   roles:['Fiber Technician','Network Engineer'],     skills:['Fiber Optic','Networking','FTTH','Splicing','Troubleshooting'], experience_level:'junior', personality_type:'executor', bio:'2 years at Econet infrastructure.' },
    { user_id:'demo-8', full_name:'Aisha Gumbo',       location:'Victoria Falls', roles:['Graphic Designer','UI Designer'],    skills:['Figma','Photoshop','Illustrator','Branding','Motion Design'], experience_level:'mid',    personality_type:'creative', bio:'Award-winning designer from VicFalls.' },
    { user_id:'demo-9', full_name:'Brian Chisvo',      location:'Harare',   roles:['Sales Representative','Business Dev'],    skills:['CRM','Negotiation','Cold Calling','B2B Sales','Customer Service'], experience_level:'entry',  personality_type:'collaborator', bio:'Exceeded targets 3 quarters running.' },
    { user_id:'demo-10',full_name:'Tatenda Chirwa',    location:'Mutare',   roles:['HR Manager','HR Officer'],                 skills:['Recruitment','Labour Law','HRIS','Performance Management','Training'], experience_level:'senior', personality_type:'leader', bio:'Managed HR for 500+ employee firm.' },
    { user_id:'demo-11',full_name:'Kudzai Sithole',    location:'Harare',   roles:['Mining Engineer','Safety Officer'],        skills:['Mine Planning','Safety Protocols','Heavy Machinery','Geology','SHEQ'], experience_level:'mid',    personality_type:'executor', bio:'5 years in Midlands lithium ops.' },
    { user_id:'demo-12',full_name:'Plaxedes Mwale',    location:'Harare',   roles:['Nurse','Clinical Officer'],                skills:['Patient Care','ICU','Triage','Medical Records','Pharmacology'], experience_level:'mid',    personality_type:'collaborator', bio:'Registered nurse, Parirenyatwa Hospital.' },
    { user_id:'demo-13',full_name:'Danai Makoni',      location:'Harare',   roles:['Teacher','Education Coordinator'],         skills:['Curriculum Design','Classroom Management','A-Level','STEM','Mentoring'], experience_level:'senior', personality_type:'collaborator', bio:'10 years shaping futures in education.' },
    { user_id:'demo-14',full_name:'Tapiwa Nhema',      location:'Harare',   roles:['Full Stack Developer','Backend Engineer'], skills:['Python','Django','PostgreSQL','Docker','AWS','REST APIs'], experience_level:'senior', personality_type:'analytical', bio:'Built SaaS products serving 50K users.' },
    { user_id:'demo-15',full_name:'Ruvimbo Dube',      location:'Bulawayo', roles:['Logistics Manager','Driver','Supply Chain'],skills:['Fleet Management','Route Planning','ERP','Warehouse','Cross-border'], experience_level:'mid',    personality_type:'executor', bio:'Managed 30-truck fleet across SADC.' },
    { user_id:'demo-16',full_name:'Tinashe Mpofu',     location:'Harare',   roles:['Digital Marketer','Content Creator'],      skills:['TikTok','Instagram','Video Editing','Copywriting','Email Marketing'], experience_level:'entry',  personality_type:'creative', bio:'Built brands from zero to viral.' },
    { user_id:'demo-17',full_name:'Maidei Mhuriro',    location:'Harare',   roles:['Admin Assistant','Office Manager'],        skills:['Microsoft Office','Scheduling','Communication','Filing','Customer Service'], experience_level:'junior', personality_type:'collaborator', bio:'Organised, reliable, and proactive.' },
    { user_id:'demo-18',full_name:'Zviko Mushore',     location:'Chinhoyi', roles:['Agriculture Supervisor','Farm Manager'],   skills:['Tobacco','Crop Management','Irrigation','Labour Supervision','AgriFinance'], experience_level:'senior', personality_type:'leader', bio:'20 years in commercial tobacco farming.' },
    { user_id:'demo-19',full_name:'Claris Makamure',   location:'Harare',   roles:['Customer Service','Call Centre Agent'],    skills:['Conflict Resolution','Zendesk','CRM','Empathy','Product Knowledge'], experience_level:'entry',  personality_type:'collaborator', bio:'Passionate about customer experience.' },
    { user_id:'demo-20',full_name:'Prosper Chisumbe',  location:'Victoria Falls', roles:['Tech Trainer','Software Developer'],  skills:['Coding','Digital Marketing','Graphic Design','Training','JavaScript'], experience_level:'mid',    personality_type:'creative', bio:'VicFalls Tech Hub founding trainer.' }
  ]
  // Normalize demo seekers: add province alias from location, add demo whatsapp
  const _demoWaNumbers = ['263771000001','263772000002','263773000003','263774000004','263775000005','263776000006','263777000007','263778000008','263779000009','263771000010','263772000011','263773000012','263774000013','263775000014','263776000015']
  DEMO_SEEKERS.forEach((s, i) => {
    if (!s.province) s.province = s.location || ''
    if (!s.whatsapp) s.whatsapp = _demoWaNumbers[i] || '263771000000'
  })

  const DEMO_JOBS = [
    { id:'demo-job-1',  title:'Fiber Network Technician',      primary_role:'Fiber Technician',    required_skills:'Fiber Optic,Splicing,FTTH,Networking,Troubleshooting', experience:'Junior to Mid Level', location:'Harare',         employment:'full-time', salary_min:600,  salary_max:900,  description:'Join Econet InfraCo in expanding Zimbabwe\'s fiber optic network. Install, splice, and maintain fiber connections across Harare metro. Part of the national 400-job expansion.',                        status:'active', urgency_level:'urgent',   expires_at:'2026-03-31' },
    { id:'demo-job-2',  title:'Mining Safety Officer',          primary_role:'Safety Officer',      required_skills:'Safety Protocols,SHEQ,Mine Planning,Heavy Machinery,Risk Assessment', experience:'Mid Level',       location:'Gweru',          employment:'full-time', salary_min:1200, salary_max:1800, description:'Oversee safety compliance at lithium mine in the Midlands. Part of Zimbabwe\'s booming lithium sector expansion creating 5,000+ jobs.',                                                                    status:'active', urgency_level:'urgent',   expires_at:'2026-02-28' },
    { id:'demo-job-3',  title:'Tobacco Farm Supervisor',        primary_role:'Agriculture Supervisor', required_skills:'Tobacco,Crop Management,Labour Supervision,Irrigation', experience:'Senior',           location:'Chinhoyi',       employment:'full-time', salary_min:800,  salary_max:1400, description:'Supervise seasonal workers and manage crop operations during Zimbabwe\'s record 2026 tobacco season. Accommodation and meals provided.',                                                                    status:'active', urgency_level:null,       expires_at:'2026-04-30' },
    { id:'demo-job-4',  title:'Full Stack Developer',            primary_role:'Software Engineer',   required_skills:'React,Node.js,PostgreSQL,Docker,REST APIs,JavaScript',  experience:'Mid to Senior',   location:'Harare',         employment:'full-time', salary_min:1200, salary_max:2200, description:'Build and scale web applications for Zimbabwe\'s fastest-growing fintech startup. Remote-friendly. Part of 200,000 new formal-sector jobs projected for 2026.',                                         status:'active', urgency_level:null,       expires_at:'2026-03-15' },
    { id:'demo-job-5',  title:'Digital Marketing Manager',       primary_role:'Marketing Manager',   required_skills:'SEO,Google Ads,Social Media,Analytics,Content Marketing', experience:'Mid Level',       location:'Harare',         employment:'full-time', salary_min:700,  salary_max:1200, description:'Lead digital marketing for a fast-growing e-commerce brand targeting the Zimbabwe diaspora market. Hybrid role ‚Äî 3 days in Harare office.',                                                              status:'active', urgency_level:null,       expires_at:'2026-03-20' },
    { id:'demo-job-6',  title:'Tech Hub Trainer',                primary_role:'Tech Trainer',        required_skills:'Coding,Digital Marketing,Graphic Design,Training,JavaScript', experience:'Mid Level',    location:'Victoria Falls', employment:'full-time', salary_min:800,  salary_max:1200, description:'Deliver coding and digital skills training at the new Victoria Falls Tech Hub. Free training programs for 500+ applicants per intake.',                                                                  status:'active', urgency_level:'urgent',   expires_at:'2026-02-20' },
    { id:'demo-job-7',  title:'Data Analyst ‚Äî Mining Sector',    primary_role:'Data Analyst',        required_skills:'Python,SQL,Power BI,Excel,Tableau',                          experience:'Junior to Mid', location:'Harare',         employment:'full-time', salary_min:900,  salary_max:1500, description:'Analyse production data for lithium and gold mining operations. Report to CFO on efficiency metrics, cost optimisation, and compliance reporting.',                                                       status:'active', urgency_level:null,       expires_at:'2026-03-10' },
    { id:'demo-job-8',  title:'HR Officer',                       primary_role:'HR Officer',          required_skills:'Recruitment,Labour Law,HRIS,Performance Management',         experience:'Mid Level',      location:'Harare',         employment:'full-time', salary_min:700,  salary_max:1100, description:'Support HR operations for a logistics company with 300+ employees across Zimbabwe. Focus on recruitment, compliance, and performance management.',                                                         status:'active', urgency_level:null,       expires_at:'2026-03-05' },
    { id:'demo-job-9',  title:'Customer Service Representative',  primary_role:'Customer Service',    required_skills:'Customer Service,CRM,Zendesk,Conflict Resolution,Communication', experience:'Entry Level', location:'Harare',         employment:'full-time', salary_min:400,  salary_max:650,  description:'Join our growing customer success team serving Zimbabwe\'s digital banking clients. Full training provided. Part of the financial sector\'s expanding workforce.',                                     status:'active', urgency_level:null,       expires_at:'2026-04-01' },
    { id:'demo-job-10', title:'Civil Engineer ‚Äî Infrastructure',  primary_role:'Civil Engineer',      required_skills:'AutoCAD,Structural Analysis,Project Management,Safety,Concrete', experience:'Mid to Senior', location:'Gweru',         employment:'full-time', salary_min:1100, salary_max:2000, description:'Work on road and bridge infrastructure projects across Zimbabwe as part of government\'s 2026 infrastructure expansion plan. ZINARA-funded project.',                                                    status:'active', urgency_level:null,       expires_at:'2026-03-25' }
  ]
  // Normalize demo jobs: add province from location field
  DEMO_JOBS.forEach(j => { if (!j.province) j.province = j.location || '' })



  // ===== STATE ==============================================================
  let sb             = null
  let currentProfile = null   // cached in memory
  let allPublicJobs  = []
  let empJobs        = []
  let empApps        = []
  let seekerProfile  = null
  let seekerRoles            = []
  let seekerSkills           = []
  let seekerCertifications   = []
  let seekerLanguages        = []
  let seekerIndustryPrefs    = []
  let seekerPicUrl           = null   // profile_picture_url ‚Äî seeker
  let seekerCvUrl            = null   // cv_url from storage upload
  let seekerVideoUrl         = null   // intro_video_url from storage upload
  let empPicUrl              = null   // profile_picture_url ‚Äî employer
  let searchHistory  = []
  let dataSaverOn    = false
  let _dashRendered  = false  // guard: prevent duplicate dashboard renders
  let _pubSearchTimer = null  // debounce handle

  // ===== UTILITIES ==========================================================

  // DOM helpers
  const el      = id => document.getElementById(id)
  const v       = id => { const e = el(id); return e ? e.value : '' }
  const setText = (id, val) => { const e = el(id); if (e) e.textContent = val }

  // ‚îÄ‚îÄ escapeHTML: single canonical XSS utility ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function escapeHTML(s) {
    if (s == null) return ''
    return String(s)
      .replace(/&/g, '&amp;')
      .replace(/</g, '&lt;')
      .replace(/>/g, '&gt;')
      .replace(/"/g, '&quot;')
      .replace(/'/g, '&#39;')
  }
  const esc = escapeHTML  // short alias used throughout

  // ‚îÄ‚îÄ Misc helpers ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function initials(name) {
    return (name || '?').split(' ').filter(Boolean).map(w => w[0]).join('').toUpperCase().slice(0, 2)
  }
  function fmtDate(ts) {
    if (!ts) return '‚Äî'
    return new Date(ts).toLocaleDateString('en-GB', { year:'numeric', month:'short', day:'numeric' })
  }
  function fmtSal(min, max) {
    if (!min && !max) return ''
    const f = n => '$' + Number(n).toLocaleString()
    if (min && max) return f(min) + '‚Äì' + f(max)
    return min ? 'From ' + f(min) : 'Up to ' + f(max)
  }
  function emptyHTML(icon, title, sub) {
    return `<div class="empty-state"><span class="empty-icon">${icon}</span><div class="empty-title">${esc(title)}</div><div class="empty-sub">${esc(sub)}</div></div>`
  }
  function csvSplit(str) {
    if (Array.isArray(str)) return str.filter(Boolean)
    return str ? str.split(',').map(s => s.trim()).filter(Boolean) : []
  }

  // ‚îÄ‚îÄ Button loading guard (prevents double-submit) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function setBtn(id, disabled, label) {
    const b = el(id); if (!b) return
    b.disabled = disabled
    b.innerHTML = disabled ? `<span class="spinner"></span> ${label}` : label
  }

  // ‚îÄ‚îÄ Toast ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function showToast(id, msg, type) {
    const e = el(id); if (!e) return
    e.innerHTML = msg          // msg is already esc()-ed by callers where needed
    e.className = `toast show ${type}`
    setTimeout(() => e.classList.remove('show'), 5000)
  }

  // ‚îÄ‚îÄ Centralised error handler ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function handleError(err, toastId) {
    const msg = err?.message || 'Something went wrong. Please try again.'
    console.error('[ZGH Error]', err)
    if (toastId) showToast(toastId, esc(msg), 'error')
    return msg
  }

  // ‚îÄ‚îÄ Storage upload helper ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  async function uploadFileToStorage(bucket, path, file) {
    const { error } = await sb.storage.from(bucket).upload(path, file, { upsert: true })
    if (error) throw error
    const { data: urlData } = sb.storage.from(bucket).getPublicUrl(path)
    return urlData.publicUrl
  }

  // ‚îÄ‚îÄ Avatar display helpers ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function renderAvatarEl(elId, picUrl, name) {
    const wrap = el(elId)
    if (!wrap) return
    if (picUrl) {
      wrap.innerHTML = `<img src="${esc(picUrl)}" style="width:100%;height:100%;object-fit:cover;border-radius:50%"/>`
    } else {
      wrap.textContent = initials(name || '?')
    }
  }

  // ‚îÄ‚îÄ Modal controller ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  // Tracks which modal is open so ESC can close it
  let _activeModalId = null

  function openModal(id) {
    const e = el(id); if (!e) return
    if (_activeModalId && _activeModalId !== id) closeModal(_activeModalId)
    e.classList.add('open')
    _activeModalId = id
    document.body.style.overflow = 'hidden'
  }

  function closeModal(id) {
    const e = el(id); if (!e) return
    e.classList.remove('open')
    if (_activeModalId === id) {
      _activeModalId = null
      document.body.style.overflow = ''
    }
  }

  function closeAllModals() {
    document.querySelectorAll('.modal-overlay.open').forEach(m => m.classList.remove('open'))
    _activeModalId = null
    document.body.style.overflow = ''
  }

  function scrollTo2(id) { const e = el(id); if (e) e.scrollIntoView({ behavior:'smooth', block:'start' }) }

  function openAuth(tab) { openModal('auth-modal'); switchAuthTab(tab) }
  function switchAuthTab(tab) {
    el('auth-modal-login').classList.toggle('hidden', tab !== 'login')
    el('auth-modal-signup').classList.toggle('hidden', tab !== 'signup')
    const forgotEl = el('auth-modal-forgot')
    if (forgotEl) forgotEl.classList.toggle('hidden', tab !== 'forgot')
  }

  // ===== AUTH ===============================================================

  async function handleSignup() {
    const name  = v('su-name').trim()
    const email = v('su-email').trim()
    const pass  = v('su-password')
    const role  = v('su-role')
    if (!name || !email || !pass) return showToast('signup-toast', 'All fields are required.', 'error')
    if (pass.length < 8) return showToast('signup-toast', 'Password must be at least 8 characters.', 'error')
    setBtn('signup-btn', true, 'Creating Account...')
    try {
      const { error } = await sb.auth.signUp({
        email, password: pass,
        options: { data: { full_name: name, role } }
      })
      if (error) throw error
      showToast('signup-toast', 'Account created! Check your email to confirm, then sign in.', 'success')
      // Refresh stats so seeker/employer count updates
      loadPublicStats()
    } catch (err) {
      if (err?.code === '23505' || err?.message?.includes('already registered')) {
        showToast('signup-toast', 'An account with this email already exists. Please sign in.', 'error')
      } else {
        handleError(err, 'signup-toast')
      }
    } finally {
      setBtn('signup-btn', false, 'Create Account ‚Üí')
    }
  }

  async function handleLogin() {
    const email = v('auth-email').trim()
    const pass  = v('auth-password')
    if (!email || !pass) return showToast('auth-toast', 'Email and password required.', 'error')
    setBtn('login-btn', true, 'Signing in...')
    try {
      const { error } = await sb.auth.signInWithPassword({ email, password: pass })
      if (error) throw error
      closeModal('auth-modal')
    } catch (err) {
      if (err?.message?.includes('Invalid login credentials') || err?.message?.includes('Email not confirmed')) {
        showToast('auth-toast', err.message, 'error')
      } else {
        handleError(err, 'auth-toast')
      }
    } finally {
      setBtn('login-btn', false, 'Sign In ‚Üí')
    }
  }


  async function handleForgotPassword() {
    const email = v('forgot-email').trim()
    if (!email) return showToast('forgot-toast', 'Please enter your email address.', 'error')
    setBtn('forgot-submit-btn', true, 'Sending...')
    try {
      const { error } = await sb.auth.resetPasswordForEmail(email, {
        redirectTo: window.location.origin + window.location.pathname
      })
      if (error) throw error
      showToast('forgot-toast', '‚úÖ Password reset link sent! Check your email inbox.', 'success')
    } catch (err) { handleError(err, 'forgot-toast') }
    finally { setBtn('forgot-submit-btn', false, 'Send Reset Link ‚Üí') }
  }

  async function handleLogout() {
    try { await sb.auth.signOut() } catch (err) { console.error('[Logout]', err) }
    currentProfile = null
    showPublic()
    updateNavAuth(false)
  }

  // ‚îÄ‚îÄ Load profile from DB (never trusts client-side only) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  async function loadProfile(authUser) {
    try {
      const { data, error } = await sb
        .from('users')
        .select('id,role,full_name,created_at')
        .eq('id', authUser.id)
        .single()
      if (error) {
        // PGRST116 = row not found (new user pre-trigger)
        if (error.code !== 'PGRST116') throw error
      }
      const profile = data ? {
        ...data,
        email: authUser.email
      } : {
        id:         authUser.id,
        full_name:  authUser.user_metadata?.full_name ?? authUser.email?.split('@')[0] ?? 'User',
        email:      authUser.email,
        role:       authUser.user_metadata?.role ?? 'jobseeker',
        created_at: authUser.created_at
      }
      currentProfile = profile
      return profile
    } catch (err) {
      console.warn('[loadProfile] fallback to auth metadata:', err.message)
      const fallback = {
        id:         authUser.id,
        full_name:  authUser.user_metadata?.full_name ?? authUser.email?.split('@')[0] ?? 'User',
        email:      authUser.email,
        role:       authUser.user_metadata?.role ?? 'jobseeker',
        created_at: authUser.created_at
      }
      currentProfile = fallback
      return fallback
    }
  }

  // ===== MATCH ENGINE =======================================================

  function normTokens(arr) {
    return arr.filter(Boolean).map(s => s.toString().toLowerCase().trim()).filter(s => s.length > 1)
  }
  function expIdx(str, levels) {
    if (!str) return -1
    const l = str.toLowerCase()
    for (let i = 0; i < levels.length; i++) if (l.includes(levels[i])) return i
    return -1
  }
  function matchLabel(s, gem) {
    if (gem)   return 'Hidden Gem'
    if (s>=90) return 'Premium Match'
    if (s>=75) return 'Strong Match'
    if (s>=60) return 'Potential Fit'
    return 'Hidden Gem'
  }
  function matchClass(l) {
    if (l==='Premium Match') return 'match-premium'
    if (l==='Strong Match')  return 'match-strong'
    if (l==='Potential Fit') return 'match-fit'
    return 'match-gem'
  }

  function computeMatch(job, seeker) {
    // ‚îÄ‚îÄ Skill overlap ‚Üí 40 pts ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    const jSkills = normTokens(csvSplit(job.required_skills || ''))
    const sSkills = normTokens(Array.isArray(seeker.skills) ? seeker.skills : (seeker.skills || []))
    let skillScore = jSkills.length ? 0 : 16
    if (jSkills.length && sSkills.length) {
      const m = jSkills.filter(js => sSkills.some(ss => ss.includes(js) || js.includes(ss)))
      skillScore = Math.min(40, Math.round((m.length / jSkills.length) * 40))
    }

    // ‚îÄ‚îÄ Experience match ‚Üí 20 pts ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    const levels = ['intern','entry','junior','mid','senior','lead','principal','manager','director','executive']
    const jIdx = expIdx(job.experience, levels)
    // Support both years_experience (numeric) and experience_level (string)
    let sIdx = expIdx(seeker.experience_level, levels)
    const _yrs = Number(seeker.years_experience) || 0
    if (sIdx < 0 && _yrs > 0) {
      sIdx = _yrs <= 1 ? 1 : _yrs <= 2 ? 2 : _yrs <= 5 ? 3 : _yrs <= 8 ? 4 : 5
    }
    const _minExp = Number(job.min_experience) || 0
    let expScore = 10
    if (jIdx >= 0 && sIdx >= 0) {
      const d = Math.abs(jIdx - sIdx)
      expScore = d===0 ? 20 : d===1 ? 14 : d===2 ? 7 : 2
    }

    // ‚îÄ‚îÄ Salary compatibility ‚Üí 15 pts ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    let salaryScore = 0
    const jSalMin = Number(job.salary_min) || 0
    const jSalMax = Number(job.salary_max) || 0
    const sSalMin = Number(seeker.salary_min) || 0
    const sSalMax = Number(seeker.salary_max) || 0
    if (jSalMin > 0 || jSalMax > 0) {
      const jMid = jSalMax > 0 ? (jSalMin + jSalMax) / 2 : jSalMin
      const sMid = sSalMax > 0 ? (sSalMin + sSalMax) / 2 : sSalMin
      if (sMid > 0 && jMid > 0) {
        const ratio = Math.min(jMid, sMid) / Math.max(jMid, sMid)
        salaryScore = Math.round(ratio * 15)
      } else {
        salaryScore = 8 // no seeker salary set ‚Äî neutral
      }
    } else {
      salaryScore = 8 // no job salary set ‚Äî neutral
    }

    // ‚îÄ‚îÄ Location match ‚Üí 15 pts ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    const jProv = ((job.province || job.location || '')).toLowerCase().trim()
    const sProv = ((seeker.province || seeker.location || '')).toLowerCase().trim()
    let locScore = 0
    if (seeker.willing_to_relocate) {
      locScore = 10
    } else if (jProv && sProv) {
      locScore = jProv===sProv ? 15 : (jProv.includes(sProv)||sProv.includes(jProv)) ? 9 : 0
    }

    // ‚îÄ‚îÄ Work type match ‚Üí 10 pts ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    let workTypeScore = 0
    const jWork = ((job.employment_type || job.work_type || job.employment || '')).toLowerCase().trim()
    const sWork = ((seeker.preferred_work_type || '')).toLowerCase().trim()
    if (jWork && sWork) {
      workTypeScore = jWork === sWork ? 10 : (jWork.includes(sWork)||sWork.includes(jWork)) ? 6 : 0
    } else {
      workTypeScore = 5 // neutral when not specified
    }

    // ‚îÄ‚îÄ Education level ‚Äî small bonus up to 5 pts ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    const eduLevels = ['high_school','diploma','degree','masters','phd']
    const jEduMin = eduLevels.indexOf(job.education_required||'')
    const sEdu    = eduLevels.indexOf(seeker.education_level||'')
    let eduBonus = 0
    if (jEduMin >= 0 && sEdu >= 0) {
      eduBonus = sEdu >= jEduMin ? 5 : sEdu === jEduMin - 1 ? 2 : 0
    }

    // ‚îÄ‚îÄ Role alignment (no longer scored separately ‚Äî reflected in skills) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    const jRoles = normTokens([job.primary_role, job.title])
    const sRoles = normTokens(Array.isArray(seeker.roles) ? seeker.roles : (seeker.roles || []))
    let roleScore = 0
    if (jRoles.length && sRoles.length) {
      const exact = jRoles.filter(r => sRoles.some(s => s === r || s.includes(r) || r.includes(s)))
      roleScore = Math.min(10, Math.round((exact.length / jRoles.length) * 10))
      if (!roleScore) {
        const jw = jRoles.join(' ').split(' ').filter(w => w.length > 3)
        const sw = sRoles.join(' ').split(' ')
        roleScore = Math.min(10, jw.filter(w => sw.includes(w)).length * 3)
      }
    }

    const rawTotal = skillScore + expScore + salaryScore + locScore + workTypeScore + eduBonus + roleScore
    const total = Math.max(0, Math.min(100, rawTotal))
    const isGem = skillScore >= 20 && roleScore < 4 && total >= 40
    return { score:total, role:roleScore, skill:skillScore, exp:expScore, loc:locScore, salary:salaryScore, workType:workTypeScore, pers:0, isGem, label:matchLabel(total, isGem) }
  }

  // ===== PUBLIC UI ===========================================================

  function renderSalaryTable() {
    const tbody = el('salary-tbody')
    if (!tbody) return
    tbody.innerHTML = SALARY_DATA.map(r => `<tr>
      <td><strong>${esc(r.role)}</strong></td>
      <td>${esc(r.sector)}</td>
      <td>$${r.min.toLocaleString()}</td>
      <td>$${r.mid.toLocaleString()}</td>
      <td>$${r.max.toLocaleString()}</td>
      <td style="color:${r.up?'#059669':'#dc2626'};font-weight:700">${esc(r.trend)}</td>
    </tr>`).join('')
  }

  function renderNewsGrid() {
    const grid = el('news-grid')
    if (!grid) return
    grid.innerHTML = NEWS_DATA.map((n,i) => `<div class="news-card" data-news-idx="${i}" style="cursor:pointer" role="button" tabindex="0" aria-label="Read: ${esc(n.title)}">
      <div class="news-category">${esc(n.cat)}</div>
      <div class="news-title">${esc(n.title)}</div>
      <div class="news-excerpt">${esc(n.excerpt.slice(0,120))}${n.excerpt.length>120?'‚Ä¶':''}</div>
      <div class="news-date" style="margin-top:8px;display:flex;justify-content:space-between;align-items:center"><span>${esc(n.date)}</span><span style="font-size:12px;color:var(--emerald);font-weight:600">Read more ‚Üí</span></div>
    </div>`).join('')
    // Bind news click to open career modal with article content
    grid.querySelectorAll('.news-card').forEach(card => {
      const handler = () => {
        const idx = parseInt(card.dataset.newsIdx, 10)
        const n = NEWS_DATA[idx]
        if (!n) return
        const titleEl = el('career-modal-title')
        const bodyEl  = el('career-modal-body')
        if (titleEl) titleEl.textContent = `${n.cat} ‚Äî ${n.title}`
        if (bodyEl)  bodyEl.innerHTML = `
          <div style="display:flex;align-items:center;gap:12px;margin-bottom:20px">
            <span style="background:var(--emerald);color:white;padding:4px 14px;border-radius:15px;font-size:11px;font-weight:700;letter-spacing:0.5px">${esc(n.cat)}</span>
            <span style="font-size:13px;color:var(--text-muted)">${esc(n.date)}</span>
          </div>
          <p style="font-size:15px;color:var(--text-dark);line-height:1.85">${esc(n.excerpt)}</p>
          <div style="margin-top:25px;background:var(--light-gold);border-radius:15px;padding:16px 20px;border-left:4px solid var(--gold);font-size:13px">
            üí° <strong>Job Seeker Tip:</strong> Update your profile with skills relevant to this sector to appear in employer searches related to these opportunities.
          </div>`
        openModal('career-modal')
      }
      card.addEventListener('click', handler)
      card.addEventListener('keydown', e => { if(e.key==='Enter'||e.key===' ') handler() })
    })
  }

  function filterSalaryTable() {
    const q = (el('salarySearch')?.value || '').toLowerCase()
    document.querySelectorAll('#salaryTable tbody tr').forEach(row => {
      row.style.display = !q || row.textContent.toLowerCase().includes(q) ? '' : 'none'
    })
  }

  function showPublic() {
    el('public-area').style.display    = 'block'
    el('dashboard-area').style.display = 'none'
    el('main-footer').style.display    = 'block'
    el('ticker-wrap').style.display    = dataSaverOn ? 'none' : 'block'
    el('vjf-badge').style.display      = 'flex'
    loadPublicJobs()
    loadPublicStats()
  }

  function showDashboard() {
    el('public-area').style.display    = 'none'
    el('dashboard-area').style.display = 'block'
    el('main-footer').style.display    = 'none'
    el('ticker-wrap').style.display    = 'none'
    el('vjf-badge').style.display      = 'none'
  }

  function toggleDataSaver() {
    dataSaverOn = !dataSaverOn
    el('ds-pill').classList.toggle('on', dataSaverOn)
    const tw = el('ticker-wrap')
    if (tw) tw.style.display = dataSaverOn ? 'none' : 'block'
  }

  // ‚îÄ‚îÄ Nav auth state ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function updateNavAuth(loggedIn) {
    const dashTab = el('tab-dash')
    const authSec = el('auth-section')
    if (loggedIn) {
      const profile = currentProfile
      const menu = document.createElement('div')
      menu.style.cssText = 'display:flex;align-items:center;gap:12px'
      const userMenu = document.createElement('div')
      userMenu.className = 'user-menu'
      const avatar = document.createElement('div')
      avatar.className = 'user-avatar'
      avatar.textContent = initials(profile?.full_name || '?')
      const info = document.createElement('div')
      const nameEl = document.createElement('div')
      nameEl.className = 'user-name'
      nameEl.textContent = profile?.full_name || 'User'
      const roleEl = document.createElement('div')
      roleEl.className = 'user-role'
      roleEl.textContent = profile?.role || 'user'
      info.appendChild(nameEl)
      info.appendChild(roleEl)
      userMenu.appendChild(avatar)
      userMenu.appendChild(info)
      const logoutBtn = document.createElement('button')
      logoutBtn.type = 'button'
      logoutBtn.className = 'btn-logout'
      logoutBtn.textContent = 'Sign Out'
      logoutBtn.addEventListener('click', handleLogout)
      menu.appendChild(userMenu)
      menu.appendChild(logoutBtn)
      authSec.innerHTML = ''
      authSec.appendChild(menu)
      if (dashTab) dashTab.classList.remove('hidden')
      const mobDash2 = el('mob-dash'); if(mobDash2) mobDash2.classList.remove('hidden')
      const mobSignin2 = el('mob-signin'); if(mobSignin2) mobSignin2.style.display='none'
      const mobSignup2 = el('mob-signup'); if(mobSignup2) mobSignup2.style.display='none'
    } else {
      authSec.innerHTML = `
        <div class="auth-buttons">
          <button type="button" class="btn-login" id="nav-login-btn">Sign In</button>
          <button type="button" class="btn-signup" id="nav-signup-btn">Get Started ‚Üí</button>
        </div>`
      bindAuthButtons()
      if (dashTab) dashTab.classList.add('hidden')
      const mobDash = el('mob-dash'); if(mobDash) mobDash.classList.add('hidden')
      const mobSignin = el('mob-signin'); if(mobSignin) mobSignin.style.display=''
      const mobSignup = el('mob-signup'); if(mobSignup) mobSignup.style.display=''
    }
  }

  function bindAuthButtons() {
    el('nav-login-btn')?.addEventListener('click', () => openAuth('login'))
    el('nav-signup-btn')?.addEventListener('click', () => openAuth('signup'))
  }

  // ===== PUBLIC JOB BOARD ===================================================

  async function loadPublicJobs() {
    try {
      const { data, error } = await sb
        .from('posted_jobs')
        .select('id,title,primary_role,required_skills,experience,province,town,employment,salary_min,salary_max,description,status,urgency_level,expires_at,created_at')
        .eq('status','active')
        .order('created_at',{ascending:false})
      if (error) throw error
      const live = data || []
      // Merge demo jobs so board is never empty and matching engine has data
      const liveIds = new Set(live.map(j=>j.id))
      const demoFill = DEMO_JOBS.filter(j=>!liveIds.has(j.id))
      allPublicJobs = [...live, ...demoFill]
      renderPublicJobs(allPublicJobs)
    } catch (err) {
      console.error('[loadPublicJobs]', err.message)
      // Fallback to demo jobs so board is never completely empty
      allPublicJobs = DEMO_JOBS
      renderPublicJobs(allPublicJobs)
    }
  }

  // Debounced filter
  function filterPublicJobs() {
    clearTimeout(_pubSearchTimer)
    _pubSearchTimer = setTimeout(() => {
      const q   = v('pub-search').toLowerCase()
      const loc = v('pub-location')
      const emp = v('pub-employment')
      renderPublicJobs((allPublicJobs||[]).filter(j => {
        const txt = `${j.title||''} ${j.primary_role||''} ${Array.isArray(j.required_skills)?j.required_skills.join(' '):(j.required_skills||'')} ${j.description||''}`.toLowerCase()
        const jloc = (j.province||'')+' '+(j.town||'')+' '+(j.location||'')
        return (!q || txt.includes(q)) && (!loc || jloc.toLowerCase().includes(loc.toLowerCase())) && (!emp || j.employment===emp)
      }))
    }, 300)
  }

  function renderPublicJobs(jobs) {
    const grid = el('public-jobs-grid'); if (!grid) return
    if (!jobs?.length) { grid.innerHTML = emptyHTML('üîç','No jobs found','Try adjusting your search filters'); return }
    grid.innerHTML = `<div class="job-board-grid">${jobs.map(j => buildJobCard(j,false)).join('')}</div>`
    bindJobCardEvents(grid)
  }

  async function openJobDetail(jobId) {
    const job = allPublicJobs.find(j => j.id===jobId) || empJobs.find(j => j.id===jobId)
    if (!job) return
    const sal = fmtSal(job.salary_min, job.salary_max)
    const content = el('job-detail-content')
    if (!content) return

    // Clear previous content + listeners by replacing node
    const fresh = content.cloneNode(false)
    content.parentNode.replaceChild(fresh, content)

    fresh.innerHTML = `
      <div style="margin-bottom:25px">
        <div style="font-size:1.6em;font-weight:800;margin-bottom:12px;color:var(--text-dark)">${esc(job.title)}</div>
        <div class="job-meta">
          ${(job.province||job.town||job.location) ? `<span class="meta-chip">üìç ${esc(job.province&&job.town ? job.province+' - '+job.town : job.province||job.town||job.location)}</span>` : ''}
          ${job.employment ? `<span class="meta-chip">${esc(job.employment)}</span>` : ''}
          ${sal            ? `<span class="meta-chip sal">${sal}</span>` : ''}
          ${job.experience ? `<span class="meta-chip">${esc(job.experience)}</span>` : ''}
        </div>
      </div>
      ${job.description ? `<p style="color:var(--text-muted);font-size:15px;line-height:1.8;margin-bottom:25px">${esc(job.description)}</p>` : ''}
      ${job.required_skills ? `<div style="margin-bottom:20px"><div style="font-size:12px;font-weight:700;color:var(--emerald);text-transform:uppercase;letter-spacing:1px;margin-bottom:12px">Required Skills</div><div class="skill-tags">${csvSplit(job.required_skills).map(s=>`<span class="skill-tag em">${esc(s)}</span>`).join('')}</div></div>` : ''}
      ${job.expires_at ? `<p style="font-size:13px;color:var(--text-muted);margin-bottom:20px">Applications close: ${fmtDate(job.expires_at)}</p>` : ''}
      <div style="display:flex;gap:12px;flex-wrap:wrap">
        ${currentProfile?.role==='jobseeker'
          ? `<button type="button" class="btn btn-primary" data-action="apply-and-close" data-job-id="${esc(job.id)}">Apply Now ‚Üí</button>`
          : `<button type="button" class="btn btn-primary" data-action="open-login">Sign In to Apply</button>`
        }
      </div>`

    fresh.querySelector('[data-action="apply-and-close"]')?.addEventListener('click', e => {
      applyToJob(e.currentTarget.dataset.jobId)
      closeModal('job-detail-modal')
    })
    fresh.querySelector('[data-action="open-login"]')?.addEventListener('click', () => openAuth('login'))
    openModal('job-detail-modal')
  }

  async function loadPublicStats() {
    try {
      const [ur,jr,ar] = await Promise.all([
        sb.from('users').select('id,role'),
        sb.from('posted_jobs').select('id,status'),
        sb.from('applications').select('id')
      ])
      if (ur.error) throw ur.error
      if (jr.error) throw jr.error
      if (ar.error) throw ar.error
      const users = ur.data||[], jobs=jr.data||[], apps=ar.data||[]
      const seekers   = users.filter(u=>u.role==='jobseeker').length
      const employers = users.filter(u=>u.role==='employer').length
      const active    = jobs.filter(j=>j.status==='active').length
      updateLiveStats(users.length, seekers, employers, jobs.length, active, apps.length)
    } catch (err) { console.warn('[loadPublicStats]', err.message) }
  }

  function updateLiveStats(total, seekers, employers, allJ, activeJ, apps) {
    // Compute display values: live Supabase counts + BASE_STATS baseline
    const displayJobs        = activeJ   + BASE_STATS.jobs
    const displaySeekers     = seekers   + BASE_STATS.seekers
    const displayEmployers   = employers + BASE_STATS.employers
    const displayApplications= apps      + BASE_STATS.applications
    const fmt = n => n>=1000 ? (n/1000).toFixed(1)+'K' : String(n)
    const set2 = (id,val) => { const e=el(id); if(e) e.textContent=fmt(val) }
    // Hero stats
    set2('hero-stat-jobs',      displayJobs)
    set2('hero-stat-seekers',   displaySeekers)
    set2('hero-stat-employers', displayEmployers)
    // Stats bar
    set2('sb-jobs',             displayJobs)
    set2('sb-seekers',          displaySeekers)
    set2('sb-employers',        displayEmployers)
    set2('sb-applications',     displayApplications)
    // Ticker
    const tk = el('ticker-seekers'); if(tk) tk.textContent = fmt(displaySeekers)
  }



  // ===== DASHBOARD ==========================================================

  // ‚îÄ‚îÄ Guard: prevent duplicate dashboard renders from onAuthStateChange ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  function initDashboard(profile) {
    closeModal('auth-modal')
    updateNavAuth(true)

    const isAdmin = profile.role==='admin' || ADMIN_EMAILS.includes(profile.email || '')
    const role    = isAdmin ? 'admin' : profile.role

    setText('dash-avatar',     initials(profile.full_name))
    setText('dash-name',       profile.full_name || 'User')
    setText('dash-role-badge', role==='admin' ? 'Administrator' : role==='employer' ? 'Employer' : 'Job Seeker')

    const navItems = role==='admin' ? adminNav() : role==='employer' ? employerNav() : seekerNav()

    // Clear nav and main safely
    const navEl = el('dash-nav')
    navEl.innerHTML = ''
    navItems.forEach(n => {
      const btn = document.createElement('button')
      btn.type = 'button'
      btn.className = 'dash-nav-item'
      btn.dataset.panel = n.p
      btn.textContent = `${n.i} ${n.l}`
      btn.addEventListener('click', () => showPanel(n.p))
      navEl.appendChild(btn)
    })

    const dashMain = el('dash-main')
    dashMain.innerHTML = ''
    dashMain.innerHTML = role==='admin' ? buildAdminPanels() : role==='employer' ? buildEmployerPanels() : buildSeekerPanels()

    bindDynamicDashboardHandlers(role)
    showDashboard()
    showPanel(navItems[0].p)

    if (role==='admin')         loadAdminData()
    else if (role==='employer') loadEmployerData()
    else                        loadSeekerData()
  }

  function showPanel(id) {
    document.querySelectorAll('.dash-panel').forEach(p => p.classList.remove('active'))
    document.querySelectorAll('.dash-nav-item').forEach(b => b.classList.remove('active'))
    const p = el(id); if(p) p.classList.add('active')
    const b = document.querySelector(`[data-panel="${id}"]`); if(b) b.classList.add('active')
  }

  function adminNav()    { return [{p:'admin-overview',i:'üìä',l:'Overview'},{p:'admin-users',i:'üë•',l:'All Users'},{p:'admin-jobs',i:'üìã',l:'All Jobs'},{p:'admin-apps',i:'üìù',l:'Applications'},{p:'admin-logs',i:'üîç',l:'Search Logs'}] }
  function employerNav() { return [{p:'emp-overview',i:'üìä',l:'Dashboard'},{p:'emp-jobs',i:'üìã',l:'My Jobs'},{p:'emp-applications',i:'üìù',l:'Applications'},{p:'emp-matches',i:'üß†',l:'AI Matches'},{p:'emp-search',i:'üîç',l:'Search Talent'},{p:'emp-profile',i:'üë§',l:'My Profile'}] }
  function seekerNav()   { return [{p:'sk-overview',i:'üè†',l:'Dashboard'},{p:'sk-profile',i:'üë§',l:'My Profile'},{p:'sk-matches',i:'‚ú®',l:'Matched Jobs'},{p:'sk-top5',i:'‚≠ê',l:'Top 5 Matches'},{p:'sk-applications',i:'üìù',l:'Applications'}] }

  // Bind handlers for dynamically-injected dashboard content (called once per render)
  function bindDynamicDashboardHandlers(role) {
    if (role==='employer' || role==='admin') {
      document.querySelectorAll('[data-action="open-post-job"]').forEach(b => b.addEventListener('click', () => openModal('post-job-modal')))
    }
    if (role==='jobseeker') {
      el('sk-save-btn')?.addEventListener('click', saveProfile)
      document.querySelector('[data-action="add-role"]')?.addEventListener('click', addRoleChip)
      document.querySelector('[data-action="add-skill"]')?.addEventListener('click', addSkillChip)
      document.querySelector('[data-action="add-cert"]')?.addEventListener('click', addCertChip)
      document.querySelector('[data-action="add-lang"]')?.addEventListener('click', addLangChip)
      document.querySelector('[data-action="add-indpref"]')?.addEventListener('click', addIndPrefChip)
      el('sk-role-input')?.addEventListener('keydown', e => { if(e.key==='Enter'){ addRoleChip(); e.preventDefault() } })
      el('sk-skill-input')?.addEventListener('keydown', e => { if(e.key==='Enter'){ addSkillChip(); e.preventDefault() } })
      el('sk-cert-input')?.addEventListener('keydown', e => { if(e.key==='Enter'){ addCertChip(); e.preventDefault() } })
      el('sk-lang-input')?.addEventListener('keydown', e => { if(e.key==='Enter'){ addLangChip(); e.preventDefault() } })
      el('sk-indpref-input')?.addEventListener('keydown', e => { if(e.key==='Enter'){ addIndPrefChip(); e.preventDefault() } })
      document.querySelector('[data-action="refresh-seeker-matches"]')?.addEventListener('click', loadSeekerMatches)
      document.querySelector('[data-action="run-top5"]')?.addEventListener('click', loadTop5Matches)
      el('sk-delete-account-btn')?.addEventListener('click', ()=>openModal('delete-account-modal'))
      // ‚îÄ‚îÄ Profile picture upload (seeker) ‚îÄ‚îÄ
      el('sk-pic-file')?.addEventListener('change', async function() {
        const file = this.files?.[0]; if (!file) return
        if (file.size > 50 * 1024 * 1024) { showToast('sk-profile-toast', '‚ö†Ô∏è File too large. Maximum upload size is 50MB.', 'error'); this.value = ''; return }
        if (!['image/jpeg','image/png','image/webp'].includes(file.type)) { showToast('sk-profile-toast', '‚ö†Ô∏è Only JPG, PNG, or WEBP images allowed.', 'error'); this.value = ''; return }
        setBtn('sk-save-btn', true, 'Uploading picture...')
        try {
          if (seekerPicUrl) {
            try { const prevPath = seekerPicUrl.split('/profile-pictures/')[1]; if (prevPath) await sb.storage.from('profile-pictures').remove([decodeURIComponent(prevPath)]) } catch(_) {}
          }
          const path = `profile-pictures/${currentProfile.id}/${Date.now()}-${file.name}`
          seekerPicUrl = await uploadFileToStorage('profile-pictures', path, file)
          renderAvatarEl('sk-avatar-display', seekerPicUrl, currentProfile.full_name)
          showToast('sk-profile-toast', '‚úÖ Picture uploaded ‚Äî click Save Profile to persist.', 'success')
        } catch(err) {
          showToast('sk-profile-toast', '‚ö†Ô∏è Picture upload failed: ' + esc(err.message), 'error')
        } finally { setBtn('sk-save-btn', false, 'Save Profile') }
      })
      // ‚îÄ‚îÄ CV upload (seeker) ‚îÄ‚îÄ
      el('sk-cv-file')?.addEventListener('change', async function() {
        const file = this.files?.[0]; if (!file) return
        if (file.size > 50 * 1024 * 1024) { showToast('sk-profile-toast', '‚ö†Ô∏è File too large. Maximum upload size is 50MB.', 'error'); this.value = ''; return }
        if (file.type !== 'application/pdf') { showToast('sk-profile-toast', '‚ö†Ô∏è Only PDF files are allowed for CV upload.', 'error'); this.value = ''; return }
        setBtn('sk-save-btn', true, 'Uploading CV...')
        try {
          if (seekerCvUrl) {
            try { const prevPath = seekerCvUrl.split('/cv-files/')[1]; if (prevPath) await sb.storage.from('cv-files').remove([decodeURIComponent(prevPath)]) } catch(_) {}
          }
          const path = `cv-files/${currentProfile.id}/${Date.now()}-${file.name}`
          seekerCvUrl = await uploadFileToStorage('cv-files', path, file)
          const viewDiv  = el('sk-cv-view')
          const viewLink = el('sk-cv-link')
          if (viewLink) viewLink.href = seekerCvUrl
          if (viewDiv)  viewDiv.style.display = 'block'
          showToast('sk-profile-toast', '‚úÖ CV uploaded ‚Äî click Save Profile to persist.', 'success')
        } catch(err) {
          showToast('sk-profile-toast', '‚ö†Ô∏è CV upload failed: ' + esc(err.message), 'error')
        } finally { setBtn('sk-save-btn', false, 'Save Profile') }
      })
      // ‚îÄ‚îÄ Intro video upload (seeker) ‚îÄ‚îÄ
      el('sk-video-file')?.addEventListener('change', async function() {
        const file = this.files?.[0]; if (!file) return
        if (file.size > 50 * 1024 * 1024) { showToast('sk-profile-toast', '‚ö†Ô∏è File too large. Maximum upload size is 50MB.', 'error'); this.value = ''; return }
        if (file.type !== 'video/mp4') { showToast('sk-profile-toast', '‚ö†Ô∏è Only MP4 video format is supported.', 'error'); this.value = ''; return }
        setBtn('sk-save-btn', true, 'Uploading video...')
        try {
          if (seekerVideoUrl) {
            try { const prevPath = seekerVideoUrl.split('/profile-videos/')[1]; if (prevPath) await sb.storage.from('profile-videos').remove([decodeURIComponent(prevPath)]) } catch(_) {}
          }
          const path = `profile-videos/${currentProfile.id}/${Date.now()}-${file.name}`
          seekerVideoUrl = await uploadFileToStorage('profile-videos', path, file)
          const viewDiv  = el('sk-video-view')
          const viewLink = el('sk-video-link')
          if (viewLink) viewLink.href = seekerVideoUrl
          if (viewDiv)  viewDiv.style.display = 'block'
          showToast('sk-profile-toast', '‚úÖ Video uploaded ‚Äî click Save Profile to persist.', 'success')
        } catch(err) {
          showToast('sk-profile-toast', '‚ö†Ô∏è Video upload failed: ' + esc(err.message), 'error')
        } finally { setBtn('sk-save-btn', false, 'Save Profile') }
      })
    }
    if (role==='employer') {
      document.querySelector('[data-action="search-talent"]')?.addEventListener('click', searchTalent)
      el('match-job-select')?.addEventListener('change', loadMatchesForJob)
      el('emp-save-profile-btn')?.addEventListener('click', saveEmployerProfile)
      el('emp-delete-account-btn')?.addEventListener('click', ()=>openModal('delete-account-modal'))
      // ‚îÄ‚îÄ Profile picture upload (employer) ‚îÄ‚îÄ
      el('emp-pic-file')?.addEventListener('change', async function() {
        const file = this.files?.[0]; if (!file) return
        if (file.size > 50 * 1024 * 1024) { showToast('emp-profile-toast', '‚ö†Ô∏è File too large. Maximum upload size is 50MB.', 'error'); this.value = ''; return }
        if (!['image/jpeg','image/png','image/webp'].includes(file.type)) { showToast('emp-profile-toast', '‚ö†Ô∏è Only JPG, PNG, or WEBP images allowed.', 'error'); this.value = ''; return }
        setBtn('emp-save-profile-btn', true, 'Uploading picture...')
        try {
          if (empPicUrl) {
            try { const prevPath = empPicUrl.split('/profile-pictures/')[1]; if (prevPath) await sb.storage.from('profile-pictures').remove([decodeURIComponent(prevPath)]) } catch(_) {}
          }
          const path = `profile-pictures/${currentProfile.id}/${Date.now()}-${file.name}`
          empPicUrl = await uploadFileToStorage('profile-pictures', path, file)
          renderAvatarEl('emp-avatar-display', empPicUrl, currentProfile.full_name)
          showToast('emp-profile-toast', '‚úÖ Picture uploaded ‚Äî click Save Profile to persist.', 'success')
        } catch(err) {
          showToast('emp-profile-toast', '‚ö†Ô∏è Picture upload failed: ' + esc(err.message), 'error')
        } finally { setBtn('emp-save-profile-btn', false, 'Save Profile') }
      })
    }
    el('pj-submit-btn')?.addEventListener('click', submitJob)

    // Province ‚Üí Town dynamic population
    const PROVINCE_TOWNS = {
      harare: ['Harare CBD','Borrowdale','Avondale','Mount Pleasant','Greendale','Highlands','Belgravia','Eastlea','Milton Park','Marlborough','Bluff Hill','Willowvale','Msasa','Southerton','Workington','Chitungwiza','Epworth','Ruwa','Mount Hampden','Other'],
      bulawayo: ['Bulawayo Urban','Other'],
      manicaland: ['Rusape','Chipinge','Nyanga','Chimanimani','Mutasa','Buhera','Other'],
      mashonaland_central: ['Mvurwi','Mt Darwin','Shamva','Glendale','Centenary','Rushinga','Other'],
      mashonaland_east: ['Marondera','Mutoko','Murehwa','Goromonzi','Chivhu','Beatrice','Macheke','Other'],
      mashonaland_west: ['Kadoma','Chegutu','Norton','Kariba','Karoi','Chirundu','Banket','Other'],
      masvingo: ['Chiredzi','Zvishavane','Mpandawana (Gutu)','Mwenezi','Bikita','Zaka','Other'],
      matabeleland_north: ['Victoria Falls City','Hwange','Binga','Dete','Nkayi','Tsholotsho','Other'],
      matabeleland_south: ['Beitbridge','Plumtree','Esigodini','Filabusi','West Nicholson','Other'],
      midlands: ['Kwekwe','Redcliff','Gokwe','Shurugwi','Mvuma','Zvishavane','Other'],
      other: ['Other']
    }
    el('pj-province')?.addEventListener('change', function() {
      const townSel = el('pj-town')
      if (!townSel) return
      const towns = PROVINCE_TOWNS[this.value] || ['Other']
      townSel.innerHTML = '<option value="">Select town...</option>' + towns.map(t=>`<option value="${t}">${t}</option>`).join('')
    })

    // Skills tag system
    window._pjSkills = []
    el('pj-skills-input')?.addEventListener('keydown', function(e) {
      if (e.key === 'Enter') {
        e.preventDefault()
        const val = this.value.trim()
        if (!val || window._pjSkills.includes(val)) { this.value=''; return }
        window._pjSkills.push(val)
        const tagsEl = el('pj-skills-tags')
        if (tagsEl) {
          const chip = document.createElement('span')
          chip.style.cssText = 'display:inline-flex;align-items:center;gap:5px;background:var(--emerald);color:#fff;border-radius:20px;padding:4px 12px;font-size:13px;font-weight:500;'
          chip.textContent = val
          const rm = document.createElement('span')
          rm.textContent = '√ó'
          rm.style.cssText = 'cursor:pointer;font-size:16px;line-height:1;margin-left:2px;'
          rm.addEventListener('click', () => {
            window._pjSkills = window._pjSkills.filter(s=>s!==val)
            chip.remove()
          })
          chip.appendChild(rm)
          tagsEl.appendChild(chip)
        }
        this.value = ''
      }
    })
  }

  // ===== EMPLOYER PANELS HTML ===============================================

  function buildEmployerPanels() {
    return `
    <div class="dash-panel" id="emp-overview">
      <div class="panel-header">
        <div><div class="panel-title">Dashboard</div><div class="panel-sub">Welcome back, <span id="emp-name-disp"></span></div></div>
        <button type="button" class="btn btn-secondary" data-action="open-post-job">+ Post a Job</button>
      </div>
      <div class="analytics-grid">
        <div class="analytics-card"><span class="analytics-num" id="ov-total-jobs">‚Äî</span><span class="analytics-label">Total Jobs</span></div>
        <div class="analytics-card"><span class="analytics-num" id="ov-active-jobs">‚Äî</span><span class="analytics-label">Active Jobs</span></div>
        <div class="analytics-card"><span class="analytics-num" id="ov-draft-jobs">‚Äî</span><span class="analytics-label">Drafts</span></div>
        <div class="analytics-card"><span class="analytics-num" id="ov-total-apps">‚Äî</span><span class="analytics-label">Applications</span></div>
      </div>
      <div class="form-container" style="margin-bottom:0">
        <h3 style="color:var(--emerald);font-weight:700;margin-bottom:20px">Recent Jobs</h3>
        <div id="emp-recent-jobs"><div class="empty-state"><span class="spinner"></span></div></div>
      </div>
    </div>
    <div class="dash-panel" id="emp-jobs">
      <div class="panel-header">
        <div><div class="panel-title">My Jobs</div><div class="panel-sub">Manage your posted positions</div></div>
        <button type="button" class="btn btn-secondary" data-action="open-post-job">+ Post a Job</button>
      </div>
      <div id="emp-jobs-list"><div class="empty-state"><span class="spinner"></span></div></div>
    </div>
    <div class="dash-panel" id="emp-applications">
      <div class="panel-header"><div><div class="panel-title">Applications</div><div class="panel-sub">All applicants across your jobs</div></div></div>
      <div id="emp-apps-list"><div class="empty-state"><span class="spinner"></span></div></div>
    </div>
    <div class="dash-panel" id="emp-matches">
      <div class="panel-header"><div><div class="panel-title">AI Matches</div><div class="panel-sub">Select a job to see ranked AI-scored candidates</div></div></div>
      <div class="form-container">
        <label class="form-label" for="match-job-select">Select Job to Match</label>
        <select class="form-select" id="match-job-select"><option value="">Choose a job...</option></select>
      </div>
      <div id="emp-matches-result"></div>
    </div>
    <div class="dash-panel" id="emp-search">
      <div class="panel-header"><div><div class="panel-title">Search Talent</div><div class="panel-sub">Find and AI-rank candidates manually</div></div></div>
      <div class="form-container">
        <div class="form-row">
          <div class="form-group"><label class="form-label" for="ts-role">Role / Title</label><input class="form-input" id="ts-role" type="text" placeholder="Software Engineer"/></div>
          <div class="form-group"><label class="form-label" for="ts-location">Province</label>
            <select class="form-select" id="ts-location">
              <option value="">Any Province</option>
              <option>Harare</option><option>Bulawayo</option><option>Manicaland</option>
              <option>Mashonaland Central</option><option>Mashonaland East</option><option>Mashonaland West</option>
              <option>Masvingo</option><option>Matabeleland North</option><option>Matabeleland South</option><option>Midlands</option>
            </select>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group"><label class="form-label" for="ts-skills">Required Skills</label><input class="form-input" id="ts-skills" type="text" placeholder="React, Python, SQL"/></div>
          <div class="form-group"><label class="form-label" for="ts-exp">Experience Level</label>
            <select class="form-select" id="ts-exp">
              <option value="">Any</option><option>Intern</option><option>Entry Level</option>
              <option>Junior</option><option>Mid Level</option><option>Senior</option><option>Lead</option>
            </select>
          </div>
        </div>
        <button type="button" class="btn btn-primary" data-action="search-talent">üîç Search &amp; Rank Candidates</button>
      </div>
      <div id="talent-search-results"></div>
    </div>
    <div class="dash-panel" id="emp-profile">
      <div class="panel-header">
        <div><div class="panel-title">My Profile</div><div class="panel-sub">Update your employer account details</div></div>
        <button type="button" class="btn btn-primary" id="emp-save-profile-btn">Save Profile</button>
      </div>
      <div id="emp-profile-toast" class="toast" role="alert"></div>
      <div class="form-container">
        <!-- ‚îÄ‚îÄ Profile Picture ‚îÄ‚îÄ -->
        <div class="form-group" style="display:flex;align-items:center;gap:20px;margin-bottom:20px">
          <div id="emp-avatar-display" style="width:80px;height:80px;border-radius:50%;overflow:hidden;background:var(--emerald);display:flex;align-items:center;justify-content:center;font-size:26px;font-weight:800;color:white;flex-shrink:0;border:3px solid rgba(4,120,87,0.2)"></div>
          <div style="flex:1">
            <label for="emp-pic-file" style="font-weight:600;font-size:14px;display:block;margin-bottom:6px;color:var(--text-dark)">Company / Profile Picture</label>
            <input type="file" accept="image/*" id="emp-pic-file" class="form-input" style="padding:6px;font-size:13px"/>
            <div style="font-size:12px;color:var(--text-muted);margin-top:4px">Company logo or professional headshot ¬∑ JPG or PNG</div>
            <div style="font-size:11px;color:#9ca3af;margin-top:2px">Maximum file size: 50MB</div>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group"><label class="form-label" for="emp-fullname">Contact Name</label><input class="form-input" id="emp-fullname" type="text" placeholder="Your full name"/></div>
          <div class="form-group"><label class="form-label" for="emp-company">Company Name</label><input class="form-input" id="emp-company" type="text" placeholder="e.g. Econet Wireless"/></div>
        </div>
        <div class="form-row">
          <div class="form-group"><label class="form-label" for="emp-email-disp">Email (read-only)</label><input class="form-input" id="emp-email-disp" type="email" disabled style="opacity:0.6"/></div>
          <div class="form-group">
            <label class="form-label">WhatsApp Number</label>
            <div style="display:flex;gap:8px">
              <select class="form-select" id="emp-wa-prefix" style="width:120px;flex-shrink:0">
                <option value="263">üáøüáº +263</option>
                <option value="27">üáøüá¶ +27</option>
                <option value="260">üáøüá≤ +260</option>
                <option value="267">üáßüáº +267</option>
                <option value="44">üá¨üáß +44</option>
                <option value="1">üá∫üá∏ +1</option>
                <option value="61">üá¶üá∫ +61</option>
              </select>
              <input class="form-input" id="emp-whatsapp" type="tel" placeholder="77 123 4567" style="flex:1"/>
            </div>
          </div>
        </div>
        <div class="form-group"><label class="form-label" for="emp-industry">Industry</label>
          <select class="form-select" id="emp-industry">
            <option value="">Select...</option>
            <option>Technology</option><option>Finance / Banking</option><option>Mining</option><option>Agriculture</option>
            <option>Healthcare</option><option>Education</option><option>Retail / FMCG</option><option>Construction</option>
            <option>Logistics</option><option>Hospitality</option><option>Other</option>
          </select>
        </div>
        <div style="border-top:1px solid rgba(4,120,87,0.1);padding-top:18px;margin-top:10px">
          <button type="button" class="btn btn-ghost btn-sm" id="emp-delete-account-btn" style="color:#dc2626;border-color:#dc2626">‚ö†Ô∏è Delete Account</button>
        </div>
      </div>
    </div>`
  }

  // ===== SEEKER PANELS HTML =================================================

  function buildSeekerPanels() {
    return `
    <div class="dash-panel" id="sk-overview">
      <div class="panel-header"><div><div class="panel-title">Dashboard</div><div class="panel-sub">Your talent intelligence hub</div></div></div>
      <div class="profile-progress" id="sk-progress-block">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
          <span style="font-weight:700;font-size:1.05em;color:var(--text-dark)">Profile Strength</span>
          <span style="font-size:13px;color:var(--text-muted);font-weight:700" id="sk-pct">0%</span>
        </div>
        <div class="completion-bar-wrap"><div class="completion-bar" id="sk-progress-bar" style="width:0%"></div></div>
        <div style="font-size:12px;color:var(--text-muted);margin-top:8px" id="sk-progress-tip">Complete your profile to appear in employer matches</div>
      </div>
      <div class="analytics-grid">
        <div class="analytics-card"><span class="analytics-num" id="sk-stat-matches">‚Äî</span><span class="analytics-label">Job Matches</span></div>
        <div class="analytics-card"><span class="analytics-num" id="sk-stat-apps">‚Äî</span><span class="analytics-label">Applications</span></div>
        <div class="analytics-card"><span class="analytics-num" id="sk-stat-top">‚Äî</span><span class="analytics-label">Top Match %</span></div>
      </div>
      <div class="form-container" style="margin-top:25px">
        <h3 style="color:var(--emerald);font-weight:700;margin-bottom:20px">Your Top Matches</h3>
        <div id="sk-top-matches"><div class="empty-state"><span class="spinner"></span></div></div>
      </div>
    </div>
    <div class="dash-panel" id="sk-profile">
      <div class="panel-header">
        <div><div class="panel-title">My Profile</div><div class="panel-sub">Visible to employers in AI match results ‚Äî keep it complete</div></div>
        <button type="button" class="btn btn-primary" id="sk-save-btn">Save Profile</button>
      </div>
      <div id="sk-profile-toast" class="toast" role="alert"></div>
      <div class="form-container">
        <!-- ‚îÄ‚îÄ Profile Picture ‚îÄ‚îÄ -->
        <div class="form-group" style="display:flex;align-items:center;gap:20px;margin-bottom:20px">
          <div id="sk-avatar-display" style="width:80px;height:80px;border-radius:50%;overflow:hidden;background:var(--emerald);display:flex;align-items:center;justify-content:center;font-size:26px;font-weight:800;color:white;flex-shrink:0;border:3px solid rgba(4,120,87,0.2)"></div>
          <div style="flex:1">
            <label for="sk-pic-file" style="font-weight:600;font-size:14px;display:block;margin-bottom:6px;color:var(--text-dark)">Profile Picture</label>
            <input type="file" accept="image/*" id="sk-pic-file" class="form-input" style="padding:6px;font-size:13px"/>
            <div style="font-size:12px;color:var(--text-muted);margin-top:4px">Square image recommended ¬∑ JPG or PNG</div>
            <div style="font-size:11px;color:#9ca3af;margin-top:2px">Maximum file size: 50MB</div>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group"><label for="sk-fullname">Full Name</label><input class="form-input" id="sk-fullname" type="text" placeholder="Tatenda Moyo"/></div>
          <div class="form-group">
            <label for="sk-whatsapp">WhatsApp Number</label>
            <div style="display:flex;gap:8px">
              <select class="form-select" id="sk-wa-prefix" style="width:120px;flex-shrink:0">
                <option value="263">üáøüáº +263</option>
                <option value="27">üáøüá¶ +27</option>
                <option value="260">üáøüá≤ +260</option>
                <option value="267">üáßüáº +267</option>
                <option value="44">üá¨üáß +44</option>
                <option value="1">üá∫üá∏ +1</option>
                <option value="61">üá¶üá∫ +61</option>
              </select>
              <input class="form-input" id="sk-whatsapp" type="tel" placeholder="77 123 4567" style="flex:1"/>
            </div>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group"><label for="sk-province">Province</label>
            <select class="form-select" id="sk-province">
              <option value="">Select province...</option>
              <option>Harare</option><option>Bulawayo</option><option>Manicaland</option>
              <option>Mashonaland Central</option><option>Mashonaland East</option><option>Mashonaland West</option>
              <option>Masvingo</option><option>Matabeleland North</option><option>Matabeleland South</option><option>Midlands</option>
            </select>
          </div>
          <div class="form-group"><label for="sk-town">Town / City</label><input class="form-input" id="sk-town" type="text" placeholder="e.g. Harare CBD, Bulawayo"/></div>
        </div>
        <div class="form-row">
          <div class="form-group"><label for="sk-relocation">Relocation / Work Preference</label>
            <select class="form-select" id="sk-relocation">
              <option value="">Select preference...</option>
              <option value="local">Local only ‚Äî current area</option>
              <option value="province">Within province only</option>
              <option value="national">Open to relocate nationally</option>
              <option value="any">Open to any location including remote</option>
            </select>
          </div>
          <div class="form-group"><label for="sk-exp-level">Experience Level</label>
            <select class="form-select" id="sk-exp-level">
              <option value="">Select...</option>
              <option value="intern">Intern</option><option value="entry">Entry Level</option>
              <option value="junior">Junior (1‚Äì2 yrs)</option><option value="mid">Mid Level (3‚Äì5 yrs)</option>
              <option value="senior">Senior (5‚Äì8 yrs)</option><option value="lead">Lead / Principal</option>
              <option value="manager">Manager</option><option value="director">Director</option>
            </select>
          </div>
        </div>
        <div class="form-group">
          <label>Professional Roles (used in AI matching)</label>
          <div style="display:flex;gap:10px;margin-bottom:10px">
            <input class="form-input" id="sk-role-input" type="text" placeholder="e.g. Software Engineer" style="flex:1"/>
            <button type="button" class="btn btn-secondary btn-sm" data-action="add-role">+ Add</button>
          </div>
          <div class="chips-list" id="sk-roles-chips"></div>
        </div>
        <div class="form-group">
          <label>Skills (press Enter or click Add ‚Äî used in AI matching)</label>
          <div style="display:flex;gap:10px;margin-bottom:10px">
            <input class="form-input" id="sk-skill-input" type="text" placeholder="e.g. React, Python, SQL" style="flex:1"/>
            <button type="button" class="btn btn-secondary btn-sm" data-action="add-skill">+ Add</button>
          </div>
          <div class="chips-list" id="sk-skills-chips"></div>
        </div>
        <div class="form-group"><label for="sk-bio">Professional Bio</label><textarea class="form-textarea" id="sk-bio" placeholder="Tell employers about yourself ‚Äî your background, strengths, and what you are looking for..." rows="4"></textarea></div>
        <div class="form-row">
          <div class="form-group">
            <label for="sk-cv-url">CV URL (PDF link)</label>
            <input class="form-input" id="sk-cv-url" type="url" placeholder="https://drive.google.com/..."/>
            <div style="margin-top:10px">
              <label for="sk-cv-file" style="font-weight:600;font-size:13px;display:block;margin-bottom:5px;color:var(--text-muted)">‚Äî or upload PDF directly</label>
              <input type="file" accept=".pdf" id="sk-cv-file" class="form-input" style="padding:6px;font-size:13px"/>
              <div style="font-size:11px;color:#9ca3af;margin-top:2px">Maximum file size: 50MB</div>
            </div>
            <div id="sk-cv-view" style="margin-top:8px;display:none">
              <a id="sk-cv-link" href="#" target="_blank" rel="noopener" class="btn btn-secondary btn-sm">üìÑ View CV</a>
            </div>
          </div>
          <div class="form-group">
            <label for="sk-video-url">Intro Video URL (optional)</label>
            <input class="form-input" id="sk-video-url" type="url" placeholder="https://youtube.com/..."/>
            <div style="margin-top:10px">
              <label for="sk-video-file" style="font-weight:600;font-size:13px;display:block;margin-bottom:5px;color:var(--text-muted)">‚Äî or upload video directly</label>
              <input type="file" accept="video/*" id="sk-video-file" class="form-input" style="padding:6px;font-size:13px"/>
              <div style="font-size:11px;color:#9ca3af;margin-top:2px">Maximum file size: 50MB</div>
            </div>
            <div id="sk-video-view" style="margin-top:8px;display:none">
              <a id="sk-video-link" href="#" target="_blank" rel="noopener" class="btn btn-secondary btn-sm">üé¨ Watch Intro</a>
            </div>
          </div>
        </div>
        <div class="form-group"><label for="sk-personality">Personality Type (improves AI match accuracy)</label>
          <select class="form-select" id="sk-personality">
            <option value="">Select...</option>
            <option value="analytical">Analytical ‚Äî Detail-oriented, data-driven</option>
            <option value="creative">Creative ‚Äî Innovative, design-thinking</option>
            <option value="leader">Leader ‚Äî People-first, strategic</option>
            <option value="executor">Executor ‚Äî Task-focused, delivery-driven</option>
            <option value="collaborator">Collaborator ‚Äî Team player, communicator</option>
          </select>
        </div>
        <div class="form-row">
          <div class="form-group"><label for="sk-education-level">Education Level</label>
            <select class="form-select" id="sk-education-level">
              <option value="">Select...</option>
              <option value="high_school">High School</option>
              <option value="diploma">Diploma</option>
              <option value="degree">Degree</option>
              <option value="masters">Masters</option>
              <option value="phd">PhD</option>
            </select>
          </div>
          <div class="form-group"><label for="sk-preferred-work-type">Preferred Work Type</label>
            <select class="form-select" id="sk-preferred-work-type">
              <option value="">Select...</option>
              <option value="remote">Remote</option>
              <option value="hybrid">Hybrid</option>
              <option value="on-site">On-site</option>
            </select>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group"><label for="sk-years-experience">Years of Experience</label><input class="form-input" id="sk-years-experience" type="number" min="0" max="50" placeholder="e.g. 5"/></div>
          <div class="form-group" style="display:flex;align-items:flex-end;padding-bottom:4px">
            <label style="display:flex;align-items:center;gap:10px;font-weight:600;font-size:14px;cursor:pointer">
              <input type="checkbox" id="sk-willing-to-relocate" style="width:18px;height:18px;accent-color:var(--emerald)"/>
              Willing to Relocate
            </label>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group"><label for="sk-salary-min">Expected Salary Min (USD)</label><input class="form-input" id="sk-salary-min" type="number" min="0" placeholder="e.g. 800"/></div>
          <div class="form-group"><label for="sk-salary-max">Expected Salary Max (USD)</label><input class="form-input" id="sk-salary-max" type="number" min="0" placeholder="e.g. 1500"/></div>
        </div>
        <div class="form-group"><label for="sk-qualifications">Qualifications</label><textarea class="form-textarea" id="sk-qualifications" placeholder="List your academic qualifications, degrees, diplomas..." rows="3"></textarea></div>
        <div class="form-group"><label for="sk-work-history">Work History</label><textarea class="form-textarea" id="sk-work-history" placeholder="Summarise your work history, key roles and achievements..." rows="5"></textarea></div>
        <div class="form-group">
          <label>Certifications (press Enter or click Add)</label>
          <div style="display:flex;gap:10px;margin-bottom:10px">
            <input class="form-input" id="sk-cert-input" type="text" placeholder="e.g. AWS Certified, ACCA, PMP" style="flex:1"/>
            <button type="button" class="btn btn-secondary btn-sm" data-action="add-cert">+ Add</button>
          </div>
          <div class="chips-list" id="sk-certs-chips"></div>
        </div>
        <div class="form-group">
          <label>Languages (press Enter or click Add)</label>
          <div style="display:flex;gap:10px;margin-bottom:10px">
            <input class="form-input" id="sk-lang-input" type="text" placeholder="e.g. English, Shona, Ndebele" style="flex:1"/>
            <button type="button" class="btn btn-secondary btn-sm" data-action="add-lang">+ Add</button>
          </div>
          <div class="chips-list" id="sk-langs-chips"></div>
        </div>
        <div class="form-group">
          <label>Industry Preferences (press Enter or click Add)</label>
          <div style="display:flex;gap:10px;margin-bottom:10px">
            <input class="form-input" id="sk-indpref-input" type="text" placeholder="e.g. Technology, Mining, Finance" style="flex:1"/>
            <button type="button" class="btn btn-secondary btn-sm" data-action="add-indpref">+ Add</button>
          </div>
          <div class="chips-list" id="sk-indpref-chips"></div>
        </div>
        <div style="border-top:1px solid rgba(4,120,87,0.1);padding-top:18px;margin-top:10px">
          <button type="button" class="btn btn-ghost btn-sm" id="sk-delete-account-btn" style="color:#dc2626;border-color:#dc2626">‚ö†Ô∏è Delete Account</button>
        </div>
      </div>
    </div>
    <div class="dash-panel" id="sk-matches">
      <div class="panel-header">
        <div><div class="panel-title">Matched Jobs</div><div class="panel-sub">AI-ranked positions matching your profile</div></div>
        <button type="button" class="btn btn-secondary btn-sm" data-action="refresh-seeker-matches">‚Üª Refresh</button>
      </div>
      <div id="sk-matches-grid"><div class="empty-state"><span class="spinner"></span></div></div>
    </div>
    <div class="dash-panel" id="sk-top5">
      <div class="panel-header">
        <div><div class="panel-title">‚≠ê Top 5 Matches</div><div class="panel-sub">Your 5 best job matches across all active positions</div></div>
        <button type="button" class="btn btn-primary btn-sm" data-action="run-top5">ü§ñ Run AI Match</button>
      </div>
      <div id="sk-top5-content">
        <div class="empty-state"><span class="empty-icon">‚≠ê</span><div class="empty-title">Click "Run AI Match" to find your top 5 jobs</div><div class="empty-sub">We'll rank all active positions against your profile</div></div>
      </div>
    </div>
    <div class="dash-panel" id="sk-applications">
      <div class="panel-header"><div><div class="panel-title">My Applications</div><div class="panel-sub">Jobs you have manually applied to</div></div></div>
      <div id="sk-apps-list"><div class="empty-state"><span class="spinner"></span></div></div>
    </div>`
  }

    // ===== ADMIN PANELS HTML ==================================================

  function buildAdminPanels() {
    return `
    <div class="dash-panel" id="admin-overview">
      <div class="panel-header"><div><div class="panel-title">Admin Overview</div><div class="panel-sub">Platform-wide statistics ‚Äî read-only via RLS</div></div></div>
      <div class="analytics-grid">
        <div class="analytics-card"><span class="analytics-num" id="ad-users">‚Äî</span><span class="analytics-label">Total Users</span></div>
        <div class="analytics-card"><span class="analytics-num" id="ad-seekers">‚Äî</span><span class="analytics-label">Job Seekers</span></div>
        <div class="analytics-card"><span class="analytics-num" id="ad-employers">‚Äî</span><span class="analytics-label">Employers</span></div>
        <div class="analytics-card"><span class="analytics-num" id="ad-jobs">‚Äî</span><span class="analytics-label">Total Jobs</span></div>
        <div class="analytics-card"><span class="analytics-num" id="ad-active">‚Äî</span><span class="analytics-label">Active Jobs</span></div>
        <div class="analytics-card"><span class="analytics-num" id="ad-apps">‚Äî</span><span class="analytics-label">Applications</span></div>
      </div>
    </div>
    <div class="dash-panel" id="admin-users">
      <div class="panel-header"><div><div class="panel-title">All Users</div></div></div>
      <div id="admin-users-wrap"><div class="empty-state"><span class="spinner"></span></div></div>
    </div>
    <div class="dash-panel" id="admin-jobs">
      <div class="panel-header"><div><div class="panel-title">All Jobs</div></div></div>
      <div id="admin-jobs-wrap"><div class="empty-state"><span class="spinner"></span></div></div>
    </div>
    <div class="dash-panel" id="admin-apps">
      <div class="panel-header"><div><div class="panel-title">All Applications</div></div></div>
      <div id="admin-apps-wrap"><div class="empty-state"><span class="spinner"></span></div></div>
    </div>
    <div class="dash-panel" id="admin-logs">
      <div class="panel-header"><div><div class="panel-title">Search Logs</div></div></div>
      <div id="admin-logs-wrap"><div class="empty-state"><span class="spinner"></span></div></div>
    </div>`
  }

  // ===== JOB CARD RENDERING =================================================

  function buildJobCard(j, isEmp=false) {
    const sc  = j.status==='active'?'job-status-active':j.status==='draft'?'job-status-draft':'job-status-closed'
    const sal = fmtSal(j.salary_min, j.salary_max)
    const apps = (empApps||[]).filter(a=>a.job_id===j.id).length
    let matchHTML = ''
    if (!isEmp && currentProfile?.role==='jobseeker' && seekerProfile) {
      const r = computeMatch(j,{roles:seekerRoles,skills:seekerSkills,experience_level:seekerProfile.experience_level||'',personality_type:seekerProfile.personality_type||''})
      matchHTML = `<span class="match-score-badge ${matchClass(r.label)}" style="margin-left:auto">Match: ${r.score}%</span>`
    }
    const jId     = esc(j.id)
    const jStatus = esc(j.status)
    return `<div class="job-card">
      <div class="job-card-header">
        <div class="job-title-text">${esc(j.title)}</div>
        <span class="job-status-badge ${sc}">${jStatus}</span>
      </div>
      <div class="job-meta">
        ${(j.province||j.town||j.location) ? `<span class="meta-chip">üìç ${esc(j.province&&j.town ? j.province+' - '+j.town : j.province||j.town||j.location)}</span>` : ''}
        ${j.employment ? `<span class="meta-chip">${esc(j.employment)}</span>` : ''}
        ${sal          ? `<span class="meta-chip sal">${sal}</span>` : ''}
        ${j.experience ? `<span class="meta-chip">${esc(j.experience)}</span>` : ''}
        ${j.urgency_level==='urgent' ? `<span class="job-status-badge job-status-urgent">üî¥ URGENT</span>` : ''}
      </div>
      ${j.required_skills ? `<div class="skill-tags">${csvSplit(j.required_skills).slice(0,5).map(s=>`<span class="skill-tag em">${esc(s)}</span>`).join('')}</div>` : ''}
      ${j.description ? `<div class="job-desc-preview">${esc(j.description)}</div>` : ''}
      <div class="job-actions">
        ${isEmp ? `
          <button type="button" class="btn btn-primary btn-sm" data-job-id="${jId}" data-action="view-matches">üß† AI Matches</button>
          <button type="button" class="btn btn-secondary btn-sm" data-job-id="${jId}" data-job-status="${jStatus}" data-action="cycle-status">${j.status==='active'?'Close Job':'Activate'}</button>
          <span style="font-size:12px;color:var(--text-muted);margin-left:auto">${apps} applicant${apps!==1?'s':''}</span>
        ` : `
          <button type="button" class="btn btn-primary btn-sm" data-job-id="${jId}" data-action="view-job-detail">View Details</button>
          <button type="button" class="btn btn-secondary btn-sm" data-job-id="${jId}" data-action="apply-job">Apply Now ‚Üí</button>
          ${currentProfile?.role==='jobseeker' ? `<button type="button" class="btn btn-ghost btn-sm" data-job-id="${jId}" data-action="match-test">ü§ñ Match</button>` : ''}
          ${matchHTML}
        `}
      </div>
    </div>`
  }

  // Event delegation ‚Äî single listener per container (no duplicates)
  // WeakSet tracks which containers already have a delegated listener bound
  const _boundContainers = new WeakSet()

  function bindJobCardEvents(container) {
    if (!container) return
    // If this container already has a delegated listener, skip ‚Äî prevents duplicate
    // bindings when renderEmpJobs / renderEmpOverview are called on repeated data reloads.
    // Note: innerHTML replacement clears child nodes but leaves the container element
    // itself in the DOM, so the same reference can accumulate multiple listeners.
    if (_boundContainers.has(container)) return
    _boundContainers.add(container)
    container.addEventListener('click', e => {
      const btn = e.target.closest('[data-action]'); if (!btn) return
      const action = btn.dataset.action
      const jobId  = btn.dataset.jobId
      const status = btn.dataset.jobStatus
      if (action==='view-matches')    viewJobMatches(jobId)
      if (action==='cycle-status')    cycleStatus(jobId, status)
      if (action==='view-job-detail') openJobDetail(jobId)
      if (action==='apply-job')       applyToJob(jobId)
      if (action==='view-candidate')  viewCandidateDetail(btn.dataset.userId, btn.dataset.jobId2||'')
      if (action==='wa-book')         openWaInterviewModal(btn.dataset.waPhone, btn.dataset.waName, btn.dataset.waJob)
      if (action==='match-test')      openSeekerMatchModal(jobId)
    })
  }

  function jobCardsGrid(jobs, isEmp) {
    return `<div class="job-board-grid">${jobs.map(j=>buildJobCard(j,isEmp)).join('')}</div>`
  }

  // ===== EMPLOYER DATA ======================================================

  async function loadEmployerData() {
    if (!currentProfile) return
    const nameEl = el('emp-name-disp')
    if (nameEl) nameEl.textContent = currentProfile.full_name || ''
    // Load employer profile
    try {
      const { data:ep } = await sb.from('employer_profiles').select('*').eq('user_id',currentProfile.id).single()
      if (ep) {
        const ec=el('emp-company'); if(ec) ec.value=ep.company_name||''
        const ei=el('emp-industry'); if(ei) ei.value=ep.industry||''
        if (ep.whatsapp) {
          if (ep.whatsapp.includes('-')) {
            const parts=ep.whatsapp.split('-')
            const pSel=el('emp-wa-prefix'); if(pSel) pSel.value=parts[0]||'263'
            const wEl=el('emp-whatsapp'); if(wEl) wEl.value=parts.slice(1).join('-')
          } else { const wEl=el('emp-whatsapp'); if(wEl) wEl.value=ep.whatsapp }
        }
        if (ep.profile_picture_url) empPicUrl = ep.profile_picture_url
      }
      const fn=el('emp-fullname'); if(fn) fn.value=currentProfile.full_name||''
      const ed=el('emp-email-disp'); if(ed) ed.value=currentProfile.email||''
      renderAvatarEl('emp-avatar-display', empPicUrl, currentProfile.full_name)
    } catch(_) {}
    try {
      const { data:jobs, error } = await sb
        .from('posted_jobs')
        .select('id,title,company_name,primary_role,required_skills,experience,province,town,employment,salary_min,salary_max,description,status,urgency_level,expires_at,created_at')
        .eq('employer_id', currentProfile.id)
        .order('created_at',{ascending:false})
      if (error) throw error
      empJobs = jobs || []
    } catch (err) {
      handleError(err, null)
      return
    }
    empApps = []
    if (empJobs.length) {
      try {
        const ids = empJobs.map(j=>j.id)
        const { data:apps, error } = await sb.from('applications').select('id,job_id,applicant_user_id,created_at').in('job_id',ids)
        if (error) throw error
        empApps = apps || []
      } catch (err) { console.warn('[loadEmployerData] apps:', err.message) }
    }
    const sel = el('match-job-select')
    if (sel) {
      sel.innerHTML = '<option value="">Choose a job...</option>' +
        empJobs.map(j=>`<option value="${esc(j.id)}">${esc(j.title)}</option>`).join('')
    }
    renderEmpOverview()
    renderEmpJobs()
    renderEmpApplications()
  }

  function renderEmpOverview() {
    const active = empJobs.filter(j=>j.status==='active').length
    const draft  = empJobs.filter(j=>j.status==='draft').length
    setText('ov-total-jobs',  empJobs.length)
    setText('ov-active-jobs', active)
    setText('ov-draft-jobs',  draft)
    setText('ov-total-apps',  empApps.length)
    const recentEl = el('emp-recent-jobs')
    if (recentEl) recentEl.innerHTML = empJobs.length ? jobCardsGrid(empJobs.slice(0,4),true) : emptyHTML('üìã','No jobs posted yet','Post your first role to get started')
    if (recentEl) bindJobCardEvents(recentEl)
  }

  function renderEmpJobs() {
    const listEl = el('emp-jobs-list')
    if (!listEl) return
    listEl.innerHTML = empJobs.length ? jobCardsGrid(empJobs,true) : emptyHTML('üìã','No jobs posted yet','Use + Post a Job above')
    bindJobCardEvents(listEl)
  }

  async function renderEmpApplications() {
    const el2 = el('emp-apps-list'); if (!el2) return
    if (!empApps.length) { el2.innerHTML = emptyHTML('üìù','No applications yet','Applications to your jobs appear here'); return }
    try {
      const uids = [...new Set(empApps.map(a=>a.applicant_user_id))]
      const { data:profiles, error } = await sb.from('users').select('id,full_name').in('id',uids)
      if (error) throw error
      const pm = {}; (profiles||[]).forEach(p=>pm[p.id]=p)
      el2.innerHTML = `<div class="table-wrap"><table class="admin-table">
        <thead><tr><th>Applicant</th><th>Job</th><th>Applied</th><th>Action</th></tr></thead>
        <tbody>${empApps.map(a => {
          const p = pm[a.applicant_user_id]||{}
          const j = empJobs.find(x=>x.id===a.job_id)||{}
          return `<tr>
            <td><strong>${esc(p.full_name||'‚Äî')}</strong></td>
            <td>${esc(j.title||'‚Äî')}</td>
            <td style="font-size:12px;color:var(--text-muted)">${fmtDate(a.created_at)}</td>
            <td><button type="button" class="btn btn-secondary btn-sm" data-action="view-candidate" data-user-id="${esc(a.applicant_user_id)}" data-job-id2="${esc(a.job_id)}">View Profile</button></td>
          </tr>`
        }).join('')}</tbody>
      </table></div>`
      bindJobCardEvents(el2)
    } catch (err) {
      handleError(err, null)
      el2.innerHTML = emptyHTML('‚ö†Ô∏è','Error loading applications',err.message)
    }
  }

  function renderEmpAnalytics() {
    const el2 = el('emp-analytics-cards'); if (!el2) return
    const active = empJobs.filter(j=>j.status==='active').length
    const draft  = empJobs.filter(j=>j.status==='draft').length
    const closed = empJobs.filter(j=>j.status==='closed').length
    el2.innerHTML = `
      <div class="analytics-card"><span class="analytics-num">${empJobs.length}</span><span class="analytics-label">Total Jobs</span></div>
      <div class="analytics-card"><span class="analytics-num">${active}</span><span class="analytics-label">Active</span></div>
      <div class="analytics-card"><span class="analytics-num">${draft}</span><span class="analytics-label">Drafts</span></div>
      <div class="analytics-card"><span class="analytics-num">${closed}</span><span class="analytics-label">Closed</span></div>
      <div class="analytics-card"><span class="analytics-num">${empApps.length}</span><span class="analytics-label">Total Apps</span></div>
      <div class="analytics-card"><span class="analytics-num">${empJobs.length?(empApps.length/empJobs.length).toFixed(1):'‚Äî'}</span><span class="analytics-label">Apps / Job</span></div>`
  }

  async function cycleStatus(jobId, current) {
    const next = current==='active' ? 'closed' : 'active'
    try {
      const { error } = await sb.from('posted_jobs').update({status:next}).eq('id',jobId).eq('employer_id',currentProfile.id)
      if (error) throw error
      await loadEmployerData()
    } catch (err) { handleError(err,'post-job-toast') }
  }

  async function submitJob() {
    if (!currentProfile?.id) {
      showToast('post-job-toast', 'Authentication error. Please log in again.', 'error')
      return
    }
    const title    = v('pj-title').trim()
    const desc     = v('pj-description').trim()
    if (!title || !desc) return showToast('post-job-toast','Title and description are required.','error')
    setBtn('pj-submit-btn', true, 'Posting...')
    try {
      const _pjProvince = v('pj-province') || null
      const _pjTown     = v('pj-town') || null
      const location    = _pjProvince && _pjTown ? `${_pjProvince}, ${_pjTown}` : _pjProvince || _pjTown || ''
      const { error } = await sb.from('posted_jobs').insert({
        employer_id:     currentProfile.id,
        title,
        primary_role:    v('pj-primary-role').trim() || null,
        industry:        v('pj-industry') || null,
        province:        _pjProvince,
        town:            _pjTown,
        location,
        work_type:       v('pj-work-type') || null,
        employment:      v('pj-employment') || null,
        experience:      v('pj-experience') || null,
        urgency_level:   v('pj-urgency') || null,
        required_skills: window._pjSkills && window._pjSkills.length ? window._pjSkills : null,
        salary_min:      v('pj-salary-min') ? parseInt(v('pj-salary-min'),10) : null,
        salary_max:      v('pj-salary-max') ? parseInt(v('pj-salary-max'),10) : null,
        description:     desc,
        expires_at:      v('pj-expires') || null,
        status:          v('pj-status') || 'active'
      })
      if (error) {
        if (error.code==='23505') { showToast('post-job-toast','Duplicate entry detected.','error'); return }
        throw error
      }
      showToast('post-job-toast','‚úÖ Job posted! Running AI matching...','success')
      await loadEmployerData()
      // Refresh public stats so live positions count updates
      loadPublicStats()
      loadPublicJobs()
      setTimeout(async () => {
        closeModal('post-job-modal')
        clearJobForm()
        if (empJobs.length) await viewJobMatches(empJobs[0].id)
      }, 1800)
    } catch (err) {
      handleError(err,'post-job-toast')
    } finally {
      setBtn('pj-submit-btn',false,'Post Position ‚Üí')
    }
  }

  function clearJobForm() {
    ['pj-title','pj-primary-role','pj-industry','pj-province','pj-town','pj-work-type','pj-experience','pj-salary-min','pj-salary-max','pj-description','pj-expires','pj-skills-input'].forEach(id=>{
      const e=el(id); if(e) e.value=''
    })
    window._pjSkills = []
    const tagsEl = el('pj-skills-tags'); if(tagsEl) tagsEl.innerHTML=''
    const townSel = el('pj-town'); if(townSel){ townSel.innerHTML='<option value="">Select province first...</option>' }
  }

  async function loadMatchesForJob() {
    const id = v('match-job-select')
    if (id) await viewJobMatches(id)
  }

  async function viewJobMatches(jobId) {
    showPanel('emp-matches')
    const sel = el('match-job-select'); if(sel) sel.value=jobId
    const res = el('emp-matches-result'); if(!res) return
    res.innerHTML = '<div class="empty-state"><span class="spinner"></span> Running matching engine...</div>'
    const job = empJobs.find(j=>j.id===jobId) || allPublicJobs.find(j=>j.id===jobId) || DEMO_JOBS.find(j=>j.id===jobId)
    if (!job) { res.innerHTML='<div class="empty-state">Job not found</div>'; return }
    try {
      const { data:liveSeekers, error } = await sb.from('job_seekers').select('user_id,full_name,whatsapp,location,province,town,roles,skills,experience_level,years_experience,bio,personality_type,cv_url,salary_min,salary_max,preferred_work_type,education_level,willing_to_relocate').limit(200)
      if (error) throw error
      // Merge live seekers with demo seekers (exclude demo if real user exists with same id)
      const liveIds = new Set((liveSeekers||[]).map(s=>s.user_id))
      const seekers = [...(liveSeekers||[]), ...DEMO_SEEKERS.filter(s=>!liveIds.has(s.user_id))]
      if (!seekers.length) { res.innerHTML=emptyHTML('üë§','No candidates yet','Job seekers will appear here once they complete profiles'); return }
      const scored = seekers.map(s=>({s,r:computeMatch(job,s)})).sort((a,b)=>b.r.score-a.r.score)
      const premium = scored.filter(x=>x.r.label==='Premium Match')
      const strong  = scored.filter(x=>x.r.label==='Strong Match')
      const fit     = scored.filter(x=>x.r.label==='Potential Fit')
      const gems    = scored.filter(x=>x.r.isGem)
      res.innerHTML = `
        <div style="margin-bottom:25px">
          <h3 style="color:var(--emerald);font-weight:700;font-size:1.3em">AI Match Results ‚Äî ${esc(job.title)}</h3>
          <p style="color:var(--text-muted);font-size:14px">${scored.length} candidates ranked &bull; matching ‚â† applying</p>
        </div>
        ${premium.length ? matchSection('‚≠ê Premium Matches', premium, job) : ''}
        ${strong.length  ? matchSection('üíö Strong Matches',  strong,  job) : ''}
        ${fit.length     ? matchSection('üîµ Potential Fits',  fit,     job) : ''}
        ${gems.length    ? matchSection('üíé Hidden Gems (high skills, unexpected fit)', gems, job) : ''}
        ${!scored.length ? emptyHTML('üß†','No matches','No seeker profiles to match against yet') : ''}`
      bindJobCardEvents(res)
    } catch (err) {
      res.innerHTML=`<div class="empty-state">Error: ${esc(err.message)}</div>`
    }
  }

  function matchSection(title, items, job) {
    return `<div style="margin-bottom:35px">
      <div style="font-size:13px;font-weight:700;color:var(--charcoal);margin-bottom:15px;padding:10px 20px;background:var(--light-gold);border-radius:15px;border-left:4px solid var(--gold)">${esc(title)}</div>
      <div class="candidates-grid">${items.map(x=>candidateCard(x.s,x.r,job)).join('')}</div>
    </div>`
  }

  function candidateCard(s, r, job) {
    // Build WhatsApp number from prefix-number format
    let waNum = ''
    if (s.whatsapp) {
      if (s.whatsapp.includes('-')) {
        const parts = s.whatsapp.split('-')
        waNum = parts[0] + parts.slice(1).join('').replace(/\D/g,'')
      } else { waNum = s.whatsapp.replace(/\D/g,'') }
    }
    const explanation = buildMatchExplanation(r)
    const loc = [s.province,s.town,s.location].filter(Boolean).join(', ')
    return `<div class="candidate-card">
      <div class="candidate-header">
        <div class="candidate-avatar">${initials(s.full_name||'?')}</div>
        <div style="flex:1">
          <div class="candidate-name">${esc(s.full_name||'Anonymous')}</div>
          <div class="candidate-role">${esc(loc||'‚Äî')} ‚Ä¢ ${esc(s.experience_level||'‚Äî')}</div>
        </div>
        <div class="match-score-label">
          <span class="match-score-pct">${r.score}%</span>
          <span class="match-score-sub">Match</span>
        </div>
      </div>
      <div class="skill-tags">${(s.roles||[]).slice(0,3).map(x=>`<span class="skill-tag em">${esc(x)}</span>`).join('')}</div>
      <div class="skill-tags">${(s.skills||[]).slice(0,4).map(x=>`<span class="skill-tag plain">${esc(x)}</span>`).join('')}</div>
      <div style="font-size:12px;color:var(--text-muted);background:rgba(4,120,87,0.05);border-radius:10px;padding:8px 12px;border-left:3px solid var(--emerald);margin:8px 0">${esc(explanation)}</div>
      <div class="match-breakdown">
        <div class="match-breakdown-row"><span class="breakdown-label">Role</span><div class="breakdown-bar-wrap"><div class="breakdown-bar" style="width:${(r.role/40)*100}%"></div></div><span class="breakdown-score">${r.role}/40</span></div>
        <div class="match-breakdown-row"><span class="breakdown-label">Skills</span><div class="breakdown-bar-wrap"><div class="breakdown-bar" style="width:${(r.skill/30)*100}%"></div></div><span class="breakdown-score">${r.skill}/30</span></div>
        <div class="match-breakdown-row"><span class="breakdown-label">Experience</span><div class="breakdown-bar-wrap"><div class="breakdown-bar" style="width:${(r.exp/20)*100}%"></div></div><span class="breakdown-score">${r.exp}/20</span></div>
        <div class="match-breakdown-row"><span class="breakdown-label">Location</span><div class="breakdown-bar-wrap"><div class="breakdown-bar" style="width:${(r.loc/10)*100}%"></div></div><span class="breakdown-score">${r.loc}/10</span></div>
      </div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:14px">
        ${waNum ? `<button class="whatsapp-btn" data-action="wa-book" data-wa-phone="${esc(waNum)}" data-wa-name="${esc(s.full_name||'Candidate')}" data-wa-job="${esc(job?.title||'')}">üí¨ Book Interview</button>` : ''}
        <button type="button" class="btn btn-secondary btn-sm" data-action="view-candidate" data-user-id="${esc(s.user_id)}" data-job-id2="">View Profile</button>
        ${r.isGem ? `<span class="match-score-badge match-gem">üíé Hidden Gem</span>` : ''}
      </div>
    </div>`
  }

  async function viewCandidateDetail(userId, jobId) {
    try {
      const { data:s, error } = await sb.from('job_seekers').select('*').eq('user_id',userId).single()
      if (error) throw error
      if (!s) { showToast('auth-toast','Profile not found','error'); return }
      const job    = jobId ? empJobs.find(j=>j.id===jobId) : null
      const r      = job ? computeMatch(job, { ...s, province:s.province||s.location||'' }) : null
      // Parse whatsapp: could be "263-771234567" or "+263771234567" or plain number
      let waNum = ''
      if (s.whatsapp) {
        if (s.whatsapp.includes('-')) {
          const parts = s.whatsapp.split('-')
          waNum = parts[0] + parts.slice(1).join('').replace(/\D/g,'')
        } else { waNum = s.whatsapp.replace(/\D/g,'') }
      }
      const waLink = waNum ? `https://wa.me/${waNum}?text=${encodeURIComponent(`Hello ${s.full_name}, I found your profile on ZimGetHired and would like to discuss an opportunity.`)}` : null
      const cdc = el('candidate-detail-content')
      if (!cdc) return
      cdc.innerHTML = `
        <div style="display:flex;align-items:center;gap:20px;margin-bottom:30px;flex-wrap:wrap">
          <div class="candidate-avatar" style="width:70px;height:70px;font-size:22px;flex-shrink:0">${initials(s.full_name||'‚Äî')}</div>
          <div style="flex:1">
            <div style="font-size:1.5em;font-weight:800;color:var(--emerald)">${esc(s.full_name||'‚Äî')}</div>
            <div style="color:var(--text-muted);font-size:14px">${esc(s.location||'‚Äî')} ‚Ä¢ ${esc(s.experience_level||'‚Äî')}</div>
          </div>
          ${r ? `<div style="text-align:center;background:linear-gradient(135deg,var(--emerald),var(--deep-emerald));color:white;padding:20px 25px;border-radius:20px"><div style="font-size:2.5em;font-weight:800;line-height:1">${r.score}%</div><div style="font-size:11px;opacity:0.85;text-transform:uppercase;letter-spacing:1px;margin-top:4px">Match Score</div></div>` : ''}
        </div>
        ${s.bio ? `<p style="color:var(--text-muted);font-size:14px;line-height:1.8;margin-bottom:25px">${esc(s.bio)}</p>` : ''}
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:25px">
          <div>
            <div style="font-size:12px;font-weight:700;color:var(--emerald);text-transform:uppercase;letter-spacing:1px;margin-bottom:10px">Roles</div>
            <div class="skill-tags">${(s.roles||[]).map(r2=>`<span class="skill-tag em">${esc(r2)}</span>`).join('')||'‚Äî'}</div>
          </div>
          <div>
            <div style="font-size:12px;font-weight:700;color:var(--emerald);text-transform:uppercase;letter-spacing:1px;margin-bottom:10px">Skills</div>
            <div class="skill-tags">${(s.skills||[]).map(sk=>`<span class="skill-tag plain">${esc(sk)}</span>`).join('')||'‚Äî'}</div>
          </div>
        </div>
        ${r ? `<div class="explanation"><strong>Match Breakdown</strong><br/><div class="match-breakdown" style="margin-top:15px">
          <div class="match-breakdown-row"><span class="breakdown-label">Role Overlap (max 40)</span><div class="breakdown-bar-wrap"><div class="breakdown-bar" style="width:${(r.role/40)*100}%"></div></div><span class="breakdown-score">${r.role}/40</span></div>
          <div class="match-breakdown-row"><span class="breakdown-label">Skills Match (max 30)</span><div class="breakdown-bar-wrap"><div class="breakdown-bar" style="width:${(r.skill/30)*100}%"></div></div><span class="breakdown-score">${r.skill}/30</span></div>
          <div class="match-breakdown-row"><span class="breakdown-label">Experience (max 20)</span><div class="breakdown-bar-wrap"><div class="breakdown-bar" style="width:${(r.exp/20)*100}%"></div></div><span class="breakdown-score">${r.exp}/20</span></div>
          <div class="match-breakdown-row"><span class="breakdown-label">Location (max 10)</span><div class="breakdown-bar-wrap"><div class="breakdown-bar" style="width:${((r.loc||0)/10)*100}%"></div></div><span class="breakdown-score">${r.loc||0}/10</span></div>
        </div></div>` : ''}
        <div style="display:flex;gap:12px;flex-wrap:wrap;margin-top:20px">
          ${waNum ? `<button class="whatsapp-btn" data-action="wa-book" data-wa-phone="${esc(waNum)}" data-wa-name="${esc(s.full_name||'Candidate')}" data-wa-job="${esc(job?.title||'')}">üí¨ Book Interview</button>` : ''}
          ${s.cv_url ? `<a class="btn btn-primary btn-sm" href="${esc(s.cv_url)}" target="_blank" rel="noopener noreferrer">üìÑ View CV</a>` : ''}
          ${s.intro_video_url ? `<a class="btn btn-secondary btn-sm" href="${esc(s.intro_video_url)}" target="_blank" rel="noopener noreferrer">üé¨ Intro Video</a>` : ''}
        </div>`
      openModal('candidate-modal')
      bindJobCardEvents(el('candidate-detail-content'))
    } catch (err) {
      handleError(err, 'auth-toast')
      console.error('[viewCandidateDetail]', err)
    }
  }

  async function searchTalent() {
    const roleQ = v('ts-role').trim()
    const locQ  = v('ts-location').trim()
    const sklQ  = v('ts-skills').trim()
    const expQ  = v('ts-exp')
    const resEl = el('talent-search-results')
    if (!roleQ && !sklQ) { resEl.innerHTML='<div class="empty-state">Enter a role or skills to search</div>'; return }
    const searchBtn = document.querySelector('[data-action="search-talent"]')
    if (searchBtn) searchBtn.disabled = true
    resEl.innerHTML = '<div class="empty-state"><span class="spinner"></span> Searching talent...</div>'
    try {
      const { data:liveSeekers, error } = await sb.from('job_seekers').select('user_id,full_name,whatsapp,location,province,town,roles,skills,experience_level,years_experience,bio,personality_type,salary_min,salary_max,preferred_work_type,education_level,willing_to_relocate').limit(200)
      if (error) throw error
      // Merge live + demo seekers
      const liveIds = new Set((liveSeekers||[]).map(s=>s.user_id))
      const seekers = [...(liveSeekers||[]), ...DEMO_SEEKERS.filter(s=>!liveIds.has(s.user_id))]
      const synJob = { title:roleQ, primary_role:roleQ, required_skills:sklQ, experience:expQ }
      let results = seekers.map(s=>({s,r:computeMatch(synJob,s)}))
      if (locQ) { const lq=locQ.toLowerCase(); results = results.filter(x=>{ const loc=(x.s.province||x.s.location||'').toLowerCase(); return !loc || loc.includes(lq) || lq.includes(loc.split(' ')[0]) }) }
      results.sort((a,b)=>b.r.score-a.r.score)
      searchHistory.unshift({ts:new Date().toISOString(),role:roleQ,skills:sklQ,exp:expQ,loc:locQ,count:results.length})
      renderSearchHistory()
      sb.from('employer_search_log').insert({
        employer_id:currentProfile.id, search_role:roleQ, search_skills:sklQ,
        search_exp:expQ, search_location:locQ, result_count:results.length
      }).then(({error:e})=>{ if(e) console.warn('[SearchLog]',e.message) })
      if (!results.length) { resEl.innerHTML=emptyHTML('üîç','No candidates found','Try broadening your search criteria'); return }
      resEl.innerHTML = `
        <div style="font-size:13px;color:var(--text-muted);margin-bottom:20px">${results.length} candidates ranked by AI match score</div>
        <div class="candidates-grid">${results.slice(0,24).map(x=>candidateCard(x.s,x.r,synJob)).join('')}</div>`
      bindJobCardEvents(resEl)
    } catch (err) {
      handleError(err,null)
      resEl.innerHTML=`<div class="empty-state">Error: ${esc(err.message)}</div>`
    } finally {
      if (searchBtn) searchBtn.disabled = false
    }
  }

  function renderSearchHistory() {
    const el2 = el('emp-search-history'); if(!el2||!searchHistory.length) return
    el2.innerHTML = `<div class="table-wrap"><table class="admin-table">
      <thead><tr><th>Time</th><th>Role</th><th>Skills</th><th>Location</th><th>Results</th></tr></thead>
      <tbody>${searchHistory.slice(0,20).map(e=>`<tr>
        <td style="font-size:12px;color:var(--text-muted)">${fmtDate(e.ts)}</td>
        <td>${esc(e.role||'‚Äî')}</td><td>${esc(e.skills||'‚Äî')}</td>
        <td>${esc(e.loc||'‚Äî')}</td><td><strong>${e.count}</strong></td>
      </tr>`).join('')}</tbody>
    </table></div>`
  }

  // ===== JOB SEEKER DATA ====================================================

  async function loadSeekerData() {
    if (!currentProfile) return
    try {
      const { data:sp, error } = await sb.from('job_seekers').select('*').eq('user_id',currentProfile.id).single()
      if (error && error.code!=='PGRST116') throw error
      seekerProfile = sp || null
      if (sp) {
        seekerRoles              = Array.isArray(sp.roles)               ? sp.roles               : []
        seekerSkills             = Array.isArray(sp.skills)              ? sp.skills              : []
        seekerCertifications     = Array.isArray(sp.certifications)      ? sp.certifications      : []
        seekerLanguages          = Array.isArray(sp.languages)           ? sp.languages           : []
        seekerIndustryPrefs      = Array.isArray(sp.industry_preferences)? sp.industry_preferences: []
        populateSeekerForm(sp)
      } else {
        const fn = el('sk-fullname'); if(fn) fn.value = currentProfile.full_name||''
        renderAvatarEl('sk-avatar-display', null, currentProfile.full_name)
      }
    } catch (err) { console.warn('[loadSeekerData]',err.message) }
    try { updateProfileCompletion() } catch(err) { console.warn('[updateProfileCompletion]',err.message) }
    try { loadSeekerMatches() } catch(err) { console.warn('[loadSeekerMatches]',err.message) }
    try { loadSeekerApps() } catch(err) { console.warn('[loadSeekerApps]',err.message) }
  }

  function populateSeekerForm(sp) {
    const set = (id,val) => { const e=el(id); if(e&&val!=null) e.value=val }
    set('sk-fullname',    sp.full_name||currentProfile?.full_name||'')
    set('sk-province',    sp.province||'')
    set('sk-town',        sp.town_city||'')
    set('sk-relocation',  sp.relocation_preference||'')
    set('sk-exp-level',   sp.experience_level||'')
    set('sk-bio',         sp.bio||'')
    set('sk-cv-url',      sp.cv_url||'')
    set('sk-video-url',   sp.intro_video_url||'')
    set('sk-personality', sp.personality_type||'')
    set('sk-education-level',     sp.education_level||'')
    set('sk-preferred-work-type', sp.preferred_work_type||'')
    set('sk-years-experience',    sp.years_experience!=null ? sp.years_experience : '')
    set('sk-salary-min',          sp.salary_min!=null ? sp.salary_min : '')
    set('sk-salary-max',          sp.salary_max!=null ? sp.salary_max : '')
    set('sk-qualifications',      sp.qualifications||'')
    set('sk-work-history',        sp.work_history||'')
    const relocateChk = el('sk-willing-to-relocate')
    if (relocateChk) relocateChk.checked = !!sp.willing_to_relocate
    seekerCertifications = Array.isArray(sp.certifications) ? sp.certifications : []
    seekerLanguages      = Array.isArray(sp.languages)      ? sp.languages      : []
    seekerIndustryPrefs  = Array.isArray(sp.industry_preferences) ? sp.industry_preferences : []
    // WhatsApp prefix parsing
    if (sp.whatsapp) {
      if (sp.whatsapp.includes('-')) {
        const parts = sp.whatsapp.split('-')
        set('sk-wa-prefix', parts[0]||'263')
        set('sk-whatsapp', parts.slice(1).join('-'))
      } else {
        set('sk-whatsapp', sp.whatsapp)
      }
    }
    renderChips('sk-roles-chips',   seekerRoles,          'role')
    renderChips('sk-skills-chips',  seekerSkills,         'skill')
    renderChips('sk-certs-chips',   seekerCertifications, 'cert')
    renderChips('sk-langs-chips',   seekerLanguages,      'lang')
    renderChips('sk-indpref-chips', seekerIndustryPrefs,  'indpref')
    // ‚îÄ‚îÄ Populate uploaded-file state and displays ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    if (sp.profile_picture_url) {
      seekerPicUrl = sp.profile_picture_url
    }
    if (sp.cv_url) {
      seekerCvUrl = sp.cv_url
      const viewDiv  = el('sk-cv-view')
      const viewLink = el('sk-cv-link')
      if (viewLink) viewLink.href = sp.cv_url
      if (viewDiv)  viewDiv.style.display = 'block'
    }
    if (sp.intro_video_url) {
      seekerVideoUrl = sp.intro_video_url
      const viewDiv  = el('sk-video-view')
      const viewLink = el('sk-video-link')
      if (viewLink) viewLink.href = sp.intro_video_url
      if (viewDiv)  viewDiv.style.display = 'block'
    }
    renderAvatarEl('sk-avatar-display', seekerPicUrl, sp.full_name || currentProfile?.full_name)
  }

  async function saveProfile() {
    const fullName  = v('sk-fullname').trim()
    const province  = v('sk-province')
    const town_city = v('sk-town').trim()
    const expLevel  = v('sk-exp-level')

    // ‚îÄ‚îÄ Frontend validation ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    if (!fullName)               { showToast('sk-profile-toast','‚ö†Ô∏è Full name is required.','error'); return }
    if (!province)               { showToast('sk-profile-toast','‚ö†Ô∏è Province is required.','error'); return }
    if (!town_city)              { showToast('sk-profile-toast','‚ö†Ô∏è Town / City is required.','error'); return }
    if (!expLevel)               { showToast('sk-profile-toast','‚ö†Ô∏è Experience level is required.','error'); return }
    if (!seekerRoles.length)     { showToast('sk-profile-toast','‚ö†Ô∏è Add at least one professional role.','error'); return }

    setBtn('sk-save-btn',true,'Saving...')
    try {
      const { error:ue } = await sb.from('users').update({full_name:fullName}).eq('id',currentProfile.id)
      if (ue) throw ue

      const waNum    = v('sk-whatsapp').trim().replace(/\D/g,'')
      const whatsapp = waNum ? `${v('sk-wa-prefix')}-${waNum}` : null

      const payload = {
        user_id:             currentProfile.id,
        full_name:           fullName,
        whatsapp,
        province,
        town_city,
        relocation_preference: v('sk-relocation')||null,
        experience_level:    expLevel,
        bio:                 v('sk-bio').trim()||null,
        cv_url:              seekerCvUrl || v('sk-cv-url').trim() || null,
        intro_video_url:     seekerVideoUrl || v('sk-video-url').trim() || null,
        profile_picture_url: seekerPicUrl || null,
        personality_type:    v('sk-personality')||null,
        roles:               Array.isArray(seekerRoles)          ? seekerRoles          : [],
        skills:              Array.isArray(seekerSkills)         ? seekerSkills         : [],
        certifications:      Array.isArray(seekerCertifications) ? seekerCertifications : [],
        languages:           Array.isArray(seekerLanguages)      ? seekerLanguages      : [],
        industry_preferences:Array.isArray(seekerIndustryPrefs)  ? seekerIndustryPrefs  : [],
        education_level:     v('sk-education-level')||null,
        preferred_work_type: v('sk-preferred-work-type')||null,
        years_experience:    v('sk-years-experience')!=='' ? Number(v('sk-years-experience')) : null,
        salary_min:          v('sk-salary-min')!==''       ? Number(v('sk-salary-min'))       : null,
        salary_max:          v('sk-salary-max')!==''       ? Number(v('sk-salary-max'))       : null,
        qualifications:      v('sk-qualifications').trim()||null,
        work_history:        v('sk-work-history').trim()||null,
        willing_to_relocate: !!(el('sk-willing-to-relocate')?.checked),
        is_public:           true
      }

      const { error } = await sb.from('job_seekers').upsert(payload,{onConflict:'user_id'})
      if (error) throw error
      seekerProfile = payload
      currentProfile.full_name = fullName
      setText('dash-name', fullName)
      showToast('sk-profile-toast','‚úÖ Profile saved successfully!','success')
      updateProfileCompletion()
      loadSeekerMatches()
    } catch (err) { handleError(err,'sk-profile-toast') }
    finally { setBtn('sk-save-btn',false,'Save Profile') }
  }

  function updateProfileCompletion() {
    const sp = seekerProfile||{}
    const checks = [
      sp.full_name||currentProfile?.full_name, sp.whatsapp, sp.province,
      sp.town_city, sp.experience_level, sp.bio,
      (sp.roles||seekerRoles).length>0,
      (sp.skills||seekerSkills).length>0,
      sp.cv_url
    ]
    const done = checks.filter(Boolean).length
    const pct  = Math.round((done/checks.length)*100)
    const bar  = el('sk-progress-bar'); if(bar) bar.style.width=pct+'%'
    const pctEl= el('sk-pct'); if(pctEl) pctEl.textContent=pct+'%'
    const tip  = el('sk-progress-tip')
    if (tip) {
      const missing = ['Name','WhatsApp','Province','Town/City','Experience','Bio','Roles','Skills','CV'].filter((_,i)=>!checks[i])
      tip.textContent = missing.length ? 'Missing: '+missing.join(', ') : 'üéâ Profile complete! You are visible to employers.'
    }
  }

  async function loadSeekerMatches() {
    const grid = el('sk-matches-grid')
    const top  = el('sk-top-matches')
    if (!grid) return
    grid.innerHTML = '<div class="empty-state"><span class="spinner"></span></div>'
    const seeker = {
      roles:seekerRoles, skills:seekerSkills,
      experience_level:seekerProfile?.experience_level||'',
      years_experience:seekerProfile?.years_experience||null,
      personality_type:seekerProfile?.personality_type||'',
      province:seekerProfile?.province||seekerProfile?.location||'',
      location:seekerProfile?.province||seekerProfile?.location||'',
      salary_min:seekerProfile?.salary_min||null,
      salary_max:seekerProfile?.salary_max||null,
      preferred_work_type:seekerProfile?.preferred_work_type||'',
      education_level:seekerProfile?.education_level||'',
      willing_to_relocate:seekerProfile?.willing_to_relocate||false
    }
    try {
      const { data:liveJobs, error } = await sb
        .from('posted_jobs')
        .select('id,title,primary_role,required_skills,experience,province,town,employment,salary_min,salary_max,description,status,urgency_level,expires_at')
        .eq('status','active')
      if (error) throw error
      // Merge live + demo jobs so matching engine always has data
      const liveIds = new Set((liveJobs||[]).map(j=>j.id))
      const jobs = [...(liveJobs||[]), ...DEMO_JOBS.filter(j=>!liveIds.has(j.id))]
      if (!jobs.length) {
        grid.innerHTML = emptyHTML('‚ú®','No active jobs available','Check back soon!')
        setText('sk-stat-matches','0')
        return
      }
      const scored = jobs.map(j=>({j,r:computeMatch(j,seeker)})).sort((a,b)=>b.r.score-a.r.score)
      setText('sk-stat-matches', scored.length)
      setText('sk-stat-top', scored[0]?.r.score ? scored[0].r.score+'%' : '‚Äî')
      grid.innerHTML = scored.map(({j,r})=>`<div class="job-card">
        <div class="job-card-header">
          <div class="job-title-text">${esc(j.title)}</div>
          <span class="match-score-badge ${matchClass(r.label)}">${r.score}% Match</span>
        </div>
        <div class="job-meta">
          ${(j.province||j.town||j.location) ? `<span class="meta-chip">üìç ${esc(j.province&&j.town ? j.province+' - '+j.town : j.province||j.town||j.location)}</span>` : ''}
          ${j.employment ? `<span class="meta-chip">${esc(j.employment)}</span>` : ''}
          ${fmtSal(j.salary_min,j.salary_max) ? `<span class="meta-chip sal">${fmtSal(j.salary_min,j.salary_max)}</span>` : ''}
        </div>
        <div class="match-breakdown">
          <div class="match-breakdown-row"><span class="breakdown-label">Role</span><div class="breakdown-bar-wrap"><div class="breakdown-bar" style="width:${(r.role/40)*100}%"></div></div><span class="breakdown-score">${r.role}/40</span></div>
          <div class="match-breakdown-row"><span class="breakdown-label">Skills</span><div class="breakdown-bar-wrap"><div class="breakdown-bar" style="width:${(r.skill/30)*100}%"></div></div><span class="breakdown-score">${r.skill}/30</span></div>
        </div>
        <div class="job-actions">
          <button type="button" class="btn btn-primary btn-sm" data-action="apply-job" data-job-id="${esc(j.id)}">Apply Now ‚Üí</button>
          <button type="button" class="btn btn-secondary btn-sm" data-action="view-job-detail" data-job-id="${esc(j.id)}">Details</button>
        </div>
      </div>`).join('')
      bindJobCardEvents(grid)
      if (top) {
        top.innerHTML = scored.slice(0,3).map(({j,r})=>`
          <div style="display:flex;align-items:center;gap:15px;padding:15px 20px;background:white;border-radius:15px;margin-bottom:12px;border:1px solid rgba(4,120,87,0.1);box-shadow:0 2px 8px rgba(4,120,87,0.06)">
            <div style="flex:1">
              <div style="font-weight:700;color:var(--text-dark)">${esc(j.title)}</div>
              <div style="font-size:12px;color:var(--text-muted)">${esc(j.province&&j.town ? j.province+' - '+j.town : j.province||j.town||j.location||'‚Äî')}</div>
            </div>
            <span class="match-score-badge ${matchClass(r.label)}">${r.score}% Match</span>
            <button type="button" class="btn btn-primary btn-sm" data-action="apply-job" data-job-id="${esc(j.id)}">Apply</button>
          </div>`).join('')
        bindJobCardEvents(top)
      }
    } catch (err) {
      grid.innerHTML=`<div class="empty-state">Error: ${esc(err.message)}</div>`
    }
  }

  async function loadSeekerApps() {
    const el2 = el('sk-apps-list'); if(!el2) return
    try {
      const { data:apps, error } = await sb
        .from('applications')
        .select('id,job_id,created_at,posted_jobs(title,province,town,status)')
        .eq('applicant_user_id', currentProfile.id)
        .order('created_at',{ascending:false})
      if (error) throw error
      setText('sk-stat-apps', apps?.length||0)
      if (!apps?.length) { el2.innerHTML=emptyHTML('üìù','No applications yet','Apply to jobs from Matched Jobs or the Job Board'); return }
      el2.innerHTML = `<div class="table-wrap"><table class="admin-table">
        <thead><tr><th>Job Title</th><th>Location</th><th>Job Status</th><th>Applied</th></tr></thead>
        <tbody>${apps.map(a=>{
          const j=a.posted_jobs||{}
          const sc=j.status==='active'?'job-status-active':'job-status-closed'
          const loc = j.province&&j.town ? j.province+' - '+j.town : j.province||j.town||'‚Äî'
          return `<tr>
            <td><strong>${esc(j.title||'‚Äî')}</strong></td>
            <td>${esc(loc)}</td>
            <td><span class="job-status-badge ${sc}" style="position:static">${esc(j.status||'‚Äî')}</span></td>
            <td style="font-size:12px;color:var(--text-muted)">${fmtDate(a.created_at)}</td>
          </tr>`
        }).join('')}</tbody>
      </table></div>`
    } catch (err) {
      el2.innerHTML=emptyHTML('‚ö†Ô∏è','Error loading applications',err.message)
    }
  }

  async function applyToJob(jobId) {
    if (!currentProfile) return openAuth('login')
    if (currentProfile.role!=='jobseeker') {
      showToast('auth-toast','Only job seekers can apply.','error')
      return
    }
    try {
      const { error } = await sb.from('applications').insert({job_id:jobId, applicant_user_id:currentProfile.id})
      if (error) {
        if (error.code==='23505') { showToast('auth-toast','You have already applied for this position.','error'); return }
        throw error
      }
      showToast('auth-toast','‚úÖ Application submitted!','success')
      loadSeekerApps()
      // Refresh stats so application count updates
      loadPublicStats()
    } catch (err) {
      handleError(err,'auth-toast')
    }
  }

  // Profile chips
  function addRoleChip() {
    const i=el('sk-role-input'); const val=i.value.trim()
    if (!val||seekerRoles.includes(val)){ i.value=''; return }
    seekerRoles.push(val); i.value=''; renderChips('sk-roles-chips',seekerRoles,'role')
  }
  function addSkillChip() {
    const i=el('sk-skill-input'); const val=i.value.trim()
    if (!val||seekerSkills.includes(val)){ i.value=''; return }
    seekerSkills.push(val); i.value=''; renderChips('sk-skills-chips',seekerSkills,'skill')
  }
  function addCertChip() {
    const i=el('sk-cert-input'); const val=i.value.trim()
    if (!val||seekerCertifications.includes(val)){ i.value=''; return }
    seekerCertifications.push(val); i.value=''; renderChips('sk-certs-chips',seekerCertifications,'cert')
  }
  function addLangChip() {
    const i=el('sk-lang-input'); const val=i.value.trim()
    if (!val||seekerLanguages.includes(val)){ i.value=''; return }
    seekerLanguages.push(val); i.value=''; renderChips('sk-langs-chips',seekerLanguages,'lang')
  }
  function addIndPrefChip() {
    const i=el('sk-indpref-input'); const val=i.value.trim()
    if (!val||seekerIndustryPrefs.includes(val)){ i.value=''; return }
    seekerIndustryPrefs.push(val); i.value=''; renderChips('sk-indpref-chips',seekerIndustryPrefs,'indpref')
  }
  function removeChip(type, val) {
    if (type==='role')    { seekerRoles=seekerRoles.filter(r=>r!==val);                     renderChips('sk-roles-chips',seekerRoles,'role') }
    if (type==='skill')   { seekerSkills=seekerSkills.filter(s=>s!==val);                   renderChips('sk-skills-chips',seekerSkills,'skill') }
    if (type==='cert')    { seekerCertifications=seekerCertifications.filter(c=>c!==val);   renderChips('sk-certs-chips',seekerCertifications,'cert') }
    if (type==='lang')    { seekerLanguages=seekerLanguages.filter(l=>l!==val);             renderChips('sk-langs-chips',seekerLanguages,'lang') }
    if (type==='indpref') { seekerIndustryPrefs=seekerIndustryPrefs.filter(p=>p!==val);    renderChips('sk-indpref-chips',seekerIndustryPrefs,'indpref') }
  }
  function renderChips(elId, arr, type) {
    const c=el(elId); if(!c) return
    c.innerHTML=arr.map(v2=>{
      const escaped=esc(v2)
      return `<div class="chip-removable">${escaped}<span class="chip-remove" data-chip-type="${type}" data-chip-val="${escaped}" role="button" tabindex="0" aria-label="Remove ${escaped}">‚úï</span></div>`
    }).join('')
    c.querySelectorAll('.chip-remove').forEach(btn=>{
      btn.addEventListener('click', ()=>removeChip(btn.dataset.chipType, btn.dataset.chipVal))
      btn.addEventListener('keydown', e=>{ if(e.key==='Enter'||e.key===' ') removeChip(btn.dataset.chipType, btn.dataset.chipVal) })
    })
  }

  // ===== ADMIN DATA =========================================================

  async function loadAdminData() {
    try {
      const [ur,jr,ar] = await Promise.all([
        sb.from('users').select('id,full_name,role,created_at').order('created_at',{ascending:false}),
        sb.from('posted_jobs').select('id,title,primary_role,province,town,status,created_at').order('created_at',{ascending:false}),
        sb.from('applications').select('id,job_id,applicant_user_id,created_at').order('created_at',{ascending:false})
      ])
      if (ur.error) throw ur.error
      if (jr.error) throw jr.error
      if (ar.error) throw ar.error
      const users=ur.data||[], jobs=jr.data||[], apps=ar.data||[]
      const seekers=users.filter(u=>u.role==='jobseeker')
      const employers=users.filter(u=>u.role==='employer')
      const active=jobs.filter(j=>j.status==='active')
      setText('ad-users',users.length); setText('ad-seekers',seekers.length)
      setText('ad-employers',employers.length); setText('ad-jobs',jobs.length)
      setText('ad-active',active.length); setText('ad-apps',apps.length)
      updateLiveStats(users.length,seekers.length,employers.length,jobs.length,active.length,apps.length)
      const tbl = (id,head,rows) => {
        const w=el(id); if(!w) return
        w.innerHTML=`<div class="table-wrap"><table class="admin-table"><thead><tr>${head.map(h=>`<th>${h}</th>`).join('')}</tr></thead><tbody>${rows}</tbody></table></div>`
      }
      tbl('admin-users-wrap',['Name','Role','Joined'],
        users.map(u=>`<tr>
          <td><strong>${esc(u.full_name||'‚Äî')}</strong></td>
          <td><span class="job-status-badge ${u.role==='employer'?'job-status-active':'job-status-draft'}" style="position:static">${esc(u.role)}</span></td>
          <td style="font-size:12px;color:var(--text-muted)">${fmtDate(u.created_at)}</td>
        </tr>`).join(''))
      tbl('admin-jobs-wrap',['Title','Primary Role','Location','Status','Posted'],
        jobs.map(j=>`<tr>
          <td><strong>${esc(j.title||'‚Äî')}</strong></td>
          <td>${esc(j.primary_role||'‚Äî')}</td>
          <td>${j.province&&j.town ? esc(j.province)+' - '+esc(j.town) : j.province ? esc(j.province) : '‚Äî'}</td>
          <td><span class="job-status-badge ${j.status==='active'?'job-status-active':j.status==='draft'?'job-status-draft':'job-status-closed'}" style="position:static">${esc(j.status)}</span></td>
          <td style="font-size:12px;color:var(--text-muted)">${fmtDate(j.created_at)}</td>
        </tr>`).join(''))
      tbl('admin-apps-wrap',['Applicant ID','Job ID','Applied'],
        apps.map(a=>`<tr>
          <td style="font-size:12px;color:var(--text-muted)">${esc(a.applicant_user_id?.slice(0,12))}‚Ä¶</td>
          <td style="font-size:12px;color:var(--text-muted)">${esc(a.job_id?.slice(0,12))}‚Ä¶</td>
          <td style="font-size:12px;color:var(--text-muted)">${fmtDate(a.created_at)}</td>
        </tr>`).join(''))
    } catch (err) {
      handleError(err,null)
      console.error('[loadAdminData]',err)
    }
    try {
      const { data:logs, error } = await sb.from('employer_search_log').select('*').order('created_at',{ascending:false}).limit(50)
      if (error) throw error
      const lw = el('admin-logs-wrap')
      if (lw && logs?.length) {
        lw.innerHTML = `<div class="table-wrap"><table class="admin-table"><thead><tr><th>Employer</th><th>Role</th><th>Skills</th><th>Location</th><th>Results</th><th>Time</th></tr></thead><tbody>${logs.map(l=>`<tr>
          <td style="font-size:12px;color:var(--text-muted)">${esc(l.employer_id?.slice(0,10))}‚Ä¶</td>
          <td>${esc(l.search_role||'‚Äî')}</td>
          <td>${esc(l.search_skills||'‚Äî')}</td>
          <td>${esc(l.search_location||'‚Äî')}</td>
          <td><strong>${l.result_count??'‚Äî'}</strong></td>
          <td style="font-size:12px;color:var(--text-muted)">${fmtDate(l.created_at)}</td>
        </tr>`).join('')}</tbody></table></div>`
      } else if (lw) {
        lw.innerHTML = emptyHTML('üîç','No search logs yet','Employer searches will be logged here')
      }
    } catch (err) { console.warn('[AdminLogs]',err.message) }
  }


  // ===== ADMIN PORTAL LOGIN =============================================
  const ADMIN_PASSWORD = 'ZimAdmin2025!'

  function handleAdminPortalLogin() {
    const pass = document.getElementById('admin-portal-pass')?.value
    if (!pass) return showToast('admin-portal-toast', 'Please enter the admin password.', 'error')
    if (pass === ADMIN_PASSWORD) {
      closeModal('admin-portal-modal')
      // Create a temporary admin profile and open dashboard
      currentProfile = { id:'admin-portal', full_name:'Administrator', role:'admin', email:'admin@zimgethired.com', created_at:new Date().toISOString() }
      initDashboard(currentProfile)
    } else {
      showToast('admin-portal-toast', '‚ùå Incorrect password. Please try again.', 'error')
      document.getElementById('admin-portal-pass').value = ''
    }
  }

  // ===== WHATSAPP INTERVIEW =============================================
  let _waInterviewTarget = null

  function openWaInterviewModal(phone, name, jobTitle) {
    _waInterviewTarget = { phone, name, jobTitle }
    const today = new Date(); today.setDate(today.getDate()+3)
    const dateInput = el('wa-interview-date')
    if (dateInput) dateInput.value = today.toISOString().split('T')[0]
    el('wa-interview-time').value = '10:00'
    updateWaPreview()
    openModal('wa-interview-modal')
  }

  function updateWaPreview() {
    if (!_waInterviewTarget) return
    const { name, jobTitle } = _waInterviewTarget
    const date = v('wa-interview-date')
    const time = v('wa-interview-time')
    const dateStr = date ? new Date(date).toLocaleDateString('en-GB',{weekday:'long',day:'numeric',month:'long'}) : '[date]'
    const timeStr = time || '[time]'
    const msg = `Hi ${name}, your profile seems like a great match for our ${jobTitle} position. We would love to get to know you better ‚Äî would you be available for a quick interview on ${dateStr} at ${timeStr}? Looking forward to connecting!`
    const msgEl = el('wa-interview-msg'); if (msgEl) msgEl.value = msg
    updateWaSendLink()
  }

  function updateWaSendLink() {
    if (!_waInterviewTarget) return
    const phone = (_waInterviewTarget.phone || '').replace(/\D/g,'')
    const msg = v('wa-interview-msg')
    const link = el('wa-interview-send')
    if (link && phone && msg) {
      link.href = `https://wa.me/${phone}?text=${encodeURIComponent(msg)}`
    }
  }

  // ===== SEEKER SELF MATCH TEST ==========================================
  function openSeekerMatchModal(jobId) {
    if (!currentProfile) return openAuth('login')
    const job = allPublicJobs.find(j=>j.id===jobId) || DEMO_JOBS.find(j=>j.id===jobId)
    if (!job) return
    const seeker = {
      roles: seekerRoles,
      skills: seekerSkills,
      experience_level: seekerProfile?.experience_level || '',
      years_experience: seekerProfile?.years_experience || null,
      province: seekerProfile?.province || seekerProfile?.location || '',
      location: seekerProfile?.province || seekerProfile?.location || '',
      salary_min: seekerProfile?.salary_min || null,
      salary_max: seekerProfile?.salary_max || null,
      preferred_work_type: seekerProfile?.preferred_work_type || '',
      education_level: seekerProfile?.education_level || '',
      willing_to_relocate: seekerProfile?.willing_to_relocate || false
    }
    const r = computeMatch(job, seeker)
    const explanation = buildMatchExplanation(r)
    const sub = el('seeker-match-sub')
    if (sub) sub.textContent = `Match results for: ${job.title}`
    const content = el('seeker-match-content')
    if (!content) return
    content.innerHTML = `
      <div style="text-align:center;margin:20px 0">
        <div style="font-size:4em;font-weight:800;color:var(--emerald);line-height:1">${r.score}%</div>
        <div style="margin-top:8px"><span class="match-score-badge ${matchClass(r.label)}">${r.label}</span></div>
      </div>
      <div class="match-explanation" style="margin-bottom:20px;font-size:14px;font-style:normal;padding:14px 18px;background:rgba(4,120,87,0.05);border-radius:12px;border-left:3px solid var(--emerald)">${esc(explanation)}</div>
      <div class="match-breakdown">
        ${[['Role Overlap',r.role,40],['Skills',r.skill,30],['Experience',r.exp,20],['Location',r.loc,10]].map(([lbl,score,max])=>`
          <div class="match-breakdown-row"><span class="breakdown-label">${lbl}</span><div class="breakdown-bar-wrap"><div class="breakdown-bar" style="width:${(score/max)*100}%"></div></div><span class="breakdown-score">${score}/${max}</span></div>`).join('')}
      </div>
      ${r.score < 60 ? `<div style="background:var(--light-gold);border-radius:12px;padding:14px 18px;border-left:4px solid var(--gold);margin-top:18px;font-size:13px">üí° <strong>Tip:</strong> Add more matching roles and skills to your profile to improve your score.</div>` : ''}
      <div style="display:flex;gap:10px;margin-top:20px">
        <button type="button" class="btn btn-primary btn-sm" data-action="apply-job" data-job-id="${esc(job.id)}">Apply Now ‚Üí</button>
      </div>`
    const applyBtn = content.querySelector('[data-action="apply-job"]')
    applyBtn?.addEventListener('click', ()=>{ applyToJob(job.id); closeModal('seeker-match-modal') })
    openModal('seeker-match-modal')
  }

  // ===== DELETE ACCOUNT =================================================
  async function handleDeleteAccount() {
    const confirmText = v('delete-confirm-text')
    if (confirmText !== 'DELETE') { showToast('delete-account-toast', 'Type DELETE exactly to confirm.', 'error'); return }
    setBtn('delete-account-confirm-btn', true, 'Deleting...')
    try {
      if (currentProfile?.id && currentProfile.id !== 'admin-portal') {
        // Delete profile-level data only (RLS-safe; auth user cleanup via Supabase trigger/admin)
        if (currentProfile.role === 'jobseeker') {
          await sb.from('applications').delete().eq('applicant_user_id', currentProfile.id)
          await sb.from('job_seekers').delete().eq('user_id', currentProfile.id)
        }
        if (currentProfile.role === 'employer') {
          await sb.from('posted_jobs').delete().eq('employer_id', currentProfile.id)
          await sb.from('employer_profiles').delete().eq('user_id', currentProfile.id)
        }
        // Update users row to mark as deleted (safer than hard delete with RLS)
        try { await sb.from('users').update({ role:'deleted' }).eq('id', currentProfile.id) } catch(_) {}
      }
      await sb.auth.signOut()
      closeAllModals()
      currentProfile = null
      showPublic()
      updateNavAuth(false)
      showToast('auth-toast', 'Your account data has been removed. Goodbye!', 'success')
    } catch(err) {
      handleError(err, 'delete-account-toast')
    } finally {
      setBtn('delete-account-confirm-btn', false, 'üóëÔ∏è Permanently Delete Account')
    }
  }

  // ===== EMPLOYER PROFILE SAVE ==========================================
  async function saveEmployerProfile() {
    if (!currentProfile?.id) return
    setBtn('emp-save-profile-btn', true, 'Saving...')
    try {
      const fullName = v('emp-fullname').trim()
      const company  = v('emp-company').trim()
      const industry = v('emp-industry')
      const prefix   = v('emp-wa-prefix')
      const waNum    = v('emp-whatsapp').trim().replace(/\D/g,'')
      const whatsapp = waNum ? `${prefix}-${waNum}` : null
      await sb.from('users').update({ full_name:fullName }).eq('id', currentProfile.id)
      await sb.from('employer_profiles').upsert({ user_id:currentProfile.id, company_name:company, industry, whatsapp, profile_picture_url: empPicUrl || null }, { onConflict:'user_id' })
      currentProfile.full_name = fullName
      setText('dash-name', fullName)
      showToast('emp-profile-toast', '‚úÖ Profile saved successfully!', 'success')
    } catch(err) { handleError(err, 'emp-profile-toast') }
    finally { setBtn('emp-save-profile-btn', false, 'Save Profile') }
  }

  // ===== LOAD TOP 5 SEEKER MATCHES ======================================
  async function loadTop5Matches() {
    const content = el('sk-top5-content'); if(!content) return
    content.innerHTML = '<div class="empty-state"><span class="spinner"></span> Finding your top 5 matches...</div>'
    const seeker = {
      roles: seekerRoles, skills: seekerSkills,
      experience_level: seekerProfile?.experience_level || '',
      years_experience: seekerProfile?.years_experience || null,
      province: seekerProfile?.province || '',
      location: seekerProfile?.province || '',
      salary_min: seekerProfile?.salary_min || null,
      salary_max: seekerProfile?.salary_max || null,
      preferred_work_type: seekerProfile?.preferred_work_type || '',
      education_level: seekerProfile?.education_level || '',
      willing_to_relocate: seekerProfile?.willing_to_relocate || false
    }
    try {
      const { data:liveJobs } = await sb.from('posted_jobs').select('id,title,company_name,primary_role,required_skills,experience,province,town,employment,salary_min,salary_max,description,status,urgency_level,expires_at').eq('status','active')
      const liveIds = new Set((liveJobs||[]).map(j=>j.id))
      const jobs = [...(liveJobs||[]), ...DEMO_JOBS.filter(j=>!liveIds.has(j.id))]
      const top5 = jobs.map(j=>({j,r:computeMatch(j,seeker)})).sort((a,b)=>b.r.score-a.r.score).slice(0,5)
      if (!top5.length) { content.innerHTML=emptyHTML('üîç','No matches','Complete your profile to get matches'); return }
      content.innerHTML = `
        <div style="margin-bottom:18px"><p style="font-size:13px;color:var(--text-muted)">Your top 5 AI-matched positions out of all active jobs. Complete your profile for better results.</p></div>
        ${top5.map(({j,r},i)=>`
          <div style="display:flex;gap:15px;align-items:flex-start;padding:18px;background:white;border-radius:18px;margin-bottom:14px;border:2px solid ${r.score>=80?'rgba(4,120,87,0.3)':r.score>=60?'rgba(59,130,246,0.2)':'rgba(107,114,128,0.15)'};box-shadow:var(--shadow-soft)">
            <div style="font-size:1.4em;font-weight:800;color:${r.score>=80?'var(--emerald)':r.score>=60?'#3b82f6':'var(--text-muted)'};min-width:28px;text-align:center">#${i+1}</div>
            <div style="flex:1">
              <div style="font-weight:700;font-size:1em;color:var(--text-dark);margin-bottom:4px">${esc(j.title)}</div>
              ${j.company_name?`<div style="font-size:12px;color:var(--text-muted);margin-bottom:6px">üè¢ ${esc(j.company_name)}</div>`:''}
              <div style="font-size:12px;color:var(--text-muted);margin-bottom:8px">${esc(jobLocation(j)||'‚Äî')} ‚Ä¢ ${esc(j.employment||'‚Äî')}</div>
              <div style="font-size:12px;color:var(--text-dark);background:rgba(4,120,87,0.06);border-radius:9px;padding:8px 12px;border-left:3px solid var(--emerald)">${esc(buildMatchExplanation(r))}</div>
            </div>
            <div style="text-align:right;flex-shrink:0">
              <div style="font-size:2em;font-weight:800;color:var(--emerald);line-height:1">${r.score}%</div>
              <span class="match-score-badge ${matchClass(r.label)}" style="font-size:10px;margin-top:4px;display:inline-block">${esc(r.label)}</span>
              <div style="margin-top:10px">
                <button type="button" class="btn btn-primary btn-xs" data-action="apply-job" data-job-id="${esc(j.id)}">Apply ‚Üí</button>
              </div>
            </div>
          </div>`).join('')}`
      bindJobCardEvents(content)
    } catch(err) { content.innerHTML=`<div class="empty-state">Error: ${esc(err.message)}</div>` }
  }

  // ===== JOB LOCATION HELPER ============================================
  function jobLocation(j) {
    if (j.province && j.town) return `${j.province} ‚Äî ${j.town}`
    if (j.province) return j.province
    if (j.town) return j.town
    if (j.location) return j.location
    return ''
  }

  // ===== MATCH EXPLANATION ==============================================
  function buildMatchExplanation(r) {
    const parts = []
    if (r.role >= 30) parts.push('strong role alignment')
    else if (r.role >= 15) parts.push('partial role match')
    else parts.push('limited role overlap')
    if (r.skill >= 22) parts.push('excellent skills coverage')
    else if (r.skill >= 12) parts.push('good skills overlap')
    else parts.push('skills gap exists')
    if (r.exp >= 14) parts.push('experience level aligns well')
    else if (r.exp >= 7) parts.push('experience level close')
    else parts.push('experience level below requirement')
    if (r.loc > 0) parts.push('location match')
    const first = parts[0].charAt(0).toUpperCase() + parts[0].slice(1)
    return first + '. ' + parts.slice(1).join(', ') + '.'
  }

  // ===== CAREER CENTRE MODAL ===============================================

  const CAREER_CONTENT = {
    'cv-templates': {
      title: 'üìÑ CV Templates ‚Äî Download Free',
      body: `
        <p style="color:var(--text-muted);font-size:14px;line-height:1.8;margin-bottom:25px">Choose a professional CV template tailored to Zimbabwe employers. Click to copy and customise in any word processor.</p>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:20px">
          <div style="border:2px solid rgba(4,120,87,0.15);border-radius:20px;padding:20px;cursor:pointer;transition:all 0.3s ease" onmouseover="this.style.borderColor='var(--emerald)'" onmouseout="this.style.borderColor='rgba(4,120,87,0.15)'">
            <div style="font-weight:700;color:var(--emerald);margin-bottom:8px">üíº Technology / Engineering</div>
            <div style="font-size:12px;color:var(--text-muted);margin-bottom:15px">Software engineers, data analysts, network engineers</div>
            <div style="background:#f9fafb;border-radius:12px;padding:15px;font-family:monospace;font-size:11px;line-height:1.8;color:var(--text-dark)">
              <strong>TENDAI MOYO</strong><br/>+263 77 123 4567 | tendai@email.com | Harare<br/><br/>
              <strong>PROFESSIONAL SUMMARY</strong><br/>Results-driven [Role] with [X] years experience in [Tech Stack]. Proven track record of [Key Achievement].<br/><br/>
              <strong>WORK EXPERIENCE</strong><br/>Senior [Role] | Company | 2023‚ÄìPresent<br/>‚Ä¢ Increased [Metric] by [%] through [Action]<br/>‚Ä¢ Led [Project] resulting in [Outcome]<br/><br/>
              <strong>EDUCATION</strong><br/>BSc Computer Science | UZ | 2021<br/><br/>
              <strong>SKILLS</strong><br/>Technical: React, Python, SQL, AWS<br/>Soft: Communication, Problem-Solving
            </div>
          </div>
          <div style="border:2px solid rgba(4,120,87,0.15);border-radius:20px;padding:20px;cursor:pointer;transition:all 0.3s ease" onmouseover="this.style.borderColor='var(--emerald)'" onmouseout="this.style.borderColor='rgba(4,120,87,0.15)'">
            <div style="font-weight:700;color:var(--emerald);margin-bottom:8px">‚öñÔ∏è Finance / Accounting</div>
            <div style="font-size:12px;color:var(--text-muted);margin-bottom:15px">Accountants, analysts, auditors, CFOs</div>
            <div style="background:#f9fafb;border-radius:12px;padding:15px;font-family:monospace;font-size:11px;line-height:1.8;color:var(--text-dark)">
              <strong>RUDO NCUBE CPA</strong><br/>+263 71 234 5678 | rudo@email.com | Bulawayo<br/><br/>
              <strong>PROFESSIONAL SUMMARY</strong><br/>Certified accountant with [X] years in [Sector]. Expert in IFRS, tax compliance, and financial reporting.<br/><br/>
              <strong>WORK EXPERIENCE</strong><br/>Senior Accountant | [Company] | 2022‚ÄìPresent<br/>‚Ä¢ Reduced audit findings by [%] through improved controls<br/>‚Ä¢ Managed $[X]M budget across [N] departments<br/><br/>
              <strong>CERTIFICATIONS</strong><br/>ICAZ | ACCA | ZIMRA Registered Tax Practitioner
            </div>
          </div>
          <div style="border:2px solid rgba(4,120,87,0.15);border-radius:20px;padding:20px;cursor:pointer;transition:all 0.3s ease" onmouseover="this.style.borderColor='var(--emerald)'" onmouseout="this.style.borderColor='rgba(4,120,87,0.15)'">
            <div style="font-weight:700;color:var(--emerald);margin-bottom:8px">üèóÔ∏è Mining / Engineering</div>
            <div style="font-size:12px;color:var(--text-muted);margin-bottom:15px">Mining engineers, safety officers, civil engineers</div>
            <div style="background:#f9fafb;border-radius:12px;padding:15px;font-family:monospace;font-size:11px;line-height:1.8;color:var(--text-dark)">
              <strong>FARAI ZIMBA</strong><br/>+263 73 345 6789 | farai@email.com | Gweru<br/><br/>
              <strong>PROFESSIONAL SUMMARY</strong><br/>Licensed [Engineer] with [X] years in [Mining/Civil/Structural]. SHEQ-certified and site management experienced.<br/><br/>
              <strong>WORK EXPERIENCE</strong><br/>Site Engineer | [Mine Name] | 2021‚ÄìPresent<br/>‚Ä¢ Oversaw [N] workers maintaining zero LTI record<br/>‚Ä¢ Delivered $[X]M project on time and 8% under budget<br/><br/>
              <strong>CERTIFICATIONS</strong><br/>ZIE Registered | SHEQ | ISO 45001 Certified
            </div>
          </div>
          <div style="border:2px solid rgba(4,120,87,0.15);border-radius:20px;padding:20px;cursor:pointer;transition:all 0.3s ease" onmouseover="this.style.borderColor='var(--emerald)'" onmouseout="this.style.borderColor='rgba(4,120,87,0.15)'">
            <div style="font-weight:700;color:var(--emerald);margin-bottom:8px">üì¢ Sales / Marketing</div>
            <div style="font-size:12px;color:var(--text-muted);margin-bottom:15px">Sales reps, marketing managers, brand officers</div>
            <div style="background:#f9fafb;border-radius:12px;padding:15px;font-family:monospace;font-size:11px;line-height:1.8;color:var(--text-dark)">
              <strong>CHIEDZA MAPOSA</strong><br/>+263 77 456 7890 | chiedza@email.com | Harare<br/><br/>
              <strong>PROFESSIONAL SUMMARY</strong><br/>Results-driven marketer with [X] years growing brands across Zimbabwe. Expert in digital, B2B, and BTL campaigns.<br/><br/>
              <strong>WORK EXPERIENCE</strong><br/>Marketing Manager | [Brand] | 2022‚ÄìPresent<br/>‚Ä¢ Grew social following from [X] to [Y] in 6 months<br/>‚Ä¢ Delivered [Campaign] with [ROI]% return on spend<br/><br/>
              <strong>SKILLS</strong><br/>Google Ads | SEO | TikTok | Content | CRM | Analytics
            </div>
          </div>
        </div>
        <div style="background:var(--light-gold);border-radius:15px;padding:15px 20px;border-left:4px solid var(--gold);font-size:13px;color:var(--charcoal)">
          üí° <strong>Pro tip:</strong> Always export your CV as a PDF before sending. Use your full name as the filename (e.g. <em>TendaiMoyo_CV.pdf</em>).
        </div>`
    },
    'star-method': {
      title: 'üéØ The STAR Method ‚Äî Write Achievement CVs',
      body: `
        <p style="color:var(--text-muted);font-size:14px;line-height:1.8;margin-bottom:20px">The STAR method transforms generic duty lists into compelling achievement statements that Zimbabwean employers notice.</p>
        <div style="display:grid;gap:15px;margin-bottom:25px">
          <div style="background:linear-gradient(135deg,#ecfdf5,#d1fae5);border-radius:15px;padding:20px;border-left:4px solid var(--emerald)">
            <div style="font-weight:800;color:var(--emerald);font-size:1.1em;margin-bottom:8px">S ‚Äî Situation</div>
            <div style="font-size:14px;color:var(--text-dark)">Describe the context or challenge you faced.<br/><em style="color:var(--text-muted)">"Our customer complaint rate had risen to 34% in Q2..."</em></div>
          </div>
          <div style="background:linear-gradient(135deg,#fef3c7,#fde68a);border-radius:15px;padding:20px;border-left:4px solid var(--gold)">
            <div style="font-weight:800;color:#92400e;font-size:1.1em;margin-bottom:8px">T ‚Äî Task</div>
            <div style="font-size:14px;color:var(--text-dark)">Explain your specific responsibility.<br/><em style="color:var(--text-muted)">"I was tasked with redesigning the customer escalation process..."</em></div>
          </div>
          <div style="background:linear-gradient(135deg,#ede9fe,#ddd6fe);border-radius:15px;padding:20px;border-left:4px solid #7c3aed">
            <div style="font-weight:800;color:#5b21b6;font-size:1.1em;margin-bottom:8px">A ‚Äî Action</div>
            <div style="font-size:14px;color:var(--text-dark)">Detail what you specifically did (use action verbs).<br/><em style="color:var(--text-muted)">"I implemented a tiered response system, trained 12 agents, and introduced daily root-cause reviews..."</em></div>
          </div>
          <div style="background:linear-gradient(135deg,#fce7f3,#fbcfe8);border-radius:15px;padding:20px;border-left:4px solid #db2777">
            <div style="font-weight:800;color:#9d174d;font-size:1.1em;margin-bottom:8px">R ‚Äî Result</div>
            <div style="font-size:14px;color:var(--text-dark)">Quantify the outcome wherever possible.<br/><em style="color:var(--text-muted)">"Complaint rate fell from 34% to 8% within 60 days, saving the company $12,000 in refunds."</em></div>
          </div>
        </div>
        <div style="background:var(--glass-bg);border:2px solid rgba(4,120,87,0.15);border-radius:20px;padding:20px">
          <div style="font-weight:700;color:var(--emerald);margin-bottom:12px">‚úÖ Strong STAR Example (Zimbabwe Context)</div>
          <div style="font-size:14px;color:var(--text-dark);line-height:1.8">
            <strong>Before (weak):</strong> <em style="color:var(--text-muted)">Responsible for managing social media accounts.</em><br/><br/>
            <strong>After (STAR):</strong> Identified declining brand engagement (S) and was tasked with rebuilding our digital presence in 90 days (T). Launched a localised content strategy targeting Harare and Bulawayo audiences, including weekly ZimBiz spotlights and WhatsApp broadcast campaigns (A). Grew followers from 1,200 to 8,400 and increased post reach by 560%, generating 34 qualified leads per month (R).
          </div>
        </div>`
    },
    'whatsapp-tips': {
      title: 'üì± WhatsApp CV Tips ‚Äî First Impressions Count',
      body: `
        <p style="color:var(--text-muted);font-size:14px;line-height:1.8;margin-bottom:20px">In Zimbabwe, WhatsApp is the primary hiring channel. Your WhatsApp presence is your first interview.</p>
        <div style="display:grid;gap:15px;margin-bottom:25px">
          ${[
            ['üì∏','Professional Profile Picture','Use a clear, professional headshot with good lighting. Avoid group photos, sunglasses, or blurry images. Employers form instant impressions.'],
            ['üìÑ','Always Send CV as PDF','Never send a Word document or image of your CV. Export as PDF, named FirstnameLastname_CV.pdf. It looks professional and preserves formatting.'],
            ['‚è±Ô∏è','Respond Within 2 Hours','Employers message many candidates. Set a status showing you are available. Respond promptly ‚Äî slow replies signal low interest or unreliability.'],
            ['‚úçÔ∏è','Professional First Message','When applying via WhatsApp, write: "Good [morning/afternoon], [Name]. I am applying for the [Role] position. Please find my CV attached." No slang or emojis.'],
            ['üîá','Turn Off Read Receipts Risk','If you read a message but cannot reply yet, be aware the employer can see blue ticks. Draft a quick acknowledgement: "Thank you, I will respond shortly."'],
            ['üìã','Create a WhatsApp Status','Set a professional status like: "Available | Marketing Manager | 5 yrs exp | Harare | CV on request." This works passively for your job search.']
          ].map(([icon,title,desc])=>`
            <div style="display:flex;gap:15px;align-items:flex-start;background:var(--glass-bg);border:1px solid rgba(4,120,87,0.1);border-radius:15px;padding:18px">
              <div style="font-size:24px;flex-shrink:0">${icon}</div>
              <div><div style="font-weight:700;color:var(--text-dark);margin-bottom:4px">${title}</div><div style="font-size:13px;color:var(--text-muted);line-height:1.7">${desc}</div></div>
            </div>`).join('')}
        </div>`
    },
    'cv-mistakes': {
      title: '‚ö†Ô∏è Common CV Mistakes ‚Äî Zimbabwe Edition',
      body: `
        <p style="color:var(--text-muted);font-size:14px;line-height:1.8;margin-bottom:20px">These are the most common mistakes that get CVs rejected by Zimbabwean employers and recruiters.</p>
        <div style="display:grid;gap:12px;margin-bottom:25px">
          ${[
            ['‚ùå','Unprofessional Email Address','Using coolboy2001@yahoo.com or sexybabe@gmail.com immediately signals unprofessionalism. Create firstname.lastname@gmail.com before applying.'],
            ['‚ùå','Listing Duties Instead of Achievements','Employers know what a Sales Rep does. They want to know: Did you exceed targets? By how much? Use numbers ‚Äî "Exceeded quarterly target by 34%" beats "Responsible for selling."'],
            ['‚ùå','Generic Objective Statements','"To obtain a challenging position in a reputable organisation" tells employers nothing. Replace with a sharp 2-sentence summary of your specific value.'],
            ['‚ùå','No Quantified Results','Avoid "improved performance" or "managed a team." Write "Improved NPS from 42 to 71" or "Managed a 12-person team achieving $200K monthly revenue."'],
            ['‚ùå','Too Long or Too Short','In Zimbabwe, 2 pages is ideal for most professionals. 3 pages is acceptable for 10+ years experience. 1 page is fine for graduates. Never go beyond 4 pages.'],
            ['‚ùå','Missing Contact Details','Always include: full name, phone number (with +263), professional email, location (city), and LinkedIn if available. Never include ID number or date of birth.'],
            ['‚ùå','Typos and Grammatical Errors','One typo can disqualify you. Use Grammarly, read aloud, and ask a professional colleague to review before sending.'],
            ['‚ùå','Wrong File Format','Sending a .docx that renders differently on the employer\'s device. Always send PDF unless specifically asked for Word format.']
          ].map(([icon,title,desc])=>`
            <div style="display:flex;gap:15px;align-items:flex-start;border-radius:15px;padding:15px;border:2px solid rgba(220,38,38,0.1);background:rgba(254,242,242,0.5)">
              <div style="font-size:18px;flex-shrink:0;padding-top:2px">${icon}</div>
              <div><div style="font-weight:700;color:#991b1b;margin-bottom:4px">${title}</div><div style="font-size:13px;color:var(--text-muted);line-height:1.7">${desc}</div></div>
            </div>`).join('')}
        </div>`
    },
    'interview-prep': {
      title: 'üîç Interview Prep ‚Äî Zimbabwe Companies',
      body: `
        <p style="color:var(--text-muted);font-size:14px;line-height:1.8;margin-bottom:20px">Common interview questions from top Zimbabwe employers ‚Äî with model frameworks for answering them effectively.</p>
        <div style="display:grid;gap:20px;margin-bottom:25px">
          ${[
            ['Tell me about yourself.','Open with your current role, key achievement, and why you are here. Keep it to 90 seconds. End with: "...which is why I\'m excited about this opportunity."'],
            ['Why do you want to work here?','Research the company first. Reference a specific initiative, value, or project. Avoid: "Because I need a job" or "It\'s a good company."'],
            ['What is your greatest weakness?','Choose a real weakness ‚Äî then show what you\'re actively doing to address it. Never say "I work too hard" ‚Äî it\'s transparent and clich√©d.'],
            ['Describe a time you handled conflict at work.','Use STAR method. Focus on resolution, not blame. Show you were calm, professional, and outcome-focused.'],
            ['Where do you see yourself in 5 years?','Show ambition aligned with the company\'s growth. "I see myself growing into [senior role] and contributing to [company goal]."'],
            ['What salary are you expecting?','Research market rates on ZimGetHired\'s Salary Guide first. Give a range, not a single number: "Based on my research and experience, I\'m looking at $X‚Äì$Y."'],
            ['Do you have any questions for us?','Always have 2‚Äì3 prepared. Ask about team culture, growth opportunities, or what success looks like in the role. Never ask about leave days first.']
          ].map(([q,a])=>`
            <div style="border:1px solid rgba(4,120,87,0.12);border-radius:15px;overflow:hidden">
              <div style="background:linear-gradient(135deg,var(--emerald),var(--deep-emerald));color:white;padding:12px 18px;font-weight:700;font-size:14px">${q}</div>
              <div style="padding:15px 18px;font-size:13px;color:var(--text-muted);line-height:1.8;background:var(--glass-bg)">${a}</div>
            </div>`).join('')}
        </div>`
    },
    'ai-cv': {
      title: 'ü§ñ AI CV Editor ‚Äî Coming Soon',
      body: `
        <div style="text-align:center;padding:30px 20px">
          <div style="font-size:64px;margin-bottom:20px">ü§ñ</div>
          <h2 style="color:var(--emerald);font-size:1.8em;font-weight:800;margin-bottom:12px">AI-Powered CV Editor</h2>
          <p style="color:var(--text-muted);font-size:16px;line-height:1.8;max-width:480px;margin:0 auto 30px">Paste your CV and our AI will rewrite it using the STAR method, optimise it for Zimbabwe employers, and match it to specific job descriptions ‚Äî in seconds.</p>
          <div style="display:grid;gap:12px;max-width:400px;margin:0 auto 30px;text-align:left">
            ${['‚ú® AI rewrites weak bullet points into STAR achievements','üéØ Tailors your CV to a specific job description','üìä Scores your CV against our match engine','üáøüáº Optimised for Zimbabwe employer expectations','‚ö° Instant PDF download'].map(f=>`<div style="display:flex;align-items:center;gap:10px;font-size:14px;color:var(--text-dark)"><span style="color:var(--emerald);font-weight:700">${f.slice(0,2)}</span>${f.slice(2)}</div>`).join('')}
          </div>
          <div style="background:linear-gradient(135deg,var(--emerald),var(--deep-emerald));color:white;padding:16px 32px;border-radius:50px;display:inline-block;font-weight:700;font-size:15px">
            üöÄ Launching Q2 2026 ‚Äî Join the waitlist below
          </div>
          <br/><br/>
          <button type="button" class="btn btn-secondary" onclick="ZGH_openAuth('signup')">Get Early Access ‚Üí</button>
        </div>`
    }
  }

  // Expose for inline onclick in AI CV modal and footer links
  window.ZGH_openAuth = (tab) => openAuth(tab)
  window.openAuth = (tab) => openAuth(tab)

  function openCareerModal(key) {
    const content = CAREER_CONTENT[key]
    if (!content) return
    const titleEl = el('career-modal-title')
    const bodyEl  = el('career-modal-body')
    if (titleEl) titleEl.textContent = content.title
    if (bodyEl)  bodyEl.innerHTML    = content.body
    openModal('career-modal')
  }

  // ===== STATIC EVENT BINDING ===============================================


  function closeMobileMenu() {
    const mm = el('mobile-menu')
    if (mm) mm.style.display = 'none'
    document.body.style.overflow = ''
  }

  function bindStaticEvents() {
    el('logo-btn')?.addEventListener('click', showPublic)
    el('logo-btn')?.addEventListener('keydown', e=>{ if(e.key==='Enter') showPublic() })
    el('tab-home')?.addEventListener('click', () => { showPublic(); scrollTo2('home-section') })
    el('tab-jobs')?.addEventListener('click', () => { showPublic(); setTimeout(()=>scrollTo2('job-board-section'),100) })
    el('tab-salaries')?.addEventListener('click', () => { showPublic(); setTimeout(()=>scrollTo2('salary-section'),100) })
    el('tab-news')?.addEventListener('click', () => { showPublic(); setTimeout(()=>scrollTo2('news-section'),100) })
    el('tab-dash')?.addEventListener('click', showDashboard)
    el('data-saver-toggle')?.addEventListener('click', toggleDataSaver)
    el('data-saver-toggle')?.addEventListener('keydown', e=>{ if(e.key==='Enter'||e.key===' ') toggleDataSaver() })
    bindAuthButtons()
    el('login-btn')?.addEventListener('click', handleLogin)
    el('signup-btn')?.addEventListener('click', handleSignup)
    el('switch-to-signup')?.addEventListener('click', ()=>switchAuthTab('signup'))
    el('switch-to-login')?.addEventListener('click', ()=>switchAuthTab('login'))
    el('forgot-password-btn')?.addEventListener('click', ()=>switchAuthTab('forgot'))
    el('back-to-login-btn')?.addEventListener('click', ()=>switchAuthTab('login'))
    el('forgot-submit-btn')?.addEventListener('click', handleForgotPassword)
    el('auth-modal-close')?.addEventListener('click', ()=>closeModal('auth-modal'))
    // Mobile hamburger menu
    el('hamburger-btn')?.addEventListener('click', ()=>{ el('mobile-menu').style.display='flex'; document.body.style.overflow='hidden' })
    el('mobile-menu-close')?.addEventListener('click', closeMobileMenu)
    el('mob-home')?.addEventListener('click', ()=>{ closeMobileMenu(); showPublic(); scrollTo2('home-section') })
    el('mob-jobs')?.addEventListener('click', ()=>{ closeMobileMenu(); showPublic(); setTimeout(()=>scrollTo2('job-board-section'),100) })
    el('mob-salaries')?.addEventListener('click', ()=>{ closeMobileMenu(); showPublic(); setTimeout(()=>scrollTo2('salary-section'),100) })
    el('mob-news')?.addEventListener('click', ()=>{ closeMobileMenu(); showPublic(); setTimeout(()=>scrollTo2('news-section'),100) })
    el('mob-dash')?.addEventListener('click', ()=>{ closeMobileMenu(); showDashboard() })
    el('mob-signin')?.addEventListener('click', ()=>{ closeMobileMenu(); openAuth('login') })
    el('mob-signup')?.addEventListener('click', ()=>{ closeMobileMenu(); openAuth('signup') })
    // Admin portal button
    el('admin-portal-btn')?.addEventListener('click', ()=>openModal('admin-portal-modal'))
    el('admin-portal-close')?.addEventListener('click', ()=>closeModal('admin-portal-modal'))
    el('admin-portal-submit')?.addEventListener('click', handleAdminPortalLogin)
    el('admin-portal-pass')?.addEventListener('keydown', e=>{ if(e.key==='Enter') handleAdminPortalLogin() })
    // WA interview modal
    el('wa-interview-close')?.addEventListener('click', ()=>closeModal('wa-interview-modal'))
    el('wa-interview-date')?.addEventListener('input', ()=>{ updateWaPreview(); updateWaSendLink() })
    el('wa-interview-time')?.addEventListener('input', ()=>{ updateWaPreview(); updateWaSendLink() })
    el('wa-interview-msg')?.addEventListener('input', updateWaSendLink)
    // Delete account modal
    el('delete-account-modal-close')?.addEventListener('click', ()=>closeModal('delete-account-modal'))
    el('delete-account-confirm-btn')?.addEventListener('click', handleDeleteAccount)
    el('seeker-match-close')?.addEventListener('click', ()=>closeModal('seeker-match-modal'))
    el('job-detail-close')?.addEventListener('click', ()=>closeModal('job-detail-modal'))
    el('post-job-close')?.addEventListener('click', ()=>closeModal('post-job-modal'))
    el('candidate-modal-close')?.addEventListener('click', ()=>closeModal('candidate-modal'))
    el('career-modal-close')?.addEventListener('click', ()=>closeModal('career-modal'))
    el('dash-go-public-btn')?.addEventListener('click', showPublic)
    el('dash-logout-btn')?.addEventListener('click', handleLogout)
    el('hero-get-started-btn')?.addEventListener('click', ()=>openAuth('signup'))
    el('hero-post-job-btn')?.addEventListener('click', ()=>openAuth('signup'))
    el('hero-view-jobs-btn')?.addEventListener('click', ()=>scrollTo2('job-board-section'))
    el('vjf-badge')?.addEventListener('click', ()=>openAuth('signup'))
    el('footer-jobs')?.addEventListener('click', ()=>{ showPublic(); setTimeout(()=>scrollTo2('job-board-section'),100) })
    el('footer-post')?.addEventListener('click', ()=>openAuth('signup'))
    el('footer-salary')?.addEventListener('click', ()=>{ showPublic(); setTimeout(()=>scrollTo2('salary-section'),100) })
    el('footer-news')?.addEventListener('click', ()=>{ showPublic(); setTimeout(()=>scrollTo2('news-section'),100) })
    el('footer-cv-templates')?.addEventListener('click', ()=>openCareerModal('cv-templates'))
    el('footer-salary2')?.addEventListener('click', ()=>{ showPublic(); setTimeout(()=>scrollTo2('salary-section'),100) })
    el('footer-market-pulse')?.addEventListener('click', ()=>{ showPublic(); setTimeout(()=>scrollTo2('news-section'),100) })
    // CV Resource buttons
    el('cv-btn-templates')?.addEventListener('click',  ()=>openCareerModal('cv-templates'))
    el('cv-btn-star')?.addEventListener('click',       ()=>openCareerModal('star-method'))
    el('cv-btn-whatsapp')?.addEventListener('click',   ()=>openCareerModal('whatsapp-tips'))
    el('cv-btn-mistakes')?.addEventListener('click',   ()=>openCareerModal('cv-mistakes'))
    el('cv-btn-interview')?.addEventListener('click',  ()=>openCareerModal('interview-prep'))
    el('cv-btn-ai')?.addEventListener('click',         ()=>openCareerModal('ai-cv'))
    // Debounced search
    el('pub-search')?.addEventListener('input', filterPublicJobs)
    el('pub-location')?.addEventListener('change', filterPublicJobs)
    el('pub-employment')?.addEventListener('change', filterPublicJobs)
    el('salarySearch')?.addEventListener('keyup', filterSalaryTable)
    // Modal backdrop dismiss ‚Äî single delegated listener on document
    document.addEventListener('click', e => {
      if (e.target.classList.contains('modal-overlay')) closeAllModals()
    })
  }

  // ===== INIT ===============================================================

  // ‚îÄ‚îÄ Safe storage object ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  // A plain synchronous object passed directly to createClient.
  // Tries localStorage first, falls back to sessionStorage, then memory.
  // Every access is wrapped in try/catch so "Access to storage is not allowed"
  // is caught and silently handled ‚Äî it NEVER propagates to crash auth.
  // This is a plain object (not a function call) to avoid any async lock issues.
  const _mem = {}
  const _safeStorage = {
    getItem: function(k) {
      try { var v = localStorage.getItem(k); if (v != null) return v } catch(_) {}
      try { var v2 = sessionStorage.getItem(k); if (v2 != null) return v2 } catch(_) {}
      return _mem[k] !== undefined ? _mem[k] : null
    },
    setItem: function(k, v) {
      try { localStorage.setItem(k, v) } catch(_) {}
      try { sessionStorage.setItem(k, v) } catch(_) {}
      _mem[k] = v
    },
    removeItem: function(k) {
      try { localStorage.removeItem(k) } catch(_) {}
      try { sessionStorage.removeItem(k) } catch(_) {}
      delete _mem[k]
    }
  }

  /*
====================================================================
AUTH SYSTEM ‚Äî LOCKED STABLE VERSION

DO NOT MODIFY WITHOUT FULL REVIEW.

This authentication system includes:
- Supabase client initialization
- bootstrapSession() for session restoration
- onAuthStateChange listener
- persistSession enabled
- autoRefreshToken enabled

Do NOT:
- Remove bootstrapSession()
- Move onAuthStateChange above bootstrap
- Add manual localStorage usage
- Change Supabase auth config
- Modify auth flow order

This file is the production-stable reference.

====================================================================
*/
  async function initApp() {
    const { createClient } = supabase
    sb = createClient(SUPABASE_URL, SUPABASE_ANON, {
      auth: { persistSession:true, autoRefreshToken:true, detectSessionInUrl:false, storage:_safeStorage, storageKey:'zgh-auth-token' }
    })

    // Global unhandled promise rejection guard ‚Äî prevents silent UI freeze
    window.addEventListener('unhandledrejection', ev => {
      console.error('[ZGH Unhandled]', ev.reason)
    })

    // Render static data synchronously ‚Äî salary table + news never need DB
    renderSalaryTable()
    renderNewsGrid()

    // Bind all static event listeners (runs once, after DOM ready)
    bindStaticEvents()

    // ESC key closes active modal ‚Äî bound once here
    document.addEventListener('keydown', e => {
      if (e.key === 'Escape') closeAllModals()
    })

    // ‚îÄ‚îÄ Pre-render demo jobs immediately (synchronous, no spinner) ‚îÄ‚îÄ
    renderPublicJobs(DEMO_JOBS)

    // ‚îÄ‚îÄ bootstrapSession: restores session on initial page load ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    // Calls getSession() directly to read from storage and set up UI correctly
    // before any auth state listener is attached. This is the single source of
    // truth for the initial authenticated/unauthenticated state.
    async function bootstrapSession() {
      try {
        const { data } = await sb.auth.getSession()
        const session = data?.session
        if (session?.user) {
          const profile = await loadProfile(session.user)
          if (profile) initDashboard(profile)
          updateNavAuth(true)
        } else {
          showPublic()
          updateNavAuth(false)
        }
      } catch(err) {
        console.error('[bootstrapSession error]', err)
        showPublic()
        updateNavAuth(false)
      }
    }

    await bootstrapSession()

    // ‚îÄ‚îÄ Auth state listener ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    // Only handles post-bootstrap events: fresh logins and logouts.
    // Initial session restoration is fully handled by bootstrapSession() above.
    sb.auth.onAuthStateChange(async (event, session) => {
      if (event === 'SIGNED_IN') {
        if (session?.user) {
          try {
            const profile = await loadProfile(session.user)
            if (profile) { initDashboard(profile); updateNavAuth(true) }
          } catch(err) {
            console.error('[onAuthStateChange:SIGNED_IN] loadProfile failed:', err)
            showPublic()
            updateNavAuth(false)
          }
        }
      }
      if (event === 'SIGNED_OUT') {
        currentProfile = null
        showPublic()
        updateNavAuth(false)
      }
    })
  }

  return { initApp }

})()

document.addEventListener('DOMContentLoaded', ZGH.initApp)
</script>
</body>
</html>
