<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>ZimGetHired — Zimbabwe Talent Intelligence Platform</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700;900&family=Plus+Jakarta+Sans:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet"/>
<style>
:root{
  --emerald:#047857;--deep-emerald:#065f46;--emerald-light:#059669;
  --emerald-glow:rgba(4,120,87,0.35);--gold:#D4AF37;--gold-dim:#b8960d;
  --gold-soft:rgba(212,175,55,0.15);--light-gold:#fef3c7;
  --charcoal:#1f2937;--charcoal-2:#111827;--charcoal-3:#0d1117;
  --surface:rgba(255,255,255,0.04);--surface-2:rgba(255,255,255,0.07);
  --surface-3:rgba(255,255,255,0.11);--border:rgba(255,255,255,0.10);
  --border-em:rgba(4,120,87,0.40);--border-gold:rgba(212,175,55,0.30);
  --text:#f0fdf4;--text-2:#d1fae5;--text-muted:rgba(240,253,244,0.55);
  --text-dim:rgba(240,253,244,0.35);--red:#ef4444;--amber:#f59e0b;
  --radius:20px;--radius-lg:25px;--radius-sm:12px;
  --serif:"Playfair Display",serif;--sans:"Plus Jakarta Sans",sans-serif;
  --mono:"JetBrains Mono",monospace;
  --blur:blur(20px);--blur-sm:blur(10px);
  --shadow:0 20px 60px rgba(0,0,0,0.5);
  --shadow-em:0 0 40px rgba(4,120,87,0.25);--glow-gold:0 0 30px rgba(212,175,55,0.25);
}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html{scroll-behavior:smooth}
body{font-family:var(--sans);background:var(--charcoal-3);color:var(--text);min-height:100vh;overflow-x:hidden;
  background-image:linear-gradient(rgba(4,120,87,0.04) 1px,transparent 1px),
  linear-gradient(90deg,rgba(4,120,87,0.04) 1px,transparent 1px),
  radial-gradient(ellipse 80% 50% at 50% 0%,rgba(4,120,87,0.12) 0%,transparent 60%);
  background-size:40px 40px,40px 40px,100% 100%}
::-webkit-scrollbar{width:6px}::-webkit-scrollbar-track{background:var(--charcoal-2)}::-webkit-scrollbar-thumb{background:var(--emerald);border-radius:3px}
/* TICKER */
.ticker-wrap{width:100%;overflow:hidden;background:linear-gradient(90deg,var(--deep-emerald),var(--emerald),var(--deep-emerald));padding:8px 0;border-bottom:1px solid var(--border-em)}
.ticker-content{display:inline-flex;gap:3rem;animation:ticker 35s linear infinite;white-space:nowrap}
.ticker-content:hover{animation-play-state:paused}
.ticker-item{font-family:var(--mono);font-size:.72rem;letter-spacing:.04em;color:var(--light-gold);display:flex;align-items:center;gap:.5rem}
.ticker-item span{color:var(--gold);font-weight:500}
@keyframes ticker{from{transform:translateX(0)}to{transform:translateX(-50%)}}
/* NAV */
nav{position:sticky;top:0;z-index:100;backdrop-filter:var(--blur);background:rgba(6,47,38,0.85);border-bottom:1px solid var(--border-em);padding:0 2rem}
.nav-inner{max-width:1200px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;height:64px}
.nav-brand{display:flex;align-items:center;gap:.75rem;cursor:pointer;text-decoration:none}
.nav-logo{width:38px;height:38px;border-radius:10px;background:linear-gradient(135deg,var(--emerald),var(--deep-emerald));display:flex;align-items:center;justify-content:center;font-family:var(--serif);font-size:1rem;font-weight:700;color:var(--gold);border:1px solid var(--border-gold);flex-shrink:0}
.nav-name{font-family:var(--serif);font-size:1.1rem;font-weight:700}
.nav-name em{font-style:normal;color:var(--gold)}
.nav-links{display:flex;gap:1.75rem;align-items:center}
.nav-link{font-size:.82rem;font-weight:500;color:var(--text-muted);text-decoration:none;cursor:pointer;transition:.2s;letter-spacing:.02em}
.nav-link:hover{color:var(--gold)}
.nav-actions{display:flex;gap:.75rem;align-items:center}
.toggle-pill{width:32px;height:18px;border-radius:9px;background:var(--surface-2);border:1px solid var(--border);position:relative;transition:.3s;cursor:pointer;display:inline-block}
.toggle-pill.on{background:var(--emerald);border-color:var(--emerald)}
.toggle-knob{width:12px;height:12px;border-radius:50%;background:#fff;position:absolute;top:2px;left:2px;transition:.3s}
.toggle-pill.on .toggle-knob{left:16px}
.data-saver-toggle{display:flex;align-items:center;gap:.4rem;font-family:var(--mono);font-size:.68rem;color:var(--text-dim);cursor:pointer;user-select:none}
/* BUTTONS */
.btn{font-family:var(--sans);font-size:.83rem;font-weight:600;border:none;border-radius:var(--radius-sm);padding:.65rem 1.4rem;cursor:pointer;transition:all .22s;letter-spacing:.01em;text-decoration:none;display:inline-flex;align-items:center;gap:.45rem}
.btn-em{background:linear-gradient(135deg,var(--emerald),var(--deep-emerald));color:#fff;box-shadow:0 4px 15px rgba(4,120,87,0.4)}
.btn-em:hover{transform:translateY(-1px);box-shadow:0 6px 20px rgba(4,120,87,0.55)}
.btn-em:disabled{opacity:.45;cursor:not-allowed;transform:none}
.btn-gold{background:linear-gradient(135deg,var(--gold),var(--gold-dim));color:var(--charcoal-2);font-weight:700;box-shadow:var(--glow-gold)}
.btn-gold:hover{transform:translateY(-1px);box-shadow:0 6px 25px rgba(212,175,55,0.5)}
.btn-ghost{background:var(--surface);color:var(--text-muted);border:1px solid var(--border)}
.btn-ghost:hover{background:var(--surface-2);color:var(--text);border-color:var(--border-em)}
.btn-danger{background:rgba(239,68,68,0.12);color:var(--red);border:1px solid rgba(239,68,68,0.3)}
.btn-danger:hover{background:rgba(239,68,68,0.22)}
.btn-wa{background:linear-gradient(135deg,#25D366,#128C7E);color:#fff;font-weight:700}
.btn-wa:hover{transform:translateY(-1px);box-shadow:0 4px 15px rgba(37,211,102,0.4)}
.btn-sm{padding:.45rem 1rem;font-size:.76rem}.btn-xs{padding:.3rem .75rem;font-size:.7rem}.btn-full{width:100%;justify-content:center}
/* GLASS */
.glass{background:var(--surface);backdrop-filter:var(--blur);border:1px solid var(--border);border-radius:var(--radius)}
.glass-em{background:rgba(4,120,87,0.08);backdrop-filter:var(--blur);border:1px solid var(--border-em);border-radius:var(--radius)}
/* SECTION */
.section{padding:5rem 2rem;max-width:1200px;margin:0 auto}
/* HERO */
#hero{position:relative;min-height:92vh;display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center;padding:6rem 2rem 4rem;overflow:hidden}
.hero-bg{position:absolute;inset:0;pointer-events:none;background:radial-gradient(ellipse 60% 70% at 50% -10%,rgba(4,120,87,0.30) 0%,transparent 60%),radial-gradient(ellipse 40% 40% at 10% 80%,rgba(212,175,55,0.08) 0%,transparent 50%),radial-gradient(ellipse 30% 50% at 90% 70%,rgba(4,120,87,0.12) 0%,transparent 50%)}
.hero-flag-stripe{position:absolute;inset:0;pointer-events:none;opacity:.04;background:repeating-linear-gradient(0deg,#000 0px,#000 33.3%,#D00 33.3%,#D00 66.6%,#080 66.6%,#080 100%);background-size:100% 9px}
.hero-orb{position:absolute;border-radius:50%;pointer-events:none;animation:orb-drift 8s ease-in-out infinite alternate}
.hero-orb-1{width:400px;height:400px;top:-80px;left:-100px;background:radial-gradient(circle,rgba(4,120,87,0.18) 0%,transparent 70%);animation-delay:0s}
.hero-orb-2{width:300px;height:300px;bottom:0;right:-80px;background:radial-gradient(circle,rgba(212,175,55,0.12) 0%,transparent 70%);animation-delay:-3s}
@keyframes orb-drift{from{transform:translate(0,0) scale(1)}to{transform:translate(30px,20px) scale(1.1)}}
.hero-eyebrow{font-family:var(--mono);font-size:.75rem;letter-spacing:.15em;text-transform:uppercase;color:var(--gold);margin-bottom:1.25rem;padding:.35rem 1rem;background:var(--gold-soft);border:1px solid var(--border-gold);border-radius:50px;display:inline-block}
.hero-h1{font-family:var(--serif);font-size:clamp(2.5rem,6vw,4.5rem);font-weight:900;line-height:1.08;letter-spacing:-.02em;max-width:820px;margin:0 auto 1.5rem}
.em-line{background:linear-gradient(90deg,var(--emerald),var(--gold));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.hero-sub{font-size:1.1rem;color:var(--text-muted);max-width:560px;margin:0 auto 2.5rem;line-height:1.7}
.hero-ctas{display:flex;gap:1rem;justify-content:center;flex-wrap:wrap;margin-bottom:3rem}
.hero-stats{display:flex;gap:2.5rem;justify-content:center;flex-wrap:wrap}
.hero-stat-num{font-family:var(--serif);font-size:2rem;font-weight:700;color:var(--gold);display:block}
.hero-stat-label{font-family:var(--mono);font-size:.68rem;color:var(--text-muted);letter-spacing:.08em;text-transform:uppercase}
.pulse-dot{display:inline-block;width:8px;height:8px;border-radius:50%;background:var(--emerald-light);margin-right:.4rem;animation:pulse-anim 2s infinite}
@keyframes pulse-anim{0%,100%{box-shadow:0 0 0 0 rgba(5,150,105,0.6)}50%{box-shadow:0 0 0 8px rgba(5,150,105,0)}}
/* STATS BAR */
.stats-bar{background:linear-gradient(90deg,rgba(6,47,38,0.9),rgba(4,120,87,0.2),rgba(6,47,38,0.9));border-top:1px solid var(--border-em);border-bottom:1px solid var(--border-em);padding:.85rem 2rem}
.stats-bar-inner{max-width:1200px;margin:0 auto;display:grid;grid-template-columns:repeat(5,1fr);gap:1rem}
.stat-pill-num{font-family:var(--serif);font-size:1.4rem;color:var(--gold);font-weight:700;display:block;line-height:1}
.stat-pill-label{font-family:var(--mono);font-size:.62rem;color:var(--text-muted);letter-spacing:.06em;text-transform:uppercase;margin-top:.2rem;display:block}
/* VALUE PROPS */
.vprop-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:1.5rem;margin-top:3rem}
.vprop-card{padding:1.75rem;border-radius:var(--radius-lg);background:var(--surface);border:1px solid var(--border);backdrop-filter:var(--blur-sm);transition:all .3s;position:relative;overflow:hidden}
.vprop-card::before{content:"";position:absolute;inset:0;border-radius:inherit;background:linear-gradient(135deg,transparent 40%,rgba(212,175,55,0.04));pointer-events:none}
.vprop-card:hover{border-color:var(--border-em);transform:translateY(-4px);box-shadow:var(--shadow-em)}
.vprop-icon{width:50px;height:50px;border-radius:14px;background:linear-gradient(135deg,var(--emerald),var(--deep-emerald));display:flex;align-items:center;justify-content:center;font-size:1.4rem;margin-bottom:1.25rem;box-shadow:0 4px 15px rgba(4,120,87,0.35)}
.vprop-title{font-family:var(--serif);font-size:1.1rem;font-weight:600;margin-bottom:.6rem}
.vprop-desc{font-size:.87rem;color:var(--text-muted);line-height:1.65}
/* SECTION LABELS */
.section-label{font-family:var(--mono);font-size:.72rem;letter-spacing:.14em;text-transform:uppercase;color:var(--gold);margin-bottom:.75rem}
.section-title{font-family:var(--serif);font-size:clamp(1.6rem,3vw,2.4rem);font-weight:700;line-height:1.2;margin-bottom:1rem}
.section-title em{font-style:normal;color:var(--gold)}
.section-sub{font-size:.95rem;color:var(--text-muted);line-height:1.65;max-width:560px}
/* JOB BOARD */
.job-filter-bar{display:flex;gap:.75rem;flex-wrap:wrap;align-items:center;margin-bottom:1.75rem}
.job-filter-bar input,.job-filter-bar select{flex:1;min-width:180px;padding:.65rem 1rem;background:var(--surface-2);border:1px solid var(--border);border-radius:var(--radius-sm);color:var(--text);font-family:var(--sans);font-size:.87rem;outline:none;transition:.2s}
.job-filter-bar input:focus,.job-filter-bar select:focus{border-color:var(--border-em);box-shadow:0 0 0 3px var(--emerald-glow)}
.job-filter-bar select option{background:var(--charcoal)}.job-filter-bar input::placeholder{color:var(--text-dim)}
.jobs-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:1.25rem}
.job-card{padding:1.5rem;border-radius:var(--radius);background:var(--surface);border:1px solid var(--border);backdrop-filter:var(--blur-sm);transition:all .3s}
.job-card:hover{border-color:var(--border-em);transform:translateY(-3px);box-shadow:var(--shadow-em)}
.job-card-header{display:flex;align-items:flex-start;justify-content:space-between;gap:.75rem;margin-bottom:.85rem}
.job-title{font-family:var(--serif);font-size:1.05rem;font-weight:600;line-height:1.3;flex:1}
.job-badge{font-family:var(--mono);font-size:.62rem;font-weight:600;letter-spacing:.05em;text-transform:uppercase;padding:3px 9px;border-radius:20px;white-space:nowrap;flex-shrink:0}
.badge-active{background:rgba(4,120,87,0.2);color:#4ade80;border:1px solid rgba(4,120,87,0.35)}
.badge-draft{background:rgba(245,158,11,0.15);color:var(--amber);border:1px solid rgba(245,158,11,0.3)}
.badge-closed{background:rgba(239,68,68,0.1);color:var(--red);border:1px solid rgba(239,68,68,0.25)}
.badge-urgent{background:rgba(239,68,68,0.15);color:#fca5a5;border:1px solid rgba(239,68,68,0.3)}
.job-meta{display:flex;gap:.5rem;flex-wrap:wrap;margin-bottom:.85rem}
.meta-chip{font-family:var(--mono);font-size:.65rem;padding:3px 9px;border-radius:20px;border:1px solid var(--border);color:var(--text-muted);white-space:nowrap}
.meta-chip.loc{border-color:rgba(212,175,55,0.25);color:rgba(212,175,55,0.85)}
.meta-chip.sal{border-color:rgba(4,120,87,0.3);color:rgba(74,222,128,0.85)}
.job-desc-preview{font-size:.83rem;color:var(--text-muted);line-height:1.55;margin-bottom:1rem;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
.job-actions{display:flex;gap:.6rem;align-items:center;flex-wrap:wrap}
.match-score{font-family:var(--mono);font-size:.78rem;font-weight:600;padding:.3rem .75rem;border-radius:20px;flex-shrink:0}
.match-premium{background:rgba(212,175,55,0.2);color:var(--gold);border:1px solid var(--border-gold)}
.match-strong{background:rgba(4,120,87,0.2);color:#4ade80;border:1px solid rgba(4,120,87,0.35)}
.match-fit{background:rgba(59,130,246,0.15);color:#93c5fd;border:1px solid rgba(59,130,246,0.3)}
.match-gem{background:rgba(168,85,247,0.15);color:#c4b5fd;border:1px solid rgba(168,85,247,0.3)}
/* SKILL TAGS */
.skill-tags{display:flex;gap:.45rem;flex-wrap:wrap;margin:.65rem 0}
.skill-tag{font-family:var(--mono);font-size:.65rem;padding:3px 9px;border-radius:20px;background:var(--surface-2);border:1px solid var(--border);color:var(--text-muted)}
.skill-tag.em{border-color:var(--border-em);color:rgba(74,222,128,0.8);background:rgba(4,120,87,0.1)}
/* SALARY TABLE */
.salary-table{width:100%;border-collapse:collapse;margin-top:1.5rem}
.salary-table th{font-family:var(--mono);font-size:.68rem;font-weight:600;letter-spacing:.08em;text-transform:uppercase;color:var(--gold);text-align:left;padding:.85rem 1rem;border-bottom:1px solid var(--border-gold);background:rgba(212,175,55,0.06)}
.salary-table td{padding:.8rem 1rem;border-bottom:1px solid var(--border);font-size:.87rem;color:var(--text-2);vertical-align:middle}
.salary-table tr:hover td{background:var(--surface-2)}
.salary-bar-wrap{width:120px;height:6px;background:var(--surface-2);border-radius:3px;overflow:hidden;display:inline-block;vertical-align:middle}
.salary-bar-fill{height:100%;border-radius:3px;background:linear-gradient(90deg,var(--emerald),var(--gold))}
.trend-up{color:#4ade80;font-size:.8rem}.trend-dn{color:var(--red);font-size:.8rem}
/* NEWS */
.news-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:1.25rem;margin-top:2rem}
.news-card{padding:1.4rem;border-radius:var(--radius);background:var(--surface);border:1px solid var(--border);transition:all .3s}
.news-card:hover{border-color:var(--border-em);transform:translateY(-3px)}
.news-category{font-family:var(--mono);font-size:.62rem;letter-spacing:.1em;text-transform:uppercase;color:var(--gold);margin-bottom:.6rem}
.news-title{font-family:var(--serif);font-size:.98rem;font-weight:600;line-height:1.4;margin-bottom:.5rem}
.news-excerpt{font-size:.82rem;color:var(--text-muted);line-height:1.6}
.news-date{font-family:var(--mono);font-size:.65rem;color:var(--text-dim);margin-top:.75rem}
/* CV RESOURCES */
.cv-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:1rem;margin-top:2rem}
.cv-card{padding:1.4rem;border-radius:var(--radius);background:var(--surface);border:1px solid var(--border);text-align:center;transition:all .3s}
.cv-card:hover{border-color:var(--border-gold);transform:translateY(-3px);box-shadow:var(--glow-gold)}
.cv-icon{font-size:2rem;margin-bottom:.85rem;display:block}
.cv-title{font-family:var(--serif);font-size:.98rem;font-weight:600;margin-bottom:.4rem}
.cv-desc{font-size:.8rem;color:var(--text-muted);line-height:1.55;margin-bottom:1rem}
/* FORMS */
.form-field{display:flex;flex-direction:column;gap:.4rem;margin-bottom:1rem}
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:.85rem}
.form-label{font-family:var(--mono);font-size:.68rem;font-weight:500;letter-spacing:.06em;text-transform:uppercase;color:var(--text-muted)}
.form-input,.form-select,.form-textarea{font-family:var(--sans);font-size:.9rem;background:var(--surface-2);border:1px solid var(--border);border-radius:var(--radius-sm);color:var(--text);padding:.7rem .95rem;outline:none;transition:.2s;width:100%}
.form-textarea{resize:vertical;min-height:90px}
.form-input::placeholder,.form-textarea::placeholder{color:var(--text-dim)}
.form-input:focus,.form-select:focus,.form-textarea:focus{border-color:var(--border-em);box-shadow:0 0 0 3px var(--emerald-glow)}
.form-select option{background:var(--charcoal)}
/* TOAST */
.toast{font-family:var(--mono);font-size:.78rem;padding:.7rem 1rem;border-radius:var(--radius-sm);border:1px solid;display:none;margin:.5rem 0}
.toast.show{display:block}
.toast.success{background:rgba(4,120,87,0.15);border-color:var(--border-em);color:#4ade80}
.toast.error{background:rgba(239,68,68,0.1);border-color:rgba(239,68,68,0.35);color:#fca5a5}
.toast.info{background:rgba(212,175,55,0.08);border-color:var(--border-gold);color:var(--gold)}
/* MODAL */
.modal-overlay{position:fixed;inset:0;z-index:200;background:rgba(0,0,0,0.7);backdrop-filter:blur(6px);display:none;align-items:center;justify-content:center;padding:1rem}
.modal-overlay.open{display:flex}
.modal{background:linear-gradient(145deg,rgba(6,47,38,0.95),rgba(13,17,23,0.98));border:1px solid var(--border-em);border-radius:var(--radius-lg);padding:2.25rem;width:100%;max-width:520px;box-shadow:0 40px 100px rgba(0,0,0,0.7),0 0 60px rgba(4,120,87,0.15);max-height:90vh;overflow-y:auto;position:relative;animation:modal-in .3s cubic-bezier(.34,1.56,.64,1)}
.modal-wide{max-width:700px}.modal-xl{max-width:900px}
@keyframes modal-in{from{opacity:0;transform:scale(.92) translateY(20px)}to{opacity:1;transform:scale(1) translateY(0)}}
.modal-close{position:absolute;top:1rem;right:1rem;width:32px;height:32px;border-radius:50%;border:none;background:var(--surface-2);color:var(--text-muted);font-size:1.1rem;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:.2s}
.modal-close:hover{background:var(--surface-3);color:var(--text)}
.modal-title{font-family:var(--serif);font-size:1.4rem;font-weight:700;margin-bottom:.35rem;color:var(--text)}
.modal-sub{font-size:.85rem;color:var(--text-muted);margin-bottom:1.75rem}
/* DASHBOARD */
#dashboard-area{display:none}#public-area{display:block}
.dash-wrap{max-width:1200px;margin:0 auto;padding:2rem 1.5rem;display:grid;grid-template-columns:240px 1fr;gap:1.75rem;min-height:calc(100vh - 64px)}
.dash-sidebar{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-lg);padding:1.5rem;height:fit-content;position:sticky;top:88px}
.dash-user-info{text-align:center;padding-bottom:1.25rem;border-bottom:1px solid var(--border);margin-bottom:1.25rem}
.dash-avatar{width:56px;height:56px;border-radius:50%;margin:0 auto .75rem;background:linear-gradient(135deg,var(--emerald),var(--deep-emerald));border:2px solid var(--border-gold);display:flex;align-items:center;justify-content:center;font-family:var(--serif);font-size:1.2rem;color:var(--gold)}
.dash-user-name{font-family:var(--serif);font-size:1rem;font-weight:600;margin-bottom:.2rem}
.dash-user-role{font-family:var(--mono);font-size:.65rem;letter-spacing:.08em;text-transform:uppercase;color:var(--gold);padding:2px 8px;background:var(--gold-soft);border:1px solid var(--border-gold);border-radius:20px;display:inline-block}
.dash-nav{display:flex;flex-direction:column;gap:.25rem}
.dash-nav-item{display:flex;align-items:center;gap:.7rem;padding:.65rem .9rem;border-radius:var(--radius-sm);font-size:.84rem;font-weight:500;color:var(--text-muted);cursor:pointer;transition:.2s;border:none;background:none;width:100%;text-align:left}
.dash-nav-item:hover{background:var(--surface-2);color:var(--text)}
.dash-nav-item.active{background:rgba(4,120,87,0.18);color:var(--emerald-light);border-left:3px solid var(--emerald-light)}
.dash-content{min-width:0}
.dash-panel{display:none}
.dash-panel.active{display:block;animation:fadeIn .3s ease}
@keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
.panel-header{display:flex;align-items:flex-start;justify-content:space-between;gap:1rem;margin-bottom:1.75rem;flex-wrap:wrap}
.panel-title{font-family:var(--serif);font-size:1.5rem;font-weight:700}
.panel-sub{font-size:.85rem;color:var(--text-muted);margin-top:.2rem}
/* ANALYTICS */
.analytics-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:1rem;margin-bottom:2rem}
.analytics-card{padding:1.25rem;border-radius:var(--radius);background:var(--surface);border:1px solid var(--border);text-align:center;transition:all .3s}
.analytics-card:hover{border-color:var(--border-em)}
.analytics-num{font-family:var(--serif);font-size:2rem;color:var(--gold);font-weight:700;display:block;line-height:1}
.analytics-label{font-family:var(--mono);font-size:.62rem;text-transform:uppercase;letter-spacing:.07em;color:var(--text-muted);margin-top:.35rem;display:block}
/* CANDIDATES */
.candidates-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:1rem}
.candidate-card{padding:1.4rem;border-radius:var(--radius);background:var(--surface);border:1px solid var(--border);transition:all .3s;position:relative;overflow:hidden}
.candidate-card::before{content:"";position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(90deg,var(--emerald),var(--gold));opacity:0;transition:.3s}
.candidate-card:hover{border-color:var(--border-em);transform:translateY(-3px)}.candidate-card:hover::before{opacity:1}
.candidate-header{display:flex;align-items:center;gap:.9rem;margin-bottom:1rem}
.candidate-avatar{width:46px;height:46px;border-radius:50%;flex-shrink:0;background:linear-gradient(135deg,var(--emerald),var(--deep-emerald));border:2px solid var(--border-gold);display:flex;align-items:center;justify-content:center;font-family:var(--serif);font-size:1rem;color:var(--gold)}
.candidate-name{font-family:var(--serif);font-size:.98rem;font-weight:600;margin-bottom:.15rem}
.candidate-role{font-size:.78rem;color:var(--text-muted)}
.match-ring{margin-left:auto;flex-shrink:0;width:52px;height:52px;border-radius:50%;display:flex;align-items:center;justify-content:center;flex-direction:column;position:relative}
.match-ring-text{font-family:var(--mono);font-size:.72rem;font-weight:700;position:absolute;color:var(--gold)}
.match-breakdown{margin-top:1rem;padding-top:1rem;border-top:1px solid var(--border)}
.match-breakdown-row{display:flex;justify-content:space-between;align-items:center;margin-bottom:.5rem;font-size:.78rem}
.breakdown-label{color:var(--text-muted)}
.breakdown-bar-wrap{flex:1;height:4px;background:var(--surface-2);border-radius:2px;margin:0 .75rem;overflow:hidden}
.breakdown-bar{height:100%;border-radius:2px;background:linear-gradient(90deg,var(--emerald),var(--gold));transition:width 1s ease}
.breakdown-score{font-family:var(--mono);font-size:.7rem;color:var(--gold);min-width:36px;text-align:right}
/* PROFILE */
.completion-bar-wrap{height:8px;background:var(--surface-2);border-radius:4px;overflow:hidden;margin:.5rem 0}
.completion-bar{height:100%;border-radius:4px;background:linear-gradient(90deg,var(--emerald),var(--gold));transition:width 1s ease}
.profile-progress{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:1.25rem;margin-bottom:1.5rem}
/* CHIPS */
.chips-list{display:flex;gap:.4rem;flex-wrap:wrap;margin-top:.5rem}
.chip-removable{font-family:var(--mono);font-size:.65rem;padding:3px 8px 3px 9px;border-radius:20px;background:rgba(4,120,87,0.15);border:1px solid var(--border-em);color:rgba(74,222,128,0.85);display:flex;align-items:center;gap:.35rem}
.chip-remove{cursor:pointer;opacity:.6;font-size:.8rem}.chip-remove:hover{opacity:1}
/* TABLES */
.admin-table{width:100%;border-collapse:collapse}
.admin-table th{font-family:var(--mono);font-size:.65rem;font-weight:600;letter-spacing:.08em;text-transform:uppercase;color:var(--gold);text-align:left;padding:.7rem .85rem;border-bottom:1px solid var(--border-gold);background:rgba(212,175,55,0.05)}
.admin-table td{padding:.7rem .85rem;border-bottom:1px solid var(--border);font-size:.83rem;color:var(--text-2);vertical-align:middle}
.admin-table tr:hover td{background:var(--surface-2)}
.table-wrap{overflow-x:auto;border-radius:var(--radius-sm);border:1px solid var(--border)}
/* VIRTUAL JOB FAIR */
.vjf-badge{position:fixed;bottom:2rem;right:2rem;z-index:90;background:linear-gradient(135deg,var(--emerald),var(--deep-emerald));border:1px solid var(--border-gold);border-radius:50px;padding:.6rem 1.2rem;display:flex;align-items:center;gap:.6rem;cursor:pointer;box-shadow:var(--shadow-em);animation:float 3s ease-in-out infinite;font-family:var(--mono);font-size:.72rem;font-weight:600;color:var(--light-gold);text-decoration:none}
@keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-6px)}}
/* FOOTER */
footer{background:var(--charcoal-2);border-top:1px solid var(--border-em);padding:3rem 2rem 1.5rem;margin-top:4rem}
.footer-inner{max-width:1200px;margin:0 auto}
.footer-grid{display:grid;grid-template-columns:2fr 1fr 1fr 1fr;gap:2.5rem;margin-bottom:2rem}
.footer-brand-name{font-family:var(--serif);font-size:1.3rem;font-weight:700;margin-bottom:.6rem}
.footer-brand-name em{font-style:normal;color:var(--gold)}
.footer-desc{font-size:.83rem;color:var(--text-muted);line-height:1.65;max-width:280px}
.footer-col-title{font-family:var(--mono);font-size:.68rem;letter-spacing:.1em;text-transform:uppercase;color:var(--gold);margin-bottom:.85rem}
.footer-link{display:block;font-size:.83rem;color:var(--text-muted);text-decoration:none;margin-bottom:.4rem;transition:.2s;cursor:pointer}
.footer-link:hover{color:var(--text)}
.footer-bottom{border-top:1px solid var(--border);padding-top:1rem;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:.5rem}
.footer-copy{font-family:var(--mono);font-size:.68rem;color:var(--text-dim)}
/* MISC */
.hidden{display:none!important}
.divider{height:1px;background:var(--border);margin:1.25rem 0}
.tag-row{display:flex;gap:.4rem;flex-wrap:wrap;margin:.5rem 0}
.empty-state{text-align:center;padding:3rem 1.5rem;border:1px dashed var(--border);border-radius:var(--radius)}
.empty-icon{font-size:2.5rem;margin-bottom:1rem;display:block}
.empty-title{font-family:var(--serif);font-size:1.1rem;margin-bottom:.4rem}
.empty-sub{font-size:.83rem;color:var(--text-muted)}
.spinner{width:18px;height:18px;border:2px solid rgba(4,120,87,0.25);border-top-color:var(--emerald-light);border-radius:50%;display:inline-block;animation:spin .7s linear infinite;vertical-align:middle;margin-right:5px}
@keyframes spin{to{transform:rotate(360deg)}}
@media(max-width:768px){.dash-wrap{grid-template-columns:1fr}.dash-sidebar{position:static}.footer-grid{grid-template-columns:1fr 1fr}.stats-bar-inner{grid-template-columns:1fr 1fr}.form-row{grid-template-columns:1fr}.nav-links{display:none}}
</style>
</head>
<body><!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>ZimGetHired — Zimbabwe Talent Intelligence Platform</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700;900&family=Plus+Jakarta+Sans:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet"/>
<style>
:root{--emerald:#047857;--deep-emerald:#065f46;--emerald-light:#059669;--emerald-glow:rgba(4,120,87,0.35);--gold:#D4AF37;--gold-dim:#b8960d;--gold-soft:rgba(212,175,55,0.15);--light-gold:#fef3c7;--charcoal:#1f2937;--charcoal-2:#111827;--charcoal-3:#0d1117;--surface:rgba(255,255,255,0.04);--surface-2:rgba(255,255,255,0.07);--surface-3:rgba(255,255,255,0.11);--border:rgba(255,255,255,0.10);--border-em:rgba(4,120,87,0.40);--border-gold:rgba(212,175,55,0.30);--text:#f0fdf4;--text-2:#d1fae5;--text-muted:rgba(240,253,244,0.55);--text-dim:rgba(240,253,244,0.35);--red:#ef4444;--amber:#f59e0b;--radius:20px;--radius-lg:25px;--radius-sm:12px;--serif:"Playfair Display",serif;--sans:"Plus Jakarta Sans",sans-serif;--mono:"JetBrains Mono",monospace;--blur:blur(20px);--blur-sm:blur(10px);--shadow:0 20px 60px rgba(0,0,0,0.5);--shadow-em:0 0 40px rgba(4,120,87,0.25);--glow-gold:0 0 30px rgba(212,175,55,0.25)}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}html{scroll-behavior:smooth}
body{font-family:var(--sans);background:var(--charcoal-3);color:var(--text);min-height:100vh;overflow-x:hidden;background-image:linear-gradient(rgba(4,120,87,0.04) 1px,transparent 1px),linear-gradient(90deg,rgba(4,120,87,0.04) 1px,transparent 1px),radial-gradient(ellipse 80% 50% at 50% 0%,rgba(4,120,87,0.12) 0%,transparent 60%);background-size:40px 40px,40px 40px,100% 100%}
::-webkit-scrollbar{width:6px}::-webkit-scrollbar-track{background:var(--charcoal-2)}::-webkit-scrollbar-thumb{background:var(--emerald);border-radius:3px}
.ticker-wrap{width:100%;overflow:hidden;background:linear-gradient(90deg,var(--deep-emerald),var(--emerald),var(--deep-emerald));padding:8px 0;border-bottom:1px solid var(--border-em)}
.ticker-content{display:inline-flex;gap:3rem;animation:ticker 35s linear infinite;white-space:nowrap}
.ticker-content:hover{animation-play-state:paused}
.ticker-item{font-family:var(--mono);font-size:.72rem;letter-spacing:.04em;color:var(--light-gold);display:inline-flex;align-items:center;gap:.5rem}
.ticker-item span{color:var(--gold);font-weight:500}
@keyframes ticker{from{transform:translateX(0)}to{transform:translateX(-50%)}}
nav{position:sticky;top:0;z-index:100;backdrop-filter:var(--blur);background:rgba(6,47,38,0.85);border-bottom:1px solid var(--border-em);padding:0 2rem}
.nav-inner{max-width:1200px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;height:64px}
.nav-brand{display:flex;align-items:center;gap:.75rem;cursor:pointer;text-decoration:none}
.nav-logo{width:38px;height:38px;border-radius:10px;background:linear-gradient(135deg,var(--emerald),var(--deep-emerald));display:flex;align-items:center;justify-content:center;font-family:var(--serif);font-size:1rem;font-weight:700;color:var(--gold);border:1px solid var(--border-gold);flex-shrink:0}
.nav-name{font-family:var(--serif);font-size:1.1rem;font-weight:700}.nav-name em{font-style:normal;color:var(--gold)}
.nav-links{display:flex;gap:1.75rem;align-items:center}
.nav-link{font-size:.82rem;font-weight:500;color:var(--text-muted);cursor:pointer;transition:.2s;letter-spacing:.02em}.nav-link:hover{color:var(--gold)}
.nav-actions{display:flex;gap:.75rem;align-items:center}
.toggle-pill{width:32px;height:18px;border-radius:9px;background:var(--surface-2);border:1px solid var(--border);position:relative;transition:.3s;cursor:pointer;display:inline-block}
.toggle-pill.on{background:var(--emerald);border-color:var(--emerald)}
.toggle-knob{width:12px;height:12px;border-radius:50%;background:#fff;position:absolute;top:2px;left:2px;transition:.3s}
.toggle-pill.on .toggle-knob{left:16px}
.data-saver-toggle{display:flex;align-items:center;gap:.4rem;font-family:var(--mono);font-size:.68rem;color:var(--text-dim);cursor:pointer;user-select:none}
.btn{font-family:var(--sans);font-size:.83rem;font-weight:600;border:none;border-radius:var(--radius-sm);padding:.65rem 1.4rem;cursor:pointer;transition:all .22s;letter-spacing:.01em;text-decoration:none;display:inline-flex;align-items:center;gap:.45rem}
.btn-em{background:linear-gradient(135deg,var(--emerald),var(--deep-emerald));color:#fff;box-shadow:0 4px 15px rgba(4,120,87,0.4)}.btn-em:hover{transform:translateY(-1px);box-shadow:0 6px 20px rgba(4,120,87,0.55)}.btn-em:disabled{opacity:.45;cursor:not-allowed;transform:none}
.btn-gold{background:linear-gradient(135deg,var(--gold),var(--gold-dim));color:var(--charcoal-2);font-weight:700;box-shadow:var(--glow-gold)}.btn-gold:hover{transform:translateY(-1px);box-shadow:0 6px 25px rgba(212,175,55,0.5)}
.btn-ghost{background:var(--surface);color:var(--text-muted);border:1px solid var(--border)}.btn-ghost:hover{background:var(--surface-2);color:var(--text);border-color:var(--border-em)}
.btn-danger{background:rgba(239,68,68,0.12);color:var(--red);border:1px solid rgba(239,68,68,0.3)}.btn-danger:hover{background:rgba(239,68,68,0.22)}
.btn-wa{background:linear-gradient(135deg,#25D366,#128C7E);color:#fff;font-weight:700}.btn-wa:hover{transform:translateY(-1px);box-shadow:0 4px 15px rgba(37,211,102,0.4)}
.btn-sm{padding:.45rem 1rem;font-size:.76rem}.btn-xs{padding:.3rem .75rem;font-size:.7rem}.btn-full{width:100%;justify-content:center}
.section{padding:5rem 2rem;max-width:1200px;margin:0 auto}
#hero{position:relative;min-height:92vh;display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center;padding:6rem 2rem 4rem;overflow:hidden}
.hero-bg{position:absolute;inset:0;pointer-events:none;background:radial-gradient(ellipse 60% 70% at 50% -10%,rgba(4,120,87,0.30) 0%,transparent 60%),radial-gradient(ellipse 40% 40% at 10% 80%,rgba(212,175,55,0.08) 0%,transparent 50%),radial-gradient(ellipse 30% 50% at 90% 70%,rgba(4,120,87,0.12) 0%,transparent 50%)}
.hero-flag-stripe{position:absolute;inset:0;pointer-events:none;opacity:.04;background:repeating-linear-gradient(0deg,#000 0px,#000 33.3%,#D00 33.3%,#D00 66.6%,#080 66.6%,#080 100%);background-size:100% 9px}
.hero-orb{position:absolute;border-radius:50%;pointer-events:none;animation:orb-drift 8s ease-in-out infinite alternate}
.hero-orb-1{width:400px;height:400px;top:-80px;left:-100px;background:radial-gradient(circle,rgba(4,120,87,0.18) 0%,transparent 70%)}
.hero-orb-2{width:300px;height:300px;bottom:0;right:-80px;background:radial-gradient(circle,rgba(212,175,55,0.12) 0%,transparent 70%);animation-delay:-3s}
@keyframes orb-drift{from{transform:translate(0,0) scale(1)}to{transform:translate(30px,20px) scale(1.1)}}
.hero-eyebrow{font-family:var(--mono);font-size:.75rem;letter-spacing:.15em;text-transform:uppercase;color:var(--gold);margin-bottom:1.25rem;padding:.35rem 1rem;background:var(--gold-soft);border:1px solid var(--border-gold);border-radius:50px;display:inline-block}
.hero-h1{font-family:var(--serif);font-size:clamp(2.5rem,6vw,4.5rem);font-weight:900;line-height:1.08;letter-spacing:-.02em;max-width:820px;margin:0 auto 1.5rem}
.em-line{background:linear-gradient(90deg,var(--emerald),var(--gold));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.hero-sub{font-size:1.1rem;color:var(--text-muted);max-width:560px;margin:0 auto 2.5rem;line-height:1.7}
.hero-ctas{display:flex;gap:1rem;justify-content:center;flex-wrap:wrap;margin-bottom:3rem}
.hero-stats{display:flex;gap:2.5rem;justify-content:center;flex-wrap:wrap}
.hero-stat-num{font-family:var(--serif);font-size:2rem;font-weight:700;color:var(--gold);display:block}
.hero-stat-label{font-family:var(--mono);font-size:.68rem;color:var(--text-muted);letter-spacing:.08em;text-transform:uppercase}
.pulse-dot{display:inline-block;width:8px;height:8px;border-radius:50%;background:var(--emerald-light);margin-right:.4rem;animation:pulse-anim 2s infinite;vertical-align:middle}
@keyframes pulse-anim{0%,100%{box-shadow:0 0 0 0 rgba(5,150,105,0.6)}50%{box-shadow:0 0 0 8px rgba(5,150,105,0)}}
.stats-bar{background:linear-gradient(90deg,rgba(6,47,38,0.9),rgba(4,120,87,0.2),rgba(6,47,38,0.9));border-top:1px solid var(--border-em);border-bottom:1px solid var(--border-em);padding:.85rem 2rem}
.stats-bar-inner{max-width:1200px;margin:0 auto;display:grid;grid-template-columns:repeat(5,1fr);gap:1rem}
.stat-pill-num{font-family:var(--serif);font-size:1.4rem;color:var(--gold);font-weight:700;display:block;line-height:1}
.stat-pill-label{font-family:var(--mono);font-size:.62rem;color:var(--text-muted);letter-spacing:.06em;text-transform:uppercase;margin-top:.2rem;display:block}
.vprop-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:1.5rem;margin-top:3rem}
.vprop-card{padding:1.75rem;border-radius:var(--radius-lg);background:var(--surface);border:1px solid var(--border);backdrop-filter:var(--blur-sm);transition:all .3s;position:relative;overflow:hidden}
.vprop-card::before{content:"";position:absolute;inset:0;border-radius:inherit;background:linear-gradient(135deg,transparent 40%,rgba(212,175,55,0.04));pointer-events:none}
.vprop-card:hover{border-color:var(--border-em);transform:translateY(-4px);box-shadow:var(--shadow-em)}
.vprop-icon{width:50px;height:50px;border-radius:14px;background:linear-gradient(135deg,var(--emerald),var(--deep-emerald));display:flex;align-items:center;justify-content:center;font-size:1.4rem;margin-bottom:1.25rem;box-shadow:0 4px 15px rgba(4,120,87,0.35)}
.vprop-title{font-family:var(--serif);font-size:1.1rem;font-weight:600;margin-bottom:.6rem}
.vprop-desc{font-size:.87rem;color:var(--text-muted);line-height:1.65}
.section-label{font-family:var(--mono);font-size:.72rem;letter-spacing:.14em;text-transform:uppercase;color:var(--gold);margin-bottom:.75rem}
.section-title{font-family:var(--serif);font-size:clamp(1.6rem,3vw,2.4rem);font-weight:700;line-height:1.2;margin-bottom:1rem}
.section-title em{font-style:normal;color:var(--gold)}
.section-sub{font-size:.95rem;color:var(--text-muted);line-height:1.65;max-width:560px}
.job-filter-bar{display:flex;gap:.75rem;flex-wrap:wrap;align-items:center;margin-bottom:1.75rem}
.job-filter-bar input,.job-filter-bar select{flex:1;min-width:180px;padding:.65rem 1rem;background:var(--surface-2);border:1px solid var(--border);border-radius:var(--radius-sm);color:var(--text);font-family:var(--sans);font-size:.87rem;outline:none;transition:.2s}
.job-filter-bar input:focus,.job-filter-bar select:focus{border-color:var(--border-em);box-shadow:0 0 0 3px var(--emerald-glow)}
.job-filter-bar select option{background:var(--charcoal)}.job-filter-bar input::placeholder{color:var(--text-dim)}
.jobs-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:1.25rem}
.job-card{padding:1.5rem;border-radius:var(--radius);background:var(--surface);border:1px solid var(--border);backdrop-filter:var(--blur-sm);transition:all .3s}
.job-card:hover{border-color:var(--border-em);transform:translateY(-3px);box-shadow:var(--shadow-em)}
.job-card-header{display:flex;align-items:flex-start;justify-content:space-between;gap:.75rem;margin-bottom:.85rem}
.job-title{font-family:var(--serif);font-size:1.05rem;font-weight:600;line-height:1.3;flex:1}
.job-badge{font-family:var(--mono);font-size:.62rem;font-weight:600;letter-spacing:.05em;text-transform:uppercase;padding:3px 9px;border-radius:20px;white-space:nowrap;flex-shrink:0}
.badge-active{background:rgba(4,120,87,0.2);color:#4ade80;border:1px solid rgba(4,120,87,0.35)}
.badge-draft{background:rgba(245,158,11,0.15);color:var(--amber);border:1px solid rgba(245,158,11,0.3)}
.badge-closed{background:rgba(239,68,68,0.1);color:var(--red);border:1px solid rgba(239,68,68,0.25)}
.badge-urgent{background:rgba(239,68,68,0.15);color:#fca5a5;border:1px solid rgba(239,68,68,0.3)}
.job-meta{display:flex;gap:.5rem;flex-wrap:wrap;margin-bottom:.85rem}
.meta-chip{font-family:var(--mono);font-size:.65rem;padding:3px 9px;border-radius:20px;border:1px solid var(--border);color:var(--text-muted);white-space:nowrap}
.meta-chip.loc{border-color:rgba(212,175,55,0.25);color:rgba(212,175,55,0.85)}
.meta-chip.sal{border-color:rgba(4,120,87,0.3);color:rgba(74,222,128,0.85)}
.job-desc-preview{font-size:.83rem;color:var(--text-muted);line-height:1.55;margin-bottom:1rem;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
.job-actions{display:flex;gap:.6rem;align-items:center;flex-wrap:wrap}
.match-score{font-family:var(--mono);font-size:.78rem;font-weight:600;padding:.3rem .75rem;border-radius:20px;flex-shrink:0}
.match-premium{background:rgba(212,175,55,0.2);color:var(--gold);border:1px solid var(--border-gold)}
.match-strong{background:rgba(4,120,87,0.2);color:#4ade80;border:1px solid rgba(4,120,87,0.35)}
.match-fit{background:rgba(59,130,246,0.15);color:#93c5fd;border:1px solid rgba(59,130,246,0.3)}
.match-gem{background:rgba(168,85,247,0.15);color:#c4b5fd;border:1px solid rgba(168,85,247,0.3)}
.skill-tags{display:flex;gap:.45rem;flex-wrap:wrap;margin:.65rem 0}
.skill-tag{font-family:var(--mono);font-size:.65rem;padding:3px 9px;border-radius:20px;background:var(--surface-2);border:1px solid var(--border);color:var(--text-muted)}
.skill-tag.em{border-color:var(--border-em);color:rgba(74,222,128,0.8);background:rgba(4,120,87,0.1)}
.salary-table{width:100%;border-collapse:collapse;margin-top:1.5rem}
.salary-table th{font-family:var(--mono);font-size:.68rem;font-weight:600;letter-spacing:.08em;text-transform:uppercase;color:var(--gold);text-align:left;padding:.85rem 1rem;border-bottom:1px solid var(--border-gold);background:rgba(212,175,55,0.06)}
.salary-table td{padding:.8rem 1rem;border-bottom:1px solid var(--border);font-size:.87rem;color:var(--text-2);vertical-align:middle}
.salary-table tr:hover td{background:var(--surface-2)}
.salary-bar-wrap{width:100px;height:6px;background:var(--surface-2);border-radius:3px;overflow:hidden;display:inline-block;vertical-align:middle}
.salary-bar-fill{height:100%;border-radius:3px;background:linear-gradient(90deg,var(--emerald),var(--gold))}
.trend-up{color:#4ade80;font-size:.8rem}.trend-dn{color:var(--red);font-size:.8rem}
.news-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:1.25rem;margin-top:2rem}
.news-card{padding:1.4rem;border-radius:var(--radius);background:var(--surface);border:1px solid var(--border);transition:all .3s}
.news-card:hover{border-color:var(--border-em);transform:translateY(-3px)}
.news-category{font-family:var(--mono);font-size:.62rem;letter-spacing:.1em;text-transform:uppercase;color:var(--gold);margin-bottom:.6rem}
.news-title{font-family:var(--serif);font-size:.98rem;font-weight:600;line-height:1.4;margin-bottom:.5rem}
.news-excerpt{font-size:.82rem;color:var(--text-muted);line-height:1.6}
.news-date{font-family:var(--mono);font-size:.65rem;color:var(--text-dim);margin-top:.75rem}
.cv-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:1rem;margin-top:2rem}
.cv-card{padding:1.4rem;border-radius:var(--radius);background:var(--surface);border:1px solid var(--border);text-align:center;transition:all .3s}
.cv-card:hover{border-color:var(--border-gold);transform:translateY(-3px);box-shadow:var(--glow-gold)}
.cv-icon{font-size:2rem;margin-bottom:.85rem;display:block}
.cv-title{font-family:var(--serif);font-size:.98rem;font-weight:600;margin-bottom:.4rem}
.cv-desc{font-size:.8rem;color:var(--text-muted);line-height:1.55;margin-bottom:1rem}
.form-field{display:flex;flex-direction:column;gap:.4rem;margin-bottom:1rem}
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:.85rem}
.form-label{font-family:var(--mono);font-size:.68rem;font-weight:500;letter-spacing:.06em;text-transform:uppercase;color:var(--text-muted)}
.form-input,.form-select,.form-textarea{font-family:var(--sans);font-size:.9rem;background:var(--surface-2);border:1px solid var(--border);border-radius:var(--radius-sm);color:var(--text);padding:.7rem .95rem;outline:none;transition:.2s;width:100%}
.form-textarea{resize:vertical;min-height:90px}
.form-input::placeholder,.form-textarea::placeholder{color:var(--text-dim)}
.form-input:focus,.form-select:focus,.form-textarea:focus{border-color:var(--border-em);box-shadow:0 0 0 3px var(--emerald-glow)}
.form-select option{background:var(--charcoal)}
.toast{font-family:var(--mono);font-size:.78rem;padding:.7rem 1rem;border-radius:var(--radius-sm);border:1px solid;display:none;margin:.5rem 0}
.toast.show{display:block}
.toast.success{background:rgba(4,120,87,0.15);border-color:var(--border-em);color:#4ade80}
.toast.error{background:rgba(239,68,68,0.1);border-color:rgba(239,68,68,0.35);color:#fca5a5}
.toast.info{background:rgba(212,175,55,0.08);border-color:var(--border-gold);color:var(--gold)}
.modal-overlay{position:fixed;inset:0;z-index:200;background:rgba(0,0,0,0.7);backdrop-filter:blur(6px);display:none;align-items:center;justify-content:center;padding:1rem}
.modal-overlay.open{display:flex}
.modal{background:linear-gradient(145deg,rgba(6,47,38,0.95),rgba(13,17,23,0.98));border:1px solid var(--border-em);border-radius:var(--radius-lg);padding:2.25rem;width:100%;max-width:520px;box-shadow:0 40px 100px rgba(0,0,0,0.7),0 0 60px rgba(4,120,87,0.15);max-height:90vh;overflow-y:auto;position:relative;animation:modal-in .3s cubic-bezier(.34,1.56,.64,1)}
.modal-wide{max-width:700px}.modal-xl{max-width:900px}
@keyframes modal-in{from{opacity:0;transform:scale(.92) translateY(20px)}to{opacity:1;transform:scale(1) translateY(0)}}
.modal-close{position:absolute;top:1rem;right:1rem;width:32px;height:32px;border-radius:50%;border:none;background:var(--surface-2);color:var(--text-muted);font-size:1.1rem;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:.2s}
.modal-close:hover{background:var(--surface-3);color:var(--text)}
.modal-title{font-family:var(--serif);font-size:1.4rem;font-weight:700;margin-bottom:.35rem;color:var(--text)}
.modal-sub{font-size:.85rem;color:var(--text-muted);margin-bottom:1.75rem}
#dashboard-area{display:none}#public-area{display:block}
.dash-wrap{max-width:1200px;margin:0 auto;padding:2rem 1.5rem;display:grid;grid-template-columns:240px 1fr;gap:1.75rem;min-height:calc(100vh - 64px)}
.dash-sidebar{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-lg);padding:1.5rem;height:fit-content;position:sticky;top:88px}
.dash-user-info{text-align:center;padding-bottom:1.25rem;border-bottom:1px solid var(--border);margin-bottom:1.25rem}
.dash-avatar{width:56px;height:56px;border-radius:50%;margin:0 auto .75rem;background:linear-gradient(135deg,var(--emerald),var(--deep-emerald));border:2px solid var(--border-gold);display:flex;align-items:center;justify-content:center;font-family:var(--serif);font-size:1.2rem;color:var(--gold)}
.dash-user-name{font-family:var(--serif);font-size:1rem;font-weight:600;margin-bottom:.2rem}
.dash-user-role{font-family:var(--mono);font-size:.65rem;letter-spacing:.08em;text-transform:uppercase;color:var(--gold);padding:2px 8px;background:var(--gold-soft);border:1px solid var(--border-gold);border-radius:20px;display:inline-block}
.dash-nav{display:flex;flex-direction:column;gap:.25rem}
.dash-nav-item{display:flex;align-items:center;gap:.7rem;padding:.65rem .9rem;border-radius:var(--radius-sm);font-size:.84rem;font-weight:500;color:var(--text-muted);cursor:pointer;transition:.2s;border:none;background:none;width:100%;text-align:left}
.dash-nav-item:hover{background:var(--surface-2);color:var(--text)}
.dash-nav-item.active{background:rgba(4,120,87,0.18);color:var(--emerald-light);border-left:3px solid var(--emerald-light)}
.dash-content{min-width:0}
.dash-panel{display:none}.dash-panel.active{display:block;animation:fadeIn .3s ease}
@keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
.panel-header{display:flex;align-items:flex-start;justify-content:space-between;gap:1rem;margin-bottom:1.75rem;flex-wrap:wrap}
.panel-title{font-family:var(--serif);font-size:1.5rem;font-weight:700}
.panel-sub{font-size:.85rem;color:var(--text-muted);margin-top:.2rem}
.analytics-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:1rem;margin-bottom:2rem}
.analytics-card{padding:1.25rem;border-radius:var(--radius);background:var(--surface);border:1px solid var(--border);text-align:center;transition:all .3s}
.analytics-card:hover{border-color:var(--border-em)}
.analytics-num{font-family:var(--serif);font-size:2rem;color:var(--gold);font-weight:700;display:block;line-height:1}
.analytics-label{font-family:var(--mono);font-size:.62rem;text-transform:uppercase;letter-spacing:.07em;color:var(--text-muted);margin-top:.35rem;display:block}
.candidates-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:1rem}
.candidate-card{padding:1.4rem;border-radius:var(--radius);background:var(--surface);border:1px solid var(--border);transition:all .3s;position:relative;overflow:hidden}
.candidate-card::before{content:"";position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(90deg,var(--emerald),var(--gold));opacity:0;transition:.3s}
.candidate-card:hover{border-color:var(--border-em);transform:translateY(-3px)}.candidate-card:hover::before{opacity:1}
.candidate-header{display:flex;align-items:center;gap:.9rem;margin-bottom:1rem}
.candidate-avatar{width:46px;height:46px;border-radius:50%;flex-shrink:0;background:linear-gradient(135deg,var(--emerald),var(--deep-emerald));border:2px solid var(--border-gold);display:flex;align-items:center;justify-content:center;font-family:var(--serif);font-size:1rem;color:var(--gold)}
.candidate-name{font-family:var(--serif);font-size:.98rem;font-weight:600;margin-bottom:.15rem}
.candidate-role{font-size:.78rem;color:var(--text-muted)}
.match-ring{margin-left:auto;flex-shrink:0;position:relative;width:54px;height:54px;display:flex;align-items:center;justify-content:center}
.match-ring-text{font-family:var(--mono);font-size:.7rem;font-weight:700;position:absolute}
.match-breakdown{margin-top:1rem;padding-top:1rem;border-top:1px solid var(--border)}
.match-breakdown-row{display:flex;justify-content:space-between;align-items:center;margin-bottom:.5rem;font-size:.78rem}
.breakdown-label{color:var(--text-muted)}
.breakdown-bar-wrap{flex:1;height:4px;background:var(--surface-2);border-radius:2px;margin:0 .75rem;overflow:hidden}
.breakdown-bar{height:100%;border-radius:2px;background:linear-gradient(90deg,var(--emerald),var(--gold));transition:width 1s ease}
.breakdown-score{font-family:var(--mono);font-size:.7rem;color:var(--gold);min-width:36px;text-align:right}
.completion-bar-wrap{height:8px;background:var(--surface-2);border-radius:4px;overflow:hidden;margin:.5rem 0}
.completion-bar{height:100%;border-radius:4px;background:linear-gradient(90deg,var(--emerald),var(--gold));transition:width 1s ease}
.profile-progress{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:1.25rem;margin-bottom:1.5rem}
.chips-list{display:flex;gap:.4rem;flex-wrap:wrap;margin-top:.5rem}
.chip-removable{font-family:var(--mono);font-size:.65rem;padding:3px 8px 3px 9px;border-radius:20px;background:rgba(4,120,87,0.15);border:1px solid var(--border-em);color:rgba(74,222,128,0.85);display:flex;align-items:center;gap:.35rem}
.chip-remove{cursor:pointer;opacity:.6;font-size:.8rem}.chip-remove:hover{opacity:1}
.admin-table{width:100%;border-collapse:collapse}
.admin-table th{font-family:var(--mono);font-size:.65rem;font-weight:600;letter-spacing:.08em;text-transform:uppercase;color:var(--gold);text-align:left;padding:.7rem .85rem;border-bottom:1px solid var(--border-gold);background:rgba(212,175,55,0.05)}
.admin-table td{padding:.7rem .85rem;border-bottom:1px solid var(--border);font-size:.83rem;color:var(--text-2);vertical-align:middle}
.admin-table tr:hover td{background:var(--surface-2)}
.table-wrap{overflow-x:auto;border-radius:var(--radius-sm);border:1px solid var(--border)}
.vjf-badge{position:fixed;bottom:2rem;right:2rem;z-index:90;background:linear-gradient(135deg,var(--emerald),var(--deep-emerald));border:1px solid var(--border-gold);border-radius:50px;padding:.6rem 1.2rem;display:flex;align-items:center;gap:.6rem;cursor:pointer;box-shadow:var(--shadow-em);animation:float 3s ease-in-out infinite;font-family:var(--mono);font-size:.72rem;font-weight:600;color:var(--light-gold)}
@keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-6px)}}
footer{background:var(--charcoal-2);border-top:1px solid var(--border-em);padding:3rem 2rem 1.5rem;margin-top:4rem}
.footer-inner{max-width:1200px;margin:0 auto}
.footer-grid{display:grid;grid-template-columns:2fr 1fr 1fr 1fr;gap:2.5rem;margin-bottom:2rem}
.footer-brand-name{font-family:var(--serif);font-size:1.3rem;font-weight:700;margin-bottom:.6rem}
.footer-brand-name em{font-style:normal;color:var(--gold)}
.footer-desc{font-size:.83rem;color:var(--text-muted);line-height:1.65;max-width:280px}
.footer-col-title{font-family:var(--mono);font-size:.68rem;letter-spacing:.1em;text-transform:uppercase;color:var(--gold);margin-bottom:.85rem}
.footer-link{display:block;font-size:.83rem;color:var(--text-muted);margin-bottom:.4rem;transition:.2s;cursor:pointer}.footer-link:hover{color:var(--text)}
.footer-bottom{border-top:1px solid var(--border);padding-top:1rem;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:.5rem}
.footer-copy{font-family:var(--mono);font-size:.68rem;color:var(--text-dim)}
.hidden{display:none!important}
.tag-row{display:flex;gap:.4rem;flex-wrap:wrap;margin:.5rem 0}
.empty-state{text-align:center;padding:3rem 1.5rem;border:1px dashed var(--border);border-radius:var(--radius)}
.empty-icon{font-size:2.5rem;margin-bottom:1rem;display:block}
.empty-title{font-family:var(--serif);font-size:1.1rem;margin-bottom:.4rem}
.empty-sub{font-size:.83rem;color:var(--text-muted)}
.spinner{width:18px;height:18px;border:2px solid rgba(4,120,87,0.25);border-top-color:var(--emerald-light);border-radius:50%;display:inline-block;animation:spin .7s linear infinite;vertical-align:middle;margin-right:5px}
@keyframes spin{to{transform:rotate(360deg)}}
@media(max-width:768px){.dash-wrap{grid-template-columns:1fr}.dash-sidebar{position:static}.footer-grid{grid-template-columns:1fr 1fr}.stats-bar-inner{grid-template-columns:1fr 1fr}.form-row{grid-template-columns:1fr}.nav-links{display:none}}
</style>
</head>
<body>

<!-- TICKER -->
<div class="ticker-wrap" id="ticker-wrap"><div class="ticker-content" id="ticker-inner">
  <span class="ticker-item">&#127472;&#127484; Zimbabwe Job Market <span>LIVE</span></span>
  <span class="ticker-item">Active Jobs: <span id="tk-jobs">&#8212;</span></span>
  <span class="ticker-item">Talent Pool: <span id="tk-talent">&#8212;</span></span>
  <span class="ticker-item">Avg Salary (Harare): <span>USD 850/mo</span></span>
  <span class="ticker-item">Tech Roles <span>&#8679; 34%</span> YoY</span>
  <span class="ticker-item">Finance Sector <span>&#8679; 18%</span></span>
  <span class="ticker-item">Top Skill: <span>JavaScript</span></span>
  <span class="ticker-item">Most Searched: <span>Software Engineer</span></span>
  <span class="ticker-item">&#127472;&#127484; Powering Zimbabwe's Workforce</span>
  <span class="ticker-item">&#127472;&#127484; Zimbabwe Job Market <span>LIVE</span></span>
  <span class="ticker-item">Active Jobs: <span id="tk-jobs2">&#8212;</span></span>
  <span class="ticker-item">Talent Pool: <span id="tk-talent2">&#8212;</span></span>
  <span class="ticker-item">Top Skill: <span>JavaScript</span></span>
  <span class="ticker-item">&#127472;&#127484; Powering Zimbabwe's Workforce</span>
</div></div>

<!-- NAV -->
<nav>
  <div class="nav-inner">
    <a class="nav-brand" onclick="showPublic()">
      <div class="nav-logo">Z</div>
      <span class="nav-name">Zim<em>GetHired</em></span>
    </a>
    <div class="nav-links">
      <span class="nav-link" onclick="scrollTo2('job-board-section')">Job Board</span>
      <span class="nav-link" onclick="scrollTo2('salary-section')">Salaries</span>
      <span class="nav-link" onclick="scrollTo2('news-section')">Market Pulse</span>
      <span class="nav-link" onclick="scrollTo2('cv-section')">CV Resources</span>
    </div>
    <div class="nav-actions">
      <div class="data-saver-toggle" onclick="toggleDataSaver()">
        <div class="toggle-pill" id="ds-pill"><div class="toggle-knob"></div></div>
        <span>Data Saver</span>
      </div>
      <button class="btn btn-ghost btn-sm hidden" id="nav-dash-btn" onclick="showDashboard()">Dashboard</button>
      <button class="btn btn-em btn-sm hidden" id="nav-logout-btn" onclick="handleLogout()">Sign Out</button>
      <button class="btn btn-gold btn-sm" id="nav-login-btn" onclick="openAuth('login')">Sign In</button>
      <button class="btn btn-em btn-sm" id="nav-signup-btn" onclick="openAuth('signup')">Join Free</button>
    </div>
  </div>
</nav>

<!-- PUBLIC AREA -->
<div id="public-area">

<!-- HERO -->
<section id="hero">
  <div class="hero-bg"></div>
  <div class="hero-flag-stripe"></div>
  <div class="hero-orb hero-orb-1"></div>
  <div class="hero-orb hero-orb-2"></div>
  <div style="position:relative;z-index:1;width:100%">
    <div class="hero-eyebrow"><span class="pulse-dot"></span>Zimbabwe's #1 Talent Intelligence Platform</div>
    <h1 class="hero-h1">Discover Zimbabwe's<br/><span class="em-line">Best Talent &amp; Careers</span><br/>Through AI Matching</h1>
    <p class="hero-sub">The platform where Zimbabwe's brightest professionals meet the country's most ambitious employers &#8212; powered by intelligent matching, not just keyword search.</p>
    <div class="hero-ctas">
      <button class="btn btn-gold" style="padding:.85rem 2rem;font-size:.95rem" onclick="openAuth('signup')">&#128640; Get Hired Today</button>
      <button class="btn btn-ghost" style="padding:.85rem 2rem;font-size:.95rem" onclick="scrollTo2('job-board-section')">&#128203; Browse Jobs</button>
    </div>
    <div class="hero-stats">
      <div><span class="hero-stat-num" id="hero-stat-jobs">&#8212;</span><span class="hero-stat-label">Active Jobs</span></div>
      <div><span class="hero-stat-num" id="hero-stat-seekers">&#8212;</span><span class="hero-stat-label">Professionals</span></div>
      <div><span class="hero-stat-num" id="hero-stat-employers">&#8212;</span><span class="hero-stat-label">Employers</span></div>
      <div><span class="hero-stat-num">98%</span><span class="hero-stat-label">Match Accuracy</span></div>
    </div>
  </div>
</section>

<!-- LIVE STATS BAR -->
<div class="stats-bar">
  <div class="stats-bar-inner">
    <div><span class="stat-pill-num" id="sb-jobs">&#8212;</span><span class="stat-pill-label"><span class="pulse-dot" style="width:6px;height:6px"></span> Live Jobs</span></div>
    <div><span class="stat-pill-num" id="sb-seekers">&#8212;</span><span class="stat-pill-label">Professionals</span></div>
    <div><span class="stat-pill-num" id="sb-employers">&#8212;</span><span class="stat-pill-label">Employers</span></div>
    <div><span class="stat-pill-num" id="sb-applications">&#8212;</span><span class="stat-pill-label">Applications</span></div>
    <div><span class="stat-pill-num">ZiG&#8679;</span><span class="stat-pill-label">Economy Growing</span></div>
  </div>
</div>

<!-- VALUE PROPS -->
<div class="section">
  <div style="text-align:center;margin-bottom:1rem">
    <div class="section-label">Why ZimGetHired</div>
    <h2 class="section-title" style="max-width:600px;margin:0 auto">Two Systems. <em>One Powerful Platform.</em></h2>
    <p class="section-sub" style="margin:1rem auto 0;text-align:center">Combining traditional job board simplicity with AI-powered talent intelligence &#8212; built specifically for Zimbabwe.</p>
  </div>
  <div class="vprop-grid">
    <div class="vprop-card"><div class="vprop-icon">&#129504;</div><div class="vprop-title">AI Talent Matching</div><div class="vprop-desc">Our deterministic matching engine scores candidates across role overlap, skills, experience, and personality &#8212; giving employers ranked intelligence, not just a list of names.</div></div>
    <div class="vprop-card"><div class="vprop-icon">&#128203;</div><div class="vprop-title">Traditional Job Board</div><div class="vprop-desc">Post, browse, and apply to jobs the standard way. Full job management, status control (draft/active/closed), and application tracking &#8212; clean and fast.</div></div>
    <div class="vprop-card"><div class="vprop-icon">&#128241;</div><div class="vprop-title">WhatsApp-First Contact</div><div class="vprop-desc">No clunky internal messaging. Direct WhatsApp contact with one click &#8212; the way Zimbabwe communicates in business. Pre-filled messages save time.</div></div>
    <div class="vprop-card"><div class="vprop-icon">&#127482;&#127484;</div><div class="vprop-title">Built for Zimbabwe</div><div class="vprop-desc">USD and ZWL salary benchmarks. Zimbabwe-specific roles, cities, and industries. A platform that actually understands the local market and its talent.</div></div>
    <div class="vprop-card"><div class="vprop-icon">&#128142;</div><div class="vprop-title">Hidden Gem Discovery</div><div class="vprop-desc">Our algorithm surfaces high-skill candidates who may not match traditional filters &#8212; turning overlooked talent into premium hires through intelligent scoring.</div></div>
    <div class="vprop-card"><div class="vprop-icon">&#128274;</div><div class="vprop-title">Secure &amp; Private</div><div class="vprop-desc">Row-level security on all data. Employers see only their own jobs. Seekers control their profile visibility. Admin oversight without data leakage.</div></div>
  </div>
</div>

<!-- PUBLIC JOB BOARD -->
<div class="section" id="job-board-section">
  <div class="section-label">Browse Opportunities</div>
  <div class="section-title">Open <em>Positions</em></div>
  <p class="section-sub" style="margin-bottom:1.75rem">Live jobs from Zimbabwe's top employers. Sign in to see your personal match score.</p>
  <div class="job-filter-bar">
    <input id="pub-search" type="text" placeholder="&#128269;  Search jobs, skills, companies..." oninput="filterPublicJobs()"/>
    <select id="pub-location" onchange="filterPublicJobs()">
      <option value="">All Locations</option>
      <option>Harare</option><option>Bulawayo</option><option>Gweru</option>
      <option>Mutare</option><option>Masvingo</option><option>Remote</option>
    </select>
    <select id="pub-employment" onchange="filterPublicJobs()">
      <option value="">All Types</option>
      <option value="full-time">Full-time</option><option value="part-time">Part-time</option>
      <option value="contract">Contract</option><option value="internship">Internship</option>
    </select>
  </div>
  <div class="jobs-grid" id="public-jobs-grid">
    <div class="empty-state"><span class="spinner"></span><span style="color:var(--text-muted)"> Loading jobs...</span></div>
  </div>
</div>

<!-- SALARY BENCHMARK -->
<div class="section" id="salary-section" style="padding-top:3rem">
  <div class="section-label">Zim Market Intelligence</div>
  <div class="section-title"><em>Salary</em> Benchmarks 2024</div>
  <p class="section-sub">Monthly USD salary ranges for Zimbabwe's key professional roles.</p>
  <div class="table-wrap" style="margin-top:1.75rem">
    <table class="salary-table">
      <thead><tr><th>Role</th><th>Sector</th><th>Min</th><th>Mid</th><th>Max</th><th>Trend</th><th>Demand</th></tr></thead>
      <tbody>
        <tr><td>Software Engineer</td><td>Technology</td><td>$600</td><td>$1,200</td><td>$2,500</td><td class="trend-up">&#8679; 28%</td><td><div class="salary-bar-wrap"><div class="salary-bar-fill" style="width:95%"></div></div></td></tr>
        <tr><td>Data Analyst</td><td>Technology</td><td>$450</td><td>$850</td><td>$1,600</td><td class="trend-up">&#8679; 34%</td><td><div class="salary-bar-wrap"><div class="salary-bar-fill" style="width:88%"></div></div></td></tr>
        <tr><td>Accountant</td><td>Finance</td><td>$500</td><td>$900</td><td>$1,800</td><td class="trend-up">&#8679; 12%</td><td><div class="salary-bar-wrap"><div class="salary-bar-fill" style="width:82%"></div></div></td></tr>
        <tr><td>Civil Engineer</td><td>Construction</td><td>$700</td><td>$1,100</td><td>$2,000</td><td class="trend-up">&#8679; 18%</td><td><div class="salary-bar-wrap"><div class="salary-bar-fill" style="width:75%"></div></div></td></tr>
        <tr><td>Marketing Manager</td><td>Business</td><td>$400</td><td>$750</td><td>$1,400</td><td class="trend-up">&#8679; 15%</td><td><div class="salary-bar-wrap"><div class="salary-bar-fill" style="width:70%"></div></div></td></tr>
        <tr><td>Nurse / Midwife</td><td>Healthcare</td><td>$300</td><td>$550</td><td>$900</td><td class="trend-up">&#8679; 22%</td><td><div class="salary-bar-wrap"><div class="salary-bar-fill" style="width:90%"></div></div></td></tr>
        <tr><td>Teacher</td><td>Education</td><td>$200</td><td>$380</td><td>$650</td><td class="trend-up">&#8679; 8%</td><td><div class="salary-bar-wrap"><div class="salary-bar-fill" style="width:65%"></div></div></td></tr>
        <tr><td>Graphic Designer</td><td>Creative</td><td>$250</td><td>$500</td><td>$1,000</td><td class="trend-up">&#8679; 20%</td><td><div class="salary-bar-wrap"><div class="salary-bar-fill" style="width:72%"></div></div></td></tr>
        <tr><td>Project Manager</td><td>Management</td><td>$600</td><td>$1,050</td><td>$1,900</td><td class="trend-up">&#8679; 16%</td><td><div class="salary-bar-wrap"><div class="salary-bar-fill" style="width:78%"></div></div></td></tr>
        <tr><td>Driver / Logistics</td><td>Logistics</td><td>$180</td><td>$300</td><td>$500</td><td class="trend-dn">&#8681; 3%</td><td><div class="salary-bar-wrap"><div class="salary-bar-fill" style="width:55%"></div></div></td></tr>
      </tbody>
    </table>
  </div>
</div>

<!-- NEWS / MARKET PULSE -->
<div class="section" id="news-section" style="padding-top:3rem">
  <div class="section-label">Zim Market Pulse</div>
  <div class="section-title">Zimbabwe <em>Business</em> Intelligence</div>
  <div class="news-grid">
    <div class="news-card"><div class="news-category">&#128640; Technology</div><div class="news-title">Zimbabwe Tech Startups Raise $12M in Q3 2024</div><div class="news-excerpt">Harare's emerging tech ecosystem attracts regional investment as local developers build solutions for African markets.</div><div class="news-date">Dec 2024</div></div>
    <div class="news-card"><div class="news-category">&#128188; Employment</div><div class="news-title">Remote Work Adoption Surges Among Zim Employers</div><div class="news-excerpt">34% of Harare-based companies now offer hybrid or fully remote arrangements, opening roles to diaspora talent.</div><div class="news-date">Dec 2024</div></div>
    <div class="news-card"><div class="news-category">&#128200; Finance</div><div class="news-title">USD Salaries Stabilise Across Professional Sectors</div><div class="news-excerpt">With ZiG currency stabilisation, USD-pegged compensation is becoming standard for professional and executive roles.</div><div class="news-date">Nov 2024</div></div>
    <div class="news-card"><div class="news-category">&#127979; Education</div><div class="news-title">UZ, NUST Graduates Dominate Platform Sign-Ups</div><div class="news-excerpt">The class of 2024 is the most digitally active cohort, with 60% completing their ZimGetHired profiles within 48 hours.</div><div class="news-date">Nov 2024</div></div>
    <div class="news-card"><div class="news-category">&#127959; Infrastructure</div><div class="news-title">Construction Boom Drives Civil Engineering Demand</div><div class="news-excerpt">Major government and private infrastructure projects are creating hundreds of civil and structural engineering roles nationwide.</div><div class="news-date">Oct 2024</div></div>
    <div class="news-card"><div class="news-category">&#128138; Healthcare</div><div class="news-title">Healthcare Sector Faces Critical Talent Shortage</div><div class="news-excerpt">Diaspora brain drain continues to impact clinical staffing; private hospitals offering competitive USD packages to retain nurses.</div><div class="news-date">Oct 2024</div></div>
  </div>
</div>

<!-- CV RESOURCES -->
<div class="section" id="cv-section" style="padding-top:3rem">
  <div class="section-label">Career Centre</div>
  <div class="section-title">CV &amp; Career <em>Resources</em></div>
  <p class="section-sub">Expert guidance tailored to the Zimbabwe job market.</p>
  <div class="cv-grid">
    <div class="cv-card"><span class="cv-icon">&#128196;</span><div class="cv-title">CV Templates</div><div class="cv-desc">Professional CV templates designed for Zimbabwe employers. Downloadable Word &amp; PDF formats.</div><button class="btn btn-em btn-sm btn-full">Download Free</button></div>
    <div class="cv-card"><span class="cv-icon">&#127919;</span><div class="cv-title">Interview Prep</div><div class="cv-desc">Common interview questions from top Zimbabwe companies, with model answers and preparation frameworks.</div><button class="btn btn-em btn-sm btn-full">Prepare Now</button></div>
    <div class="cv-card"><span class="cv-icon">&#9997;&#65039;</span><div class="cv-title">Cover Letter Guide</div><div class="cv-desc">Write compelling cover letters that get past HR. Includes templates for different industries and roles.</div><button class="btn btn-em btn-sm btn-full">Read Guide</button></div>
    <div class="cv-card"><span class="cv-icon">&#128161;</span><div class="cv-title">LinkedIn Optimisation</div><div class="cv-desc">Optimise your LinkedIn for visibility to Zimbabwe and regional recruiters. Step-by-step checklist included.</div><button class="btn btn-em btn-sm btn-full">Optimise Profile</button></div>
    <div class="cv-card"><span class="cv-icon">&#129504;</span><div class="cv-title">Skills Assessment</div><div class="cv-desc">Take our skills benchmark test to understand where you rank vs Zimbabwe's job market requirements.</div><button class="btn btn-ghost btn-sm btn-full">Coming Soon</button></div>
    <div class="cv-card"><span class="cv-icon">&#128202;</span><div class="cv-title">Salary Calculator</div><div class="cv-desc">Benchmark your current salary against the Zimbabwe market. Know your worth and negotiate effectively.</div><button class="btn btn-ghost btn-sm btn-full">Coming Soon</button></div>
  </div>
</div>
</div><!-- /public-area -->

<!-- DASHBOARD AREA -->
<div id="dashboard-area">
  <div class="dash-wrap">
    <aside class="dash-sidebar" id="dash-sidebar">
      <div class="dash-user-info">
        <div class="dash-avatar" id="dash-avatar">?</div>
        <div class="dash-user-name" id="dash-name">&#8212;</div>
        <div class="dash-user-role" id="dash-role-badge">&#8212;</div>
      </div>
      <nav class="dash-nav" id="dash-nav"></nav>
      <div style="margin-top:1.5rem;border-top:1px solid var(--border);padding-top:1.25rem">
        <button class="btn btn-ghost btn-sm btn-full" onclick="showPublic()">&#127760; Public Site</button>
        <button class="btn btn-danger btn-sm btn-full" style="margin-top:.5rem" onclick="handleLogout()">Sign Out</button>
      </div>
    </aside>
    <main class="dash-content" id="dash-main"></main>
  </div>
</div>

<!-- AUTH MODAL -->
<div class="modal-overlay" id="auth-modal">
  <div class="modal">
    <button class="modal-close" onclick="closeModal('auth-modal')">&#10005;</button>
    <div id="auth-modal-login">
      <div class="modal-title">Welcome Back &#127482;&#127484;</div>
      <div class="modal-sub">Sign in to your ZimGetHired account</div>
      <div id="auth-toast" class="toast"></div>
      <div class="form-field"><label class="form-label">Email</label><input class="form-input" id="auth-email" type="email" placeholder="you@example.co.zw" autocomplete="email"/></div>
      <div class="form-field"><label class="form-label">Password</label><input class="form-input" id="auth-password" type="password" placeholder="&#8226;&#8226;&#8226;&#8226;&#8226;&#8226;&#8226;&#8226;" autocomplete="current-password"/></div>
      <button class="btn btn-em btn-full" id="login-btn" onclick="handleLogin()" style="margin-top:.5rem">Sign In</button>
      <p style="text-align:center;font-size:.82rem;color:var(--text-muted);margin-top:1rem">No account? <span style="color:var(--gold);cursor:pointer;font-weight:600" onclick="switchAuthTab('signup')">Create one free &#8594;</span></p>
    </div>
    <div id="auth-modal-signup" class="hidden">
      <div class="modal-title">Join ZimGetHired &#128640;</div>
      <div class="modal-sub">Create your free account and start your journey</div>
      <div id="signup-toast" class="toast"></div>
      <div class="form-field"><label class="form-label">Full Name</label><input class="form-input" id="su-name" type="text" placeholder="Tatenda Moyo" autocomplete="name"/></div>
      <div class="form-field"><label class="form-label">Email</label><input class="form-input" id="su-email" type="email" placeholder="tatenda@example.co.zw" autocomplete="email"/></div>
      <div class="form-field"><label class="form-label">Password</label><input class="form-input" id="su-password" type="password" placeholder="Min. 8 characters" autocomplete="new-password"/></div>
      <div class="form-field"><label class="form-label">I am a...</label>
        <select class="form-select" id="su-role">
          <option value="jobseeker">Job Seeker &#8212; I am looking for work</option>
          <option value="employer">Employer &#8212; I am hiring talent</option>
        </select>
      </div>
      <button class="btn btn-gold btn-full" id="signup-btn" onclick="handleSignup()" style="margin-top:.5rem">Create Free Account &#8594;</button>
      <p style="text-align:center;font-size:.82rem;color:var(--text-muted);margin-top:1rem">Have an account? <span style="color:var(--gold);cursor:pointer;font-weight:600" onclick="switchAuthTab('login')">Sign in &#8594;</span></p>
    </div>
  </div>
</div>

<!-- JOB DETAIL MODAL -->
<div class="modal-overlay" id="job-detail-modal">
  <div class="modal modal-wide"><button class="modal-close" onclick="closeModal('job-detail-modal')">&#10005;</button><div id="job-detail-content"></div></div>
</div>

<!-- POST JOB MODAL -->
<div class="modal-overlay" id="post-job-modal">
  <div class="modal modal-wide">
    <button class="modal-close" onclick="closeModal('post-job-modal')">&#10005;</button>
    <div class="modal-title">Post a Job</div>
    <div class="modal-sub">All fields map directly to posted_jobs schema columns</div>
    <div id="post-job-toast" class="toast"></div>
    <div class="form-row">
      <div class="form-field"><label class="form-label">Job Title &#8594; title</label><input class="form-input" id="pj-title" placeholder="e.g. Senior Software Engineer"/></div>
      <div class="form-field"><label class="form-label">Primary Role &#8594; primary_role</label><input class="form-input" id="pj-primary-role" placeholder="e.g. Engineering"/></div>
    </div>
    <div class="form-row">
      <div class="form-field"><label class="form-label">Location</label><input class="form-input" id="pj-location" placeholder="Harare / Remote / Bulawayo"/></div>
      <div class="form-field"><label class="form-label">Employment &#8594; employment</label>
        <select class="form-select" id="pj-employment">
          <option value="">Select...</option><option value="full-time">Full-time</option>
          <option value="part-time">Part-time</option><option value="contract">Contract</option>
          <option value="freelance">Freelance</option><option value="internship">Internship</option>
        </select>
      </div>
    </div>
    <div class="form-row">
      <div class="form-field"><label class="form-label">Experience &#8594; experience</label><input class="form-input" id="pj-experience" placeholder="e.g. 3+ years, Senior level"/></div>
      <div class="form-field"><label class="form-label">Urgency &#8594; urgency_level</label>
        <select class="form-select" id="pj-urgency">
          <option value="">Normal</option><option value="urgent">Urgent</option><option value="low">Low Priority</option>
        </select>
      </div>
    </div>
    <div class="form-field"><label class="form-label">Required Skills &#8594; required_skills (comma separated)</label><input class="form-input" id="pj-skills" placeholder="JavaScript, React, Node.js, PostgreSQL"/></div>
    <div class="form-row">
      <div class="form-field"><label class="form-label">Salary Min USD &#8594; salary_min</label><input class="form-input" id="pj-salary-min" type="number" placeholder="500" min="0"/></div>
      <div class="form-field"><label class="form-label">Salary Max USD &#8594; salary_max</label><input class="form-input" id="pj-salary-max" type="number" placeholder="1500" min="0"/></div>
    </div>
    <div class="form-field"><label class="form-label">Description &#8594; description</label><textarea class="form-textarea" id="pj-description" rows="5" placeholder="Describe the role, responsibilities, requirements, and what makes this opportunity special..."></textarea></div>
    <div class="form-row">
      <div class="form-field"><label class="form-label">Expires At &#8594; expires_at</label><input class="form-input" id="pj-expires" type="date"/></div>
      <div class="form-field"><label class="form-label">Status &#8594; status (ENUM)</label>
        <select class="form-select" id="pj-status">
          <option value="active">Active &#8212; visible to seekers</option>
          <option value="draft">Draft &#8212; hidden until ready</option>
        </select>
      </div>
    </div>
    <button class="btn btn-em btn-full" id="pj-submit-btn" onclick="submitJob()" style="margin-top:.75rem">Post Job &#8594;</button>
  </div>
</div>

<!-- CANDIDATE DETAIL MODAL -->
<div class="modal-overlay" id="candidate-modal">
  <div class="modal modal-wide"><button class="modal-close" onclick="closeModal('candidate-modal')">&#10005;</button><div id="candidate-detail-content"></div></div>
</div>

<!-- VIRTUAL JOB FAIR BADGE -->
<div class="vjf-badge" onclick="openAuth('signup')">
  <span class="pulse-dot"></span> Virtual Job Fair &#8212; Dec 20
</div>

<!-- FOOTER -->
<footer id="main-footer">
  <div class="footer-inner">
    <div class="footer-grid">
      <div>
        <div class="footer-brand-name">Zim<em>GetHired</em></div>
        <p class="footer-desc">Zimbabwe's premier AI-powered talent intelligence platform. Connecting the country's brightest professionals with its most ambitious employers.</p>
        <div style="margin-top:1rem;font-family:var(--mono);font-size:.65rem;color:var(--text-dim)">&#127482;&#127484; Proudly Zimbabwean</div>
      </div>
      <div>
        <div class="footer-col-title">Platform</div>
        <span class="footer-link" onclick="scrollTo2('job-board-section')">Job Board</span>
        <span class="footer-link" onclick="openAuth('signup')">Post a Job</span>
        <span class="footer-link" onclick="scrollTo2('salary-section')">Salary Guide</span>
        <span class="footer-link" onclick="scrollTo2('cv-section')">CV Resources</span>
      </div>
      <div>
        <div class="footer-col-title">Company</div>
        <span class="footer-link">About Us</span>
        <span class="footer-link">Blog</span>
        <span class="footer-link">Careers</span>
        <span class="footer-link">Contact</span>
      </div>
      <div>
        <div class="footer-col-title">Legal</div>
        <span class="footer-link">Privacy Policy</span>
        <span class="footer-link">Terms of Use</span>
        <span class="footer-link">Cookie Policy</span>
        <span class="footer-link">GDPR</span>
      </div>
    </div>
    <div class="footer-bottom">
      <span class="footer-copy">&#169; 2024 ZimGetHired. All rights reserved. Built in Zimbabwe &#127482;&#127484;</span>
      <div style="display:flex;gap:3px">
        <div style="width:16px;height:8px;border-radius:1px;background:#000"></div>
        <div style="width:16px;height:8px;border-radius:1px;background:#D00"></div>
        <div style="width:16px;height:8px;border-radius:1px;background:#FFD700"></div>
        <div style="width:16px;height:8px;border-radius:1px;background:#080"></div>
      </div>
    </div>
  </div>
</footer>

<script>
// ═══════════════════════════════════════════════════
// CONFIG — replace with your Supabase project values
// ═══════════════════════════════════════════════════
const SUPABASE_URL  = 'https://sbqylafkgsrorzbhgras.supabase.co'
const SUPABASE_ANON = 'sb_publishable_nVTWcqmNvsKYZiXp8i6dDQ_n1BmwHs-'
const ADMIN_EMAILS  = ['admin@zimgethired.co.zw']

// ═══════════════════════════════════════════════════
// CLIENT — unchanged auth foundation
// ═══════════════════════════════════════════════════
const { createClient } = supabase
const sb = createClient(SUPABASE_URL, SUPABASE_ANON, {
  auth: { persistSession: true, autoRefreshToken: true, detectSessionInUrl: true }
})

// ═══════════════════════════════════════════════════
// STATE
// ═══════════════════════════════════════════════════
let currentProfile = null
let allPublicJobs   = []
let empJobs         = []
let empApps         = []
let seekerProfile   = null
let seekerRoles     = []
let seekerSkills    = []
let searchHistory   = []

// ═══════════════════════════════════════════════════
// AUTH STATE LISTENER — do NOT modify
// ═══════════════════════════════════════════════════
sb.auth.onAuthStateChange(async (event, session) => {
  console.log('[Auth]', event, session?.user?.id ?? 'no user')
  if (session?.user) {
    const profile = await loadProfile(session.user)
    if (profile) initDashboard(profile)
  } else {
    currentProfile = null
    showPublic()
    updateNavAuth(false)
  }
})

// ═══════════════════════════════════════════════════
// LOAD PROFILE — do NOT modify
// ═══════════════════════════════════════════════════
async function loadProfile(authUser) {
  const { data, error } = await sb
    .from('users')
    .select('id, role, full_name, email, created_at')
    .eq('id', authUser.id)
    .single()
  if (error) {
    console.warn('[Profile]', error.message)
    const fallback = {
      id: authUser.id,
      full_name: authUser.user_metadata?.full_name ?? authUser.email?.split('@')[0] ?? 'User',
      email: authUser.email,
      role: authUser.user_metadata?.role ?? 'jobseeker',
      created_at: authUser.created_at
    }
    currentProfile = fallback
    return fallback
  }
  currentProfile = data
  return data
}

// ═══════════════════════════════════════════════════
// SIGN UP — do NOT modify
// ═══════════════════════════════════════════════════
async function handleSignup() {
  const name  = v('su-name').trim()
  const email = v('su-email').trim()
  const pass  = v('su-password')
  const role  = v('su-role')
  if (!name || !email || !pass) return showToast('signup-toast', 'All fields are required.', 'error')
  if (pass.length < 8) return showToast('signup-toast', 'Password must be at least 8 characters.', 'error')
  setBtn('signup-btn', true, 'Creating Account...')
  const { error } = await sb.auth.signUp({
    email, password: pass,
    options: { data: { full_name: name, role } }
  })
  setBtn('signup-btn', false, 'Create Free Account &rarr;')
  if (error) return showToast('signup-toast', error.message, 'error')
  showToast('signup-toast', 'Account created! Check your email to confirm, then sign in.', 'success')
}

// ═══════════════════════════════════════════════════
// SIGN IN — do NOT modify
// ═══════════════════════════════════════════════════
async function handleLogin() {
  const email = v('auth-email').trim()
  const pass  = v('auth-password')
  if (!email || !pass) return showToast('auth-toast', 'Email and password required.', 'error')
  setBtn('login-btn', true, 'Signing in...')
  const { error } = await sb.auth.signInWithPassword({ email, password: pass })
  setBtn('login-btn', false, 'Sign In')
  if (error) return showToast('auth-toast', error.message, 'error')
  closeModal('auth-modal')
}

// ═══════════════════════════════════════════════════
// SIGN OUT — do NOT modify
// ═══════════════════════════════════════════════════
async function handleLogout() {
  await sb.auth.signOut()
}

// ═══════════════════════════════════════════════════
// DASHBOARD ROUTER
// Routes by role after successful auth
// ═══════════════════════════════════════════════════
function initDashboard(profile) {
  closeModal('auth-modal')
  updateNavAuth(true)

  const isAdmin = profile.role === 'admin' || ADMIN_EMAILS.includes(profile.email)
  const role = isAdmin ? 'admin' : profile.role

  el('dash-avatar').textContent    = initials(profile.full_name)
  el('dash-name').textContent      = profile.full_name || profile.email
  el('dash-role-badge').textContent = role === 'admin' ? 'Administrator' :
                                       role === 'employer' ? 'Employer' : 'Job Seeker'

  const navItems = role === 'admin'    ? adminNav() :
                   role === 'employer' ? employerNav() : seekerNav()

  el('dash-nav').innerHTML = navItems.map(n =>
    `<button class="dash-nav-item" data-panel="${n.p}" onclick="showPanel('${n.p}')">${n.i} ${n.l}</button>`
  ).join('')

  el('dash-main').innerHTML = role === 'admin'    ? buildAdminPanels() :
                               role === 'employer' ? buildEmployerPanels() :
                                                     buildSeekerPanels()

  showDashboard()
  showPanel(navItems[0].p)

  if (role === 'admin')         loadAdminData()
  else if (role === 'employer') loadEmployerData()
  else                          loadSeekerData()
}

function adminNav() { return [
  {p:'admin-overview', i:'&#128202;', l:'Overview'},
  {p:'admin-users',    i:'&#128101;', l:'All Users'},
  {p:'admin-jobs',     i:'&#128203;', l:'All Jobs'},
  {p:'admin-apps',     i:'&#128221;', l:'Applications'},
  {p:'admin-logs',     i:'&#128269;', l:'Search Logs'}
]}
function employerNav() { return [
  {p:'emp-overview',     i:'&#128202;', l:'Dashboard'},
  {p:'emp-jobs',         i:'&#128203;', l:'My Jobs'},
  {p:'emp-applications', i:'&#128221;', l:'Applications'},
  {p:'emp-matches',      i:'&#129504;', l:'AI Matches'},
  {p:'emp-search',       i:'&#128269;', l:'Search Talent'},
  {p:'emp-history',      i:'&#128336;', l:'Search History'},
  {p:'emp-analytics',    i:'&#128200;', l:'Analytics'}
]}
function seekerNav() { return [
  {p:'sk-overview',     i:'&#127968;', l:'Dashboard'},
  {p:'sk-profile',      i:'&#128100;', l:'My Profile'},
  {p:'sk-matches',      i:'&#10024;',  l:'Matched Jobs'},
  {p:'sk-applications', i:'&#128221;', l:'Applications'},
  {p:'sk-saved',        i:'&#128278;', l:'Saved Jobs'}
]}

function showPanel(id) {
  document.querySelectorAll('.dash-panel').forEach(p => p.classList.remove('active'))
  document.querySelectorAll('.dash-nav-item').forEach(b => b.classList.remove('active'))
  const p = el(id); if (p) p.classList.add('active')
  const b = document.querySelector(`[data-panel="${id}"]`); if (b) b.classList.add('active')
}

// ═══════════════════════════════════════════════════
// MATCHING ENGINE
//
// ARCHITECTURE:
//   Score = Role Overlap (40) + Skill Overlap (30) + Experience (20) + Personality (10) = 100
//
// Role Overlap (40 pts):
//   Tokenise job.primary_role + job.title vs seeker.roles
//   Exact token match = full weight; word-level partial match = partial weight
//
// Skill Overlap (30 pts):
//   Intersection of job.required_skills (CSV) vs seeker.skills array
//   score = (matches / total_job_skills) * 30, capped at 30
//   If job has no required_skills: neutral 15 pts
//
// Experience Level (20 pts):
//   Map both sides to numeric index in ordered levels array
//   diff=0 -> 20, diff=1 -> 14, diff=2 -> 7, diff>=3 -> 2
//
// Personality (10 pts):
//   Exact match = 10, mismatch = 4, missing = 5 (neutral)
//
// Hidden Gem:
//   skillScore >= 15 AND roleScore < 10 AND total >= 40
//   Surfaced in employer match view with purple badge
//
// Classification:
//   90+ -> Premium Match (gold)
//   75-89 -> Strong Match (green)
//   60-74 -> Potential Fit (blue)
//   <60 -> Hidden Gem (purple) — only shown if meets criteria
// ═══════════════════════════════════════════════════
function computeMatch(job, seeker) {
  // Role (40)
  const jRoles = normTokens([job.primary_role, job.title])
  const sRoles = normTokens(Array.isArray(seeker.roles) ? seeker.roles : [])
  let roleScore = 0
  if (jRoles.length && sRoles.length) {
    const exact = jRoles.filter(r => sRoles.some(s => s === r || s.includes(r) || r.includes(s)))
    roleScore = Math.min(40, Math.round((exact.length / jRoles.length) * 40))
    if (!roleScore) {
      const jw = jRoles.join(' ').split(' ').filter(w => w.length > 3)
      const sw = sRoles.join(' ').split(' ')
      const wm = jw.filter(w => sw.includes(w))
      roleScore = Math.min(40, wm.length * 8)
    }
  }

  // Skills (30)
  const jSkills = normTokens(csvSplit(job.required_skills))
  const sSkills = normTokens(Array.isArray(seeker.skills) ? seeker.skills : [])
  let skillScore = jSkills.length ? 0 : 15
  if (jSkills.length && sSkills.length) {
    const m = jSkills.filter(js => sSkills.some(ss => ss.includes(js) || js.includes(ss)))
    skillScore = Math.min(30, Math.round((m.length / jSkills.length) * 30))
  }

  // Experience (20)
  const levels = ['intern','entry','junior','mid','senior','lead','principal','manager','director','executive']
  const jIdx = expIdx(job.experience, levels)
  const sIdx = expIdx(seeker.experience_level, levels)
  let expScore = 10
  if (jIdx >= 0 && sIdx >= 0) {
    const d = Math.abs(jIdx - sIdx)
    expScore = d === 0 ? 20 : d === 1 ? 14 : d === 2 ? 7 : 2
  }

  // Personality (10)
  let persScore = 5
  if (job.preferred_personality && seeker.personality_type) {
    persScore = job.preferred_personality.toLowerCase() === seeker.personality_type.toLowerCase() ? 10 : 4
  }

  const total = Math.min(100, roleScore + skillScore + expScore + persScore)
  const isGem = skillScore >= 15 && roleScore < 10 && total >= 40

  return {
    score: total, role: roleScore, skill: skillScore, exp: expScore, pers: persScore,
    isGem, label: matchLabel(total, isGem)
  }
}

function matchLabel(s, gem) {
  if (gem)   return 'Hidden Gem'
  if (s>=90) return 'Premium Match'
  if (s>=75) return 'Strong Match'
  if (s>=60) return 'Potential Fit'
  return 'Hidden Gem'
}
function matchClass(l) {
  if (l==='Premium Match') return 'match-premium'
  if (l==='Strong Match')  return 'match-strong'
  if (l==='Potential Fit') return 'match-fit'
  return 'match-gem'
}
function normTokens(arr) {
  return arr.filter(Boolean).map(s=>s.toString().toLowerCase().trim()).filter(s=>s.length>1)
}
function csvSplit(str) {
  return str ? str.split(',').map(s=>s.trim()).filter(Boolean) : []
}
function expIdx(str, levels) {
  if (!str) return -1
  const l = str.toLowerCase()
  for (let i=0;i<levels.length;i++) if (l.includes(levels[i])) return i
  return -1
}

// ═══════════════════════════════════════════════════
// EMPLOYER PANELS HTML
// ═══════════════════════════════════════════════════
function buildEmployerPanels() {
  return `
  <div class="dash-panel" id="emp-overview">
    <div class="panel-header">
      <div><div class="panel-title">Dashboard</div><div class="panel-sub">Welcome back, <span id="emp-name-disp"></span></div></div>
      <button class="btn btn-gold" onclick="openModal('post-job-modal')">+ Post a Job</button>
    </div>
    <div class="analytics-grid">
      <div class="analytics-card"><span class="analytics-num" id="ov-total-jobs">&#8212;</span><span class="analytics-label">Total Jobs</span></div>
      <div class="analytics-card"><span class="analytics-num" id="ov-active-jobs">&#8212;</span><span class="analytics-label">Active Jobs</span></div>
      <div class="analytics-card"><span class="analytics-num" id="ov-draft-jobs">&#8212;</span><span class="analytics-label">Drafts</span></div>
      <div class="analytics-card"><span class="analytics-num" id="ov-total-apps">&#8212;</span><span class="analytics-label">Applications</span></div>
    </div>
    <div style="margin-bottom:1rem"><div style="font-family:var(--serif);font-size:1.2rem;font-weight:700">Recent Jobs</div></div>
    <div id="emp-recent-jobs"><div class="empty-state"><span class="spinner"></span></div></div>
  </div>

  <div class="dash-panel" id="emp-jobs">
    <div class="panel-header">
      <div><div class="panel-title">My Jobs</div><div class="panel-sub">Manage your posted positions</div></div>
      <button class="btn btn-gold" onclick="openModal('post-job-modal')">+ Post a Job</button>
    </div>
    <div id="emp-jobs-list"><div class="empty-state"><span class="spinner"></span></div></div>
  </div>

  <div class="dash-panel" id="emp-applications">
    <div class="panel-header"><div><div class="panel-title">Applications</div><div class="panel-sub">All applicants across your jobs</div></div></div>
    <div id="emp-apps-list"><div class="empty-state"><span class="spinner"></span></div></div>
  </div>

  <div class="dash-panel" id="emp-matches">
    <div class="panel-header"><div><div class="panel-title">AI Matches</div><div class="panel-sub">Select a job to see ranked AI-scored candidates</div></div></div>
    <div class="form-field" style="max-width:380px">
      <label class="form-label">Select Job</label>
      <select class="form-select" id="match-job-select" onchange="loadMatchesForJob()"><option value="">Choose a job...</option></select>
    </div>
    <div id="emp-matches-result"></div>
  </div>

  <div class="dash-panel" id="emp-search">
    <div class="panel-header"><div><div class="panel-title">Search Talent</div><div class="panel-sub">Find and AI-rank candidates manually</div></div></div>
    <div style="background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:1.5rem;margin-bottom:1.5rem">
      <div class="form-row">
        <div class="form-field"><label class="form-label">Role / Title</label><input class="form-input" id="ts-role" placeholder="Software Engineer"/></div>
        <div class="form-field"><label class="form-label">Location</label><input class="form-input" id="ts-location" placeholder="Harare"/></div>
      </div>
      <div class="form-row">
        <div class="form-field"><label class="form-label">Required Skills</label><input class="form-input" id="ts-skills" placeholder="React, Python, SQL"/></div>
        <div class="form-field"><label class="form-label">Experience Level</label>
          <select class="form-select" id="ts-exp">
            <option value="">Any</option><option>Intern</option><option>Entry</option>
            <option>Junior</option><option>Mid</option><option>Senior</option><option>Lead</option>
          </select>
        </div>
      </div>
      <button class="btn btn-em" onclick="searchTalent()">&#128269; Search &amp; Rank</button>
    </div>
    <div id="talent-search-results"></div>
  </div>

  <div class="dash-panel" id="emp-history">
    <div class="panel-header"><div><div class="panel-title">Search History</div><div class="panel-sub">Your recent talent searches</div></div></div>
    <div id="emp-search-history"><div class="empty-state"><span class="empty-icon">&#128336;</span><div class="empty-title">No searches yet</div><div class="empty-sub">Your search history appears here after you use Search Talent</div></div></div>
  </div>

  <div class="dash-panel" id="emp-analytics">
    <div class="panel-header"><div><div class="panel-title">Analytics</div><div class="panel-sub">Platform performance insights</div></div></div>
    <div class="analytics-grid" id="emp-analytics-cards"></div>
    <div id="emp-top-roles"></div>
  </div>`
}

// ═══════════════════════════════════════════════════
// JOB SEEKER PANELS HTML
// ═══════════════════════════════════════════════════
function buildSeekerPanels() {
  return `
  <div class="dash-panel" id="sk-overview">
    <div class="panel-header"><div><div class="panel-title">Dashboard</div><div class="panel-sub">Your talent intelligence hub</div></div></div>
    <div class="profile-progress" id="sk-progress-block">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:.65rem">
        <span style="font-family:var(--serif);font-size:.98rem;font-weight:600">Profile Strength</span>
        <span style="font-family:var(--mono);font-size:.72rem;color:var(--text-muted)" id="sk-pct">0%</span>
      </div>
      <div class="completion-bar-wrap"><div class="completion-bar" id="sk-progress-bar" style="width:0%"></div></div>
      <div style="font-family:var(--mono);font-size:.68rem;color:var(--text-muted);margin-top:.4rem" id="sk-progress-tip">Complete your profile to appear in employer matches</div>
    </div>
    <div class="analytics-grid">
      <div class="analytics-card"><span class="analytics-num" id="sk-stat-matches">&#8212;</span><span class="analytics-label">Job Matches</span></div>
      <div class="analytics-card"><span class="analytics-num" id="sk-stat-apps">&#8212;</span><span class="analytics-label">Applications</span></div>
      <div class="analytics-card"><span class="analytics-num" id="sk-stat-top">&#8212;</span><span class="analytics-label">Top Match %</span></div>
      <div class="analytics-card"><span class="analytics-num" id="sk-stat-saved">0</span><span class="analytics-label">Saved Jobs</span></div>
    </div>
    <div style="margin-top:1.25rem"><div style="font-family:var(--serif);font-size:1.2rem;font-weight:700;margin-bottom:1rem">Your Top Matches</div>
    <div id="sk-top-matches"><div class="empty-state"><span class="spinner"></span></div></div></div>
  </div>

  <div class="dash-panel" id="sk-profile">
    <div class="panel-header">
      <div><div class="panel-title">My Profile</div><div class="panel-sub">Visible to employers in AI match results &#8212; keep it complete</div></div>
      <button class="btn btn-em" id="sk-save-btn" onclick="saveProfile()">Save Profile</button>
    </div>
    <div id="sk-profile-toast" class="toast"></div>
    <div class="form-row">
      <div class="form-field"><label class="form-label">Full Name</label><input class="form-input" id="sk-fullname" placeholder="Tatenda Moyo"/></div>
      <div class="form-field"><label class="form-label">WhatsApp Number</label><input class="form-input" id="sk-whatsapp" placeholder="+263 77 123 4567"/></div>
    </div>
    <div class="form-row">
      <div class="form-field"><label class="form-label">Location</label><input class="form-input" id="sk-location" placeholder="Harare, Zimbabwe"/></div>
      <div class="form-field"><label class="form-label">Experience Level</label>
        <select class="form-select" id="sk-exp-level">
          <option value="">Select...</option>
          <option value="intern">Intern</option><option value="entry">Entry Level</option>
          <option value="junior">Junior (1&#8211;2 yrs)</option><option value="mid">Mid Level (3&#8211;5 yrs)</option>
          <option value="senior">Senior (5&#8211;8 yrs)</option><option value="lead">Lead / Principal</option>
          <option value="manager">Manager</option><option value="director">Director</option>
        </select>
      </div>
    </div>
    <div class="form-field">
      <label class="form-label">Professional Roles (what roles you fit &#8212; used in AI matching)</label>
      <div style="display:flex;gap:.5rem;margin-bottom:.4rem">
        <input class="form-input" id="sk-role-input" placeholder="e.g. Software Engineer" style="flex:1" onkeydown="if(event.key==='Enter'){addRoleChip();event.preventDefault()}"/>
        <button class="btn btn-ghost btn-sm" onclick="addRoleChip()">+ Add</button>
      </div>
      <div class="chips-list" id="sk-roles-chips"></div>
    </div>
    <div class="form-field">
      <label class="form-label">Skills (comma separated or add one by one &#8212; used in AI matching)</label>
      <div style="display:flex;gap:.5rem;margin-bottom:.4rem">
        <input class="form-input" id="sk-skill-input" placeholder="e.g. React, Python, SQL" style="flex:1" onkeydown="if(event.key==='Enter'){addSkillChip();event.preventDefault()}"/>
        <button class="btn btn-ghost btn-sm" onclick="addSkillChip()">+ Add</button>
      </div>
      <div class="chips-list" id="sk-skills-chips"></div>
    </div>
    <div class="form-field"><label class="form-label">Professional Bio</label><textarea class="form-textarea" id="sk-bio" placeholder="Tell employers about yourself &#8212; your background, strengths, and what you are looking for..." rows="4"></textarea></div>
    <div class="form-row">
      <div class="form-field"><label class="form-label">CV URL (PDF link)</label><input class="form-input" id="sk-cv-url" placeholder="https://drive.google.com/..."/></div>
      <div class="form-field"><label class="form-label">Intro Video URL (optional)</label><input class="form-input" id="sk-video-url" placeholder="https://youtube.com/..."/></div>
    </div>
    <div class="form-field"><label class="form-label">Personality Type (improves AI match accuracy)</label>
      <select class="form-select" id="sk-personality">
        <option value="">Select...</option>
        <option value="analytical">Analytical &#8212; Detail-oriented, data-driven</option>
        <option value="creative">Creative &#8212; Innovative, design-thinking</option>
        <option value="leader">Leader &#8212; People-first, strategic</option>
        <option value="executor">Executor &#8212; Task-focused, delivery-driven</option>
        <option value="collaborator">Collaborator &#8212; Team player, communicator</option>
      </select>
    </div>
  </div>

  <div class="dash-panel" id="sk-matches">
    <div class="panel-header">
      <div><div class="panel-title">Matched Jobs</div><div class="panel-sub">AI-ranked positions &#8212; matching is automatic discovery. Applying is a separate manual action.</div></div>
      <button class="btn btn-ghost btn-sm" onclick="loadSeekerMatches()">&#8635; Refresh</button>
    </div>
    <div id="sk-matches-grid"><div class="empty-state"><span class="spinner"></span></div></div>
  </div>

  <div class="dash-panel" id="sk-applications">
    <div class="panel-header"><div><div class="panel-title">My Applications</div><div class="panel-sub">Jobs you have manually applied to</div></div></div>
    <div id="sk-apps-list"><div class="empty-state"><span class="spinner"></span></div></div>
  </div>

  <div class="dash-panel" id="sk-saved">
    <div class="panel-header"><div><div class="panel-title">Saved Jobs</div><div class="panel-sub">Bookmarked positions</div></div></div>
    <div class="empty-state"><span class="empty-icon">&#128278;</span><div class="empty-title">No saved jobs yet</div><div class="empty-sub">Click the bookmark icon on any job to save it here</div></div>
  </div>`
}

// ═══════════════════════════════════════════════════
// ADMIN PANELS HTML
// ═══════════════════════════════════════════════════
function buildAdminPanels() {
  return `
  <div class="dash-panel" id="admin-overview">
    <div class="panel-header"><div><div class="panel-title">Admin Overview</div><div class="panel-sub">Platform-wide statistics &#8212; read-only via RLS</div></div></div>
    <div class="analytics-grid">
      <div class="analytics-card"><span class="analytics-num" id="ad-users">&#8212;</span><span class="analytics-label">Total Users</span></div>
      <div class="analytics-card"><span class="analytics-num" id="ad-seekers">&#8212;</span><span class="analytics-label">Job Seekers</span></div>
      <div class="analytics-card"><span class="analytics-num" id="ad-employers">&#8212;</span><span class="analytics-label">Employers</span></div>
      <div class="analytics-card"><span class="analytics-num" id="ad-jobs">&#8212;</span><span class="analytics-label">Total Jobs</span></div>
      <div class="analytics-card"><span class="analytics-num" id="ad-active">&#8212;</span><span class="analytics-label">Active Jobs</span></div>
      <div class="analytics-card"><span class="analytics-num" id="ad-apps">&#8212;</span><span class="analytics-label">Applications</span></div>
    </div>
  </div>
  <div class="dash-panel" id="admin-users">
    <div class="panel-header"><div><div class="panel-title">All Users</div></div></div>
    <div id="admin-users-wrap"><div class="empty-state"><span class="spinner"></span></div></div>
  </div>
  <div class="dash-panel" id="admin-jobs">
    <div class="panel-header"><div><div class="panel-title">All Jobs</div></div></div>
    <div id="admin-jobs-wrap"><div class="empty-state"><span class="spinner"></span></div></div>
  </div>
  <div class="dash-panel" id="admin-apps">
    <div class="panel-header"><div><div class="panel-title">All Applications</div></div></div>
    <div id="admin-apps-wrap"><div class="empty-state"><span class="spinner"></span></div></div>
  </div>
  <div class="dash-panel" id="admin-logs">
    <div class="panel-header"><div><div class="panel-title">Search Logs</div></div></div>
    <div id="admin-logs-wrap"><div class="empty-state"><span class="spinner"></span></div></div>
  </div>`
}

// ═══════════════════════════════════════════════════
// EMPLOYER DATA
// ═══════════════════════════════════════════════════
async function loadEmployerData() {
  if (!currentProfile) return
  const nameEl = el('emp-name-disp')
  if (nameEl) nameEl.textContent = currentProfile.full_name || ''

  // posted_jobs — RLS: employer_id = auth.uid()
  const { data: jobs, error } = await sb
    .from('posted_jobs')
    .select('id,title,primary_role,required_skills,experience,location,employment,salary_min,salary_max,description,status,urgency_level,expires_at,created_at')
    .order('created_at', { ascending: false })

  if (error) { console.error('[EmpJobs]', error.message); return }
  empJobs = jobs || []

  // applications for those jobs
  empApps = []
  if (empJobs.length) {
    const ids = empJobs.map(j => j.id)
    const { data: apps } = await sb.from('applications').select('id,job_id,applicant_user_id,created_at').in('job_id', ids)
    empApps = apps || []
  }

  // populate job selector in AI Matches panel
  const sel = el('match-job-select')
  if (sel) {
    sel.innerHTML = '<option value="">Choose a job...</option>' +
      empJobs.map(j => `<option value="${j.id}">${esc(j.title)}</option>`).join('')
  }

  renderEmpOverview()
  renderEmpJobs()
  renderEmpApplications()
  renderEmpAnalytics()
}

function renderEmpOverview() {
  const active = empJobs.filter(j => j.status === 'active').length
  const draft  = empJobs.filter(j => j.status === 'draft').length
  setText('ov-total-jobs',  empJobs.length)
  setText('ov-active-jobs', active)
  setText('ov-draft-jobs',  draft)
  setText('ov-total-apps',  empApps.length)
  const recentEl = el('emp-recent-jobs')
  if (recentEl) recentEl.innerHTML = empJobs.length
    ? jobCardsGrid(empJobs.slice(0,4), true)
    : emptyHTML('&#128203;','No jobs posted yet','Post your first role to get started')
}

function renderEmpJobs() {
  const listEl = el('emp-jobs-list')
  if (listEl) listEl.innerHTML = empJobs.length
    ? jobCardsGrid(empJobs, true)
    : emptyHTML('&#128203;','No jobs posted yet','Use + Post a Job above')
}

function jobCardsGrid(jobs, isEmp) {
  return `<div class="jobs-grid">${jobs.map(j => buildJobCard(j, isEmp)).join('')}</div>`
}

function buildJobCard(j, isEmp=false) {
  const sc = j.status === 'active' ? 'badge-active' : j.status === 'draft' ? 'badge-draft' : 'badge-closed'
  const sal = fmtSal(j.salary_min, j.salary_max)
  const apps = empApps.filter(a => a.job_id === j.id).length

  let matchHTML = ''
  if (!isEmp && currentProfile?.role === 'jobseeker' && seekerProfile) {
    const r = computeMatch(j, {
      roles: seekerRoles, skills: seekerSkills,
      experience_level: seekerProfile.experience_level || '',
      personality_type: seekerProfile.personality_type || ''
    })
    matchHTML = `<span class="match-score ${matchClass(r.label)}" style="margin-left:auto">${r.score}%</span>`
  }

  return `<div class="job-card">
    <div class="job-card-header">
      <div class="job-title">${esc(j.title)}</div>
      <span class="job-badge ${sc}">${esc(j.status)}</span>
    </div>
    <div class="job-meta">
      ${j.location   ? `<span class="meta-chip loc">&#128205; ${esc(j.location)}</span>` : ''}
      ${j.employment ? `<span class="meta-chip">${esc(j.employment)}</span>` : ''}
      ${sal          ? `<span class="meta-chip sal">${sal}</span>` : ''}
      ${j.experience ? `<span class="meta-chip">${esc(j.experience)}</span>` : ''}
      ${j.urgency_level==='urgent' ? `<span class="job-badge badge-urgent">URGENT</span>` : ''}
    </div>
    ${j.required_skills ? `<div class="skill-tags">${csvSplit(j.required_skills).slice(0,5).map(s=>`<span class="skill-tag em">${esc(s)}</span>`).join('')}</div>` : ''}
    ${j.description ? `<div class="job-desc-preview">${esc(j.description)}</div>` : ''}
    <div class="job-actions" style="margin-top:.75rem">
      ${isEmp ? `
        <button class="btn btn-ghost btn-sm" onclick="viewJobMatches('${j.id}')">&#129504; AI Matches</button>
        <button class="btn btn-ghost btn-sm" onclick="cycleStatus('${j.id}','${j.status}')">&#9881;&#65039; ${j.status==='active'?'Close':'Activate'}</button>
        <span style="font-family:var(--mono);font-size:.7rem;color:var(--text-muted);margin-left:auto">${apps} applicant${apps!==1?'s':''}</span>
      ` : `
        <button class="btn btn-em btn-sm" onclick="openJobDetail('${j.id}')">View Details</button>
        <button class="btn btn-ghost btn-sm" onclick="applyToJob('${j.id}')">Apply</button>
        ${matchHTML}
      `}
    </div>
  </div>`
}

async function renderEmpApplications() {
  const el2 = el('emp-apps-list')
  if (!el2) return
  if (!empApps.length) { el2.innerHTML = emptyHTML('&#128221;','No applications yet','Applications to your jobs appear here'); return }

  const uids = [...new Set(empApps.map(a => a.applicant_user_id))]
  const { data: profiles } = await sb.from('users').select('id,full_name,email').in('id', uids)
  const pm = {}; (profiles||[]).forEach(p => pm[p.id] = p)

  el2.innerHTML = `<div class="table-wrap"><table class="admin-table">
    <thead><tr><th>Applicant</th><th>Email</th><th>Job</th><th>Applied</th><th>Action</th></tr></thead>
    <tbody>${empApps.map(a => {
      const p = pm[a.applicant_user_id] || {}
      const j = empJobs.find(x => x.id === a.job_id) || {}
      return `<tr>
        <td>${esc(p.full_name||'—')}</td>
        <td style="font-family:var(--mono);font-size:.73rem">${esc(p.email||'—')}</td>
        <td>${esc(j.title||'—')}</td>
        <td style="font-family:var(--mono);font-size:.73rem">${fmtDate(a.created_at)}</td>
        <td><button class="btn btn-ghost btn-xs" onclick="viewCandidateDetail('${a.applicant_user_id}','${a.job_id}')">Profile</button></td>
      </tr>`
    }).join('')}</tbody>
  </table></div>`
}

function renderEmpAnalytics() {
  const el2 = el('emp-analytics-cards')
  if (!el2) return
  const active = empJobs.filter(j=>j.status==='active').length
  const draft  = empJobs.filter(j=>j.status==='draft').length
  const closed = empJobs.filter(j=>j.status==='closed').length
  el2.innerHTML = `
    <div class="analytics-card"><span class="analytics-num">${empJobs.length}</span><span class="analytics-label">Total Jobs</span></div>
    <div class="analytics-card"><span class="analytics-num">${active}</span><span class="analytics-label">Active</span></div>
    <div class="analytics-card"><span class="analytics-num">${draft}</span><span class="analytics-label">Drafts</span></div>
    <div class="analytics-card"><span class="analytics-num">${closed}</span><span class="analytics-label">Closed</span></div>
    <div class="analytics-card"><span class="analytics-num">${empApps.length}</span><span class="analytics-label">Total Apps</span></div>
    <div class="analytics-card"><span class="analytics-num">${empJobs.length ? (empApps.length/empJobs.length).toFixed(1) : '&#8212;'}</span><span class="analytics-label">Apps / Job</span></div>`
}

// ─── Cycle job status (draft→active→closed→active) ──
async function cycleStatus(jobId, current) {
  const next = current === 'active' ? 'closed' : 'active'
  const { error } = await sb.from('posted_jobs').update({ status: next }).eq('id', jobId)
  if (error) { alert('Error: ' + error.message); return }
  await loadEmployerData()
}

// ─── Post Job ─────────────────────────────────────────
async function submitJob() {
  const title    = v('pj-title').trim()
  const desc     = v('pj-description').trim()
  const primRole = v('pj-primary-role').trim()
  const location = v('pj-location').trim()
  const emp      = v('pj-employment')
  const exp      = v('pj-experience').trim()
  const urgency  = v('pj-urgency')
  const skills   = v('pj-skills').trim()
  const sMin     = v('pj-salary-min')
  const sMax     = v('pj-salary-max')
  const expires  = v('pj-expires')
  const status   = v('pj-status') || 'active'

  if (!title || !desc) return showToast('post-job-toast','Title and description are required.','error')

  setBtn('pj-submit-btn', true, 'Posting...')
  const { error } = await sb.from('posted_jobs').insert({
    employer_id:     currentProfile.id,   // employer_id = auth.uid() — RLS enforces
    title,
    primary_role:    primRole   || null,
    location:        location   || null,
    employment:      emp        || null,
    experience:      exp        || null,
    urgency_level:   urgency    || null,
    required_skills: skills     || null,
    salary_min:      sMin ? parseInt(sMin,10) : null,
    salary_max:      sMax ? parseInt(sMax,10) : null,
    description:     desc,
    expires_at:      expires    || null,
    status                                // ENUM: draft | active | closed
  })
  setBtn('pj-submit-btn', false, 'Post Job &rarr;')
  if (error) return showToast('post-job-toast', error.message, 'error')

  showToast('post-job-toast','&#9989; Job posted! Running AI matching...','success')
  await loadEmployerData()

  setTimeout(async () => {
    closeModal('post-job-modal')
    clearJobForm()
    if (empJobs.length) await viewJobMatches(empJobs[0].id)
  }, 1800)
}

function clearJobForm() {
  ['pj-title','pj-primary-role','pj-location','pj-experience','pj-skills','pj-salary-min','pj-salary-max','pj-description','pj-expires'].forEach(id=>{const e=el(id);if(e)e.value=''})
}

// ─── AI Match view for a job ─────────────────────────
async function loadMatchesForJob() {
  const id = v('match-job-select')
  if (id) await viewJobMatches(id)
}

async function viewJobMatches(jobId) {
  showPanel('emp-matches')
  const sel = el('match-job-select'); if (sel) sel.value = jobId
  const res = el('emp-matches-result')
  if (!res) return
  res.innerHTML = '<div class="empty-state"><span class="spinner"></span> Running matching engine...</div>'

  const job = empJobs.find(j => j.id === jobId)
  if (!job) { res.innerHTML = '<div class="empty-state">Job not found</div>'; return }

  const { data: seekers, error } = await sb
    .from('job_seekers')
    .select('user_id,full_name,whatsapp,location,roles,skills,experience_level,bio,personality_type,cv_url')
  if (error) { res.innerHTML = `<div class="empty-state">Error: ${esc(error.message)}</div>`; return }
  if (!seekers?.length) { res.innerHTML = emptyHTML('&#128100;','No candidates yet','Job seekers will appear here once they complete profiles'); return }

  const scored = seekers.map(s => ({s, r: computeMatch(job, s)})).sort((a,b) => b.r.score - a.r.score)

  const premium = scored.filter(x => x.r.label==='Premium Match')
  const strong  = scored.filter(x => x.r.label==='Strong Match')
  const fit     = scored.filter(x => x.r.label==='Potential Fit')
  const gems    = scored.filter(x => x.r.isGem)

  res.innerHTML = `
    <div style="margin-bottom:1.25rem">
      <div style="font-family:var(--serif);font-size:1.1rem;font-weight:700">AI Match Results &mdash; ${esc(job.title)}</div>
      <div style="font-size:.83rem;color:var(--text-muted)">${scored.length} candidates ranked &bull; matching &#8800; applying</div>
    </div>
    ${premium.length ? matchSection('&#11088; Premium Matches','var(--gold)',premium,job) : ''}
    ${strong.length  ? matchSection('&#128170; Strong Matches','#4ade80',strong,job) : ''}
    ${fit.length     ? matchSection('&#127919; Potential Fits','#93c5fd',fit,job) : ''}
    ${gems.length    ? matchSection('&#128142; Hidden Gems (high skills, unexpected fit)','#c4b5fd',gems,job) : ''}
    ${!scored.length ? emptyHTML('&#129504;','No matches','No seeker profiles to match against yet') : ''}`
}

function matchSection(title, color, items, job) {
  return `<div style="margin-bottom:1.5rem">
    <div style="font-family:var(--mono);font-size:.72rem;letter-spacing:.1em;text-transform:uppercase;color:${color};margin-bottom:.75rem">${title}</div>
    <div class="candidates-grid">${items.map(x => candidateCard(x.s, x.r, job)).join('')}</div>
  </div>`
}

function candidateCard(s, r, job) {
  const waNum = (s.whatsapp||'').replace(/\D/g,'')
  const waMsg = encodeURIComponent(`Hello ${s.full_name||''}, I found your profile on ZimGetHired regarding the ${job?.title||''} role. Are you available to chat?`)
  const waLink = waNum ? `https://wa.me/${waNum}?text=${waMsg}` : null
  const C = 2 * Math.PI * 20
  const offset = C - (r.score/100)*C
  const ringCol = r.score>=90 ? '#D4AF37' : r.score>=75 ? '#4ade80' : r.score>=60 ? '#93c5fd' : '#c4b5fd'

  return `<div class="candidate-card">
    <div class="candidate-header">
      <div class="candidate-avatar">${initials(s.full_name||'?')}</div>
      <div>
        <div class="candidate-name">${esc(s.full_name||'Anonymous')}</div>
        <div class="candidate-role">${esc(s.location||'&#8212;')} &bull; ${esc(s.experience_level||'&#8212;')}</div>
      </div>
      <div class="match-ring">
        <svg width="54" height="54" viewBox="0 0 54 54">
          <circle fill="none" stroke="var(--surface-2)" stroke-width="4" cx="27" cy="27" r="20"/>
          <circle fill="none" stroke="${ringCol}" stroke-width="4" stroke-linecap="round"
            cx="27" cy="27" r="20" transform="rotate(-90 27 27)"
            stroke-dasharray="${C.toFixed(2)}" stroke-dashoffset="${offset.toFixed(2)}"/>
        </svg>
        <div class="match-ring-text" style="color:${ringCol}">${r.score}%</div>
      </div>
    </div>
    <div class="tag-row">${(s.roles||[]).slice(0,3).map(x=>`<span class="skill-tag em">${esc(x)}</span>`).join('')}</div>
    <div class="tag-row">${(s.skills||[]).slice(0,4).map(x=>`<span class="skill-tag">${esc(x)}</span>`).join('')}</div>
    <div class="match-breakdown">
      <div class="match-breakdown-row"><span class="breakdown-label">Role Overlap</span><div class="breakdown-bar-wrap"><div class="breakdown-bar" style="width:${(r.role/40)*100}%"></div></div><span class="breakdown-score">${r.role}/40</span></div>
      <div class="match-breakdown-row"><span class="breakdown-label">Skills</span><div class="breakdown-bar-wrap"><div class="breakdown-bar" style="width:${(r.skill/30)*100}%"></div></div><span class="breakdown-score">${r.skill}/30</span></div>
      <div class="match-breakdown-row"><span class="breakdown-label">Experience</span><div class="breakdown-bar-wrap"><div class="breakdown-bar" style="width:${(r.exp/20)*100}%"></div></div><span class="breakdown-score">${r.exp}/20</span></div>
      <div class="match-breakdown-row"><span class="breakdown-label">Personality</span><div class="breakdown-bar-wrap"><div class="breakdown-bar" style="width:${(r.pers/10)*100}%"></div></div><span class="breakdown-score">${r.pers}/10</span></div>
    </div>
    <div style="display:flex;gap:.5rem;flex-wrap:wrap;margin-top:1rem">
      ${waLink ? `<a class="btn btn-wa btn-sm" href="${waLink}" target="_blank">&#128172; WhatsApp</a>` : ''}
      <button class="btn btn-ghost btn-sm" onclick="viewCandidateDetail('${s.user_id}','')">View Profile</button>
      ${r.isGem ? `<span class="match-score match-gem">&#128142; Hidden Gem</span>` : ''}
    </div>
  </div>`
}

// ─── View full candidate profile ─────────────────────
async function viewCandidateDetail(userId, jobId) {
  const { data: s } = await sb.from('job_seekers').select('*').eq('user_id', userId).single()
  if (!s) { alert('Profile not found'); return }
  const job = jobId ? empJobs.find(j=>j.id===jobId) : null
  const r   = job ? computeMatch(job, s) : null
  const waNum = (s.whatsapp||'').replace(/\D/g,'')
  const waLink = waNum ? `https://wa.me/${waNum}?text=${encodeURIComponent(`Hello ${s.full_name}, I found your profile on ZimGetHired and would like to discuss an opportunity.`)}` : null

  el('candidate-detail-content').innerHTML = `
    <div style="display:flex;align-items:center;gap:1rem;margin-bottom:1.5rem;flex-wrap:wrap">
      <div class="candidate-avatar" style="width:60px;height:60px;font-size:1.3rem">${initials(s.full_name)}</div>
      <div style="flex:1">
        <div style="font-family:var(--serif);font-size:1.3rem;font-weight:700">${esc(s.full_name||'&#8212;')}</div>
        <div style="color:var(--text-muted);font-size:.85rem">${esc(s.location||'&#8212;')} &bull; ${esc(s.experience_level||'&#8212;')}</div>
      </div>
      ${r ? `<div style="text-align:center"><div style="font-family:var(--serif);font-size:2.2rem;color:var(--gold);font-weight:700;line-height:1">${r.score}%</div><div style="font-family:var(--mono);font-size:.62rem;color:var(--text-muted)">MATCH SCORE</div></div>` : ''}
    </div>
    ${s.bio ? `<p style="color:var(--text-muted);font-size:.87rem;line-height:1.7;margin-bottom:1.25rem">${esc(s.bio)}</p>` : ''}
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:1.25rem;margin-bottom:1.25rem">
      <div><div style="font-family:var(--mono);font-size:.65rem;text-transform:uppercase;letter-spacing:.08em;color:var(--gold);margin-bottom:.5rem">Roles</div><div class="tag-row">${(s.roles||[]).map(r2=>`<span class="skill-tag em">${esc(r2)}</span>`).join('')||'&#8212;'}</div></div>
      <div><div style="font-family:var(--mono);font-size:.65rem;text-transform:uppercase;letter-spacing:.08em;color:var(--gold);margin-bottom:.5rem">Skills</div><div class="tag-row">${(s.skills||[]).map(sk=>`<span class="skill-tag">${esc(sk)}</span>`).join('')||'&#8212;'}</div></div>
    </div>
    ${r ? `<div style="background:var(--surface-2);border-radius:var(--radius-sm);padding:1.1rem;margin-bottom:1.25rem">
      <div style="font-family:var(--mono);font-size:.68rem;color:var(--gold);text-transform:uppercase;letter-spacing:.08em;margin-bottom:.75rem">Match Breakdown</div>
      <div class="match-breakdown-row"><span class="breakdown-label">Role Overlap (max 40)</span><div class="breakdown-bar-wrap"><div class="breakdown-bar" style="width:${(r.role/40)*100}%"></div></div><span class="breakdown-score">${r.role}/40</span></div>
      <div class="match-breakdown-row"><span class="breakdown-label">Skills Match (max 30)</span><div class="breakdown-bar-wrap"><div class="breakdown-bar" style="width:${(r.skill/30)*100}%"></div></div><span class="breakdown-score">${r.skill}/30</span></div>
      <div class="match-breakdown-row"><span class="breakdown-label">Experience (max 20)</span><div class="breakdown-bar-wrap"><div class="breakdown-bar" style="width:${(r.exp/20)*100}%"></div></div><span class="breakdown-score">${r.exp}/20</span></div>
      <div class="match-breakdown-row"><span class="breakdown-label">Personality (max 10)</span><div class="breakdown-bar-wrap"><div class="breakdown-bar" style="width:${(r.pers/10)*100}%"></div></div><span class="breakdown-score">${r.pers}/10</span></div>
    </div>` : ''}
    <div style="display:flex;gap:.75rem;flex-wrap:wrap">
      ${waLink ? `<a class="btn btn-wa" href="${waLink}" target="_blank">&#128172; Contact on WhatsApp</a>` : ''}
      ${s.cv_url ? `<a class="btn btn-ghost btn-sm" href="${esc(s.cv_url)}" target="_blank">&#128196; View CV</a>` : ''}
      ${s.video_url ? `<a class="btn btn-ghost btn-sm" href="${esc(s.video_url)}" target="_blank">&#127910; Intro Video</a>` : ''}
    </div>`
  openModal('candidate-modal')
}

// ─── Talent Search ────────────────────────────────────
async function searchTalent() {
  const roleQ = v('ts-role').trim()
  const locQ  = v('ts-location').trim()
  const sklQ  = v('ts-skills').trim()
  const expQ  = v('ts-exp')
  if (!roleQ && !sklQ) { el('talent-search-results').innerHTML = '<div class="empty-state">Enter a role or skills to search</div>'; return }

  el('talent-search-results').innerHTML = '<div class="empty-state"><span class="spinner"></span> Searching talent...</div>'

  const { data: seekers, error } = await sb
    .from('job_seekers')
    .select('user_id,full_name,whatsapp,location,roles,skills,experience_level,bio,personality_type')
  if (error) { el('talent-search-results').innerHTML = `<div class="empty-state">Error: ${esc(error.message)}</div>`; return }

  const synJob = { title: roleQ, primary_role: roleQ, required_skills: sklQ, experience: expQ }
  let results = (seekers||[]).map(s => ({s, r: computeMatch(synJob, s)}))
  if (locQ) results = results.filter(x => !x.s.location || x.s.location.toLowerCase().includes(locQ.toLowerCase()))
  results.sort((a,b) => b.r.score - a.r.score)

  // Log search history locally
  searchHistory.unshift({ts: new Date().toISOString(), role: roleQ, skills: sklQ, exp: expQ, loc: locQ, count: results.length})
  renderSearchHistory()

  // Log to DB (non-blocking)
  sb.from('employer_search_log').insert({
    employer_id: currentProfile.id, search_role: roleQ, search_skills: sklQ,
    search_exp: expQ, search_location: locQ, result_count: results.length
  }).catch(()=>{})

  if (!results.length) { el('talent-search-results').innerHTML = emptyHTML('&#128269;','No candidates found','Try broadening your search criteria'); return }

  el('talent-search-results').innerHTML = `
    <div style="font-family:var(--mono);font-size:.75rem;color:var(--gold);margin-bottom:1rem">${results.length} candidates ranked by AI match score</div>
    <div class="candidates-grid">${results.slice(0,24).map(x => candidateCard(x.s, x.r, synJob)).join('')}</div>`
}

function renderSearchHistory() {
  const el2 = el('emp-search-history')
  if (!el2 || !searchHistory.length) return
  el2.innerHTML = `<div class="table-wrap"><table class="admin-table">
    <thead><tr><th>Time</th><th>Role</th><th>Skills</th><th>Location</th><th>Results</th></tr></thead>
    <tbody>${searchHistory.slice(0,20).map(e=>`<tr>
      <td style="font-family:var(--mono);font-size:.73rem">${fmtDate(e.ts)}</td>
      <td>${esc(e.role||'&#8212;')}</td><td>${esc(e.skills||'&#8212;')}</td>
      <td>${esc(e.loc||'&#8212;')}</td><td>${e.count}</td>
    </tr>`).join('')}</tbody>
  </table></div>`
}

// ═══════════════════════════════════════════════════
// JOB SEEKER DATA
// ═══════════════════════════════════════════════════
async function loadSeekerData() {
  if (!currentProfile) return
  const { data: sp } = await sb.from('job_seekers').select('*').eq('user_id', currentProfile.id).single()
  seekerProfile = sp || null
  if (sp) {
    seekerRoles  = Array.isArray(sp.roles)  ? sp.roles  : []
    seekerSkills = Array.isArray(sp.skills) ? sp.skills : []
    populateSeekerForm(sp)
  } else {
    const fn = el('sk-fullname'); if (fn) fn.value = currentProfile.full_name || ''
  }
  updateProfileCompletion()
  loadSeekerMatches()
  loadSeekerApps()
}

function populateSeekerForm(sp) {
  const set = (id, val) => { const e=el(id); if(e&&val!=null) e.value=val }
  set('sk-fullname',    sp.full_name || currentProfile.full_name || '')
  set('sk-whatsapp',    sp.whatsapp    || '')
  set('sk-location',    sp.location    || '')
  set('sk-exp-level',   sp.experience_level || '')
  set('sk-bio',         sp.bio         || '')
  set('sk-cv-url',      sp.cv_url      || '')
  set('sk-video-url',   sp.video_url   || '')
  set('sk-personality', sp.personality_type || '')
  renderChips('sk-roles-chips',  seekerRoles,  'role')
  renderChips('sk-skills-chips', seekerSkills, 'skill')
}

async function saveProfile() {
  const fullName = v('sk-fullname').trim()
  const whatsapp = v('sk-whatsapp').trim()
  const location = v('sk-location').trim()
  const expLevel = v('sk-exp-level')
  const bio      = v('sk-bio').trim()
  const cvUrl    = v('sk-cv-url').trim()
  const videoUrl = v('sk-video-url').trim()
  const pers     = v('sk-personality')

  setBtn('sk-save-btn', true, 'Saving...')
  await sb.from('users').update({ full_name: fullName }).eq('id', currentProfile.id)

  const payload = {
    user_id: currentProfile.id, full_name: fullName,
    whatsapp: whatsapp||null, location: location||null,
    experience_level: expLevel||null, bio: bio||null,
    cv_url: cvUrl||null, video_url: videoUrl||null,
    personality_type: pers||null, roles: seekerRoles, skills: seekerSkills
  }
  const { error } = await sb.from('job_seekers').upsert(payload, { onConflict: 'user_id' })
  setBtn('sk-save-btn', false, 'Save Profile')
  if (error) { showToast('sk-profile-toast', 'Error: ' + error.message, 'error'); return }
  seekerProfile = payload
  currentProfile.full_name = fullName
  showToast('sk-profile-toast','&#9989; Profile saved!','success')
  updateProfileCompletion()
  loadSeekerMatches()
}

function updateProfileCompletion() {
  const sp = seekerProfile || {}
  const checks = [
    sp.full_name || currentProfile?.full_name,
    sp.whatsapp, sp.location, sp.experience_level, sp.bio,
    (sp.roles||seekerRoles).length>0,
    (sp.skills||seekerSkills).length>0,
    sp.cv_url
  ]
  const done = checks.filter(Boolean).length
  const pct  = Math.round((done/checks.length)*100)
  const bar  = el('sk-progress-bar'); if (bar) bar.style.width = pct+'%'
  const pctEl = el('sk-pct'); if (pctEl) pctEl.textContent = pct+'%'
  const tip = el('sk-progress-tip')
  if (tip) {
    const missing = ['Name','WhatsApp','Location','Experience','Bio','Roles','Skills','CV'].filter((_,i)=>!checks[i])
    tip.textContent = missing.length ? 'Missing: '+missing.join(', ') : '&#127881; Profile complete! You are visible to employers.'
  }
}

async function loadSeekerMatches() {
  const grid = el('sk-matches-grid')
  const top  = el('sk-top-matches')
  if (!grid) return
  grid.innerHTML = '<div class="empty-state"><span class="spinner"></span></div>'

  const seeker = {
    roles: seekerRoles, skills: seekerSkills,
    experience_level: seekerProfile?.experience_level || '',
    personality_type: seekerProfile?.personality_type || ''
  }
  const { data: jobs } = await sb
    .from('posted_jobs')
    .select('id,title,primary_role,required_skills,experience,location,employment,salary_min,salary_max,description,status,urgency_level,expires_at')
    .eq('status', 'active')   // ← status = 'active', not is_live

  if (!jobs?.length) {
    grid.innerHTML = emptyHTML('&#10024;','No active jobs yet','Jobs will appear here once employers post them')
    if (top) top.innerHTML = emptyHTML('&#10024;','No matches yet','Complete your profile to get matched')
    return
  }

  const scored = jobs.map(j => ({j, r: computeMatch(j, seeker)})).sort((a,b) => b.r.score - a.r.score)
  setText('sk-stat-matches', scored.length)
  setText('sk-stat-top', scored[0]?.r.score+'%' || '&#8212;')

  grid.innerHTML = scored.map(({j, r}) => {
    const sal = fmtSal(j.salary_min, j.salary_max)
    return `<div class="job-card">
      <div class="job-card-header">
        <div class="job-title">${esc(j.title)}</div>
        <span class="match-score ${matchClass(r.label)}">${r.score}%</span>
      </div>
      <div style="font-family:var(--mono);font-size:.65rem;color:var(--gold);margin-bottom:.6rem">${r.label}</div>
      <div class="job-meta">
        ${j.location   ? `<span class="meta-chip loc">&#128205; ${esc(j.location)}</span>` : ''}
        ${j.employment ? `<span class="meta-chip">${esc(j.employment)}</span>` : ''}
        ${sal          ? `<span class="meta-chip sal">${sal}</span>` : ''}
      </div>
      <div class="match-breakdown" style="margin-top:.75rem">
        <div class="match-breakdown-row"><span class="breakdown-label">Role</span><div class="breakdown-bar-wrap"><div class="breakdown-bar" style="width:${(r.role/40)*100}%"></div></div><span class="breakdown-score">${r.role}/40</span></div>
        <div class="match-breakdown-row"><span class="breakdown-label">Skills</span><div class="breakdown-bar-wrap"><div class="breakdown-bar" style="width:${(r.skill/30)*100}%"></div></div><span class="breakdown-score">${r.skill}/30</span></div>
        <div class="match-breakdown-row"><span class="breakdown-label">Experience</span><div class="breakdown-bar-wrap"><div class="breakdown-bar" style="width:${(r.exp/20)*100}%"></div></div><span class="breakdown-score">${r.exp}/20</span></div>
      </div>
      <div class="job-actions" style="margin-top:.85rem">
        <button class="btn btn-em btn-sm" onclick="applyToJob('${j.id}')">Apply Now</button>
        <button class="btn btn-ghost btn-sm" onclick="openJobDetail('${j.id}')">Details</button>
      </div>
    </div>`
  }).join('')

  if (top) top.innerHTML = scored.slice(0,3).map(({j,r}) => `
    <div style="display:flex;align-items:center;gap:1rem;padding:.85rem;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-sm);margin-bottom:.65rem">
      <div style="flex:1"><div style="font-family:var(--serif);font-size:.95rem;font-weight:600">${esc(j.title)}</div><div style="font-size:.78rem;color:var(--text-muted)">${esc(j.location||'&#8212;')}</div></div>
      <span class="match-score ${matchClass(r.label)}">${r.score}%</span>
      <button class="btn btn-em btn-xs" onclick="applyToJob('${j.id}')">Apply</button>
    </div>`).join('')
}

async function loadSeekerApps() {
  const el2 = el('sk-apps-list')
  if (!el2) return
  const { data: apps } = await sb
    .from('applications')
    .select('id,job_id,created_at,posted_jobs(title,location,status)')
    .order('created_at', { ascending: false })

  setText('sk-stat-apps', apps?.length || 0)
  if (!apps?.length) { el2.innerHTML = emptyHTML('&#128221;','No applications yet','Apply to jobs from Matched Jobs or the Job Board'); return }

  el2.innerHTML = `<div class="table-wrap"><table class="admin-table">
    <thead><tr><th>Job Title</th><th>Location</th><th>Job Status</th><th>Applied</th></tr></thead>
    <tbody>${apps.map(a => {
      const j = a.posted_jobs || {}
      const sc = j.status==='active' ? 'badge-active' : 'badge-closed'
      return `<tr>
        <td style="font-weight:500">${esc(j.title||'&#8212;')}</td>
        <td>${esc(j.location||'&#8212;')}</td>
        <td><span class="job-badge ${sc}">${esc(j.status||'&#8212;')}</span></td>
        <td style="font-family:var(--mono);font-size:.73rem">${fmtDate(a.created_at)}</td>
      </tr>`
    }).join('')}</tbody>
  </table></div>`
}

async function applyToJob(jobId) {
  if (!currentProfile) return openAuth('login')
  if (currentProfile.role !== 'jobseeker') return alert('Only job seekers can apply.')
  const { error } = await sb.from('applications').insert({
    job_id: jobId,
    applicant_user_id: currentProfile.id   // RLS WITH CHECK: applicant_user_id = auth.uid()
  })
  if (error) {
    if (error.code === '23505') return alert('You have already applied for this position.')
    return alert('Error: ' + error.message)
  }
  alert('&#9989; Application submitted!')
  loadSeekerApps()
}

// ─── Profile chips ────────────────────────────────────
function addRoleChip() {
  const i = el('sk-role-input'); const val = i.value.trim()
  if (!val || seekerRoles.includes(val)) { i.value=''; return }
  seekerRoles.push(val); i.value=''; renderChips('sk-roles-chips', seekerRoles, 'role')
}
function addSkillChip() {
  const i = el('sk-skill-input'); const val = i.value.trim()
  if (!val || seekerSkills.includes(val)) { i.value=''; return }
  seekerSkills.push(val); i.value=''; renderChips('sk-skills-chips', seekerSkills, 'skill')
}
function removeChip(type, val) {
  if (type==='role')  { seekerRoles  = seekerRoles.filter(r=>r!==val);  renderChips('sk-roles-chips',  seekerRoles,  'role') }
  if (type==='skill') { seekerSkills = seekerSkills.filter(s=>s!==val); renderChips('sk-skills-chips', seekerSkills, 'skill') }
}
function renderChips(elId, arr, type) {
  const c = el(elId); if (!c) return
  c.innerHTML = arr.map(v2 => `<div class="chip-removable">${esc(v2)}<span class="chip-remove" onclick="removeChip('${type}','${esc(v2)}')">&#10005;</span></div>`).join('')
}

// ═══════════════════════════════════════════════════
// ADMIN DATA
// ═══════════════════════════════════════════════════
async function loadAdminData() {
  const [ur, jr, ar] = await Promise.all([
    sb.from('users').select('id,full_name,email,role,created_at').order('created_at',{ascending:false}),
    sb.from('posted_jobs').select('id,title,primary_role,status,location,created_at').order('created_at',{ascending:false}),
    sb.from('applications').select('id,job_id,applicant_user_id,created_at').order('created_at',{ascending:false})
  ])
  const users = ur.data||[], jobs = jr.data||[], apps = ar.data||[]
  const seekers = users.filter(u=>u.role==='jobseeker')
  const employers = users.filter(u=>u.role==='employer')
  const active = jobs.filter(j=>j.status==='active')

  setText('ad-users',    users.length)
  setText('ad-seekers',  seekers.length)
  setText('ad-employers',employers.length)
  setText('ad-jobs',     jobs.length)
  setText('ad-active',   active.length)
  setText('ad-apps',     apps.length)
  updateLiveStats(users.length, seekers.length, employers.length, jobs.length, active.length, apps.length)

  const tbl = (id, head, rows) => {
    const w = el(id); if(!w) return
    w.innerHTML = `<table class="admin-table"><thead><tr>${head.map(h=>`<th>${h}</th>`).join('')}</tr></thead><tbody>${rows}</tbody></table>`
  }
  tbl('admin-users-wrap',['Name','Email','Role','Joined'],
    users.map(u=>`<tr><td>${esc(u.full_name||'&#8212;')}</td><td style="font-family:var(--mono);font-size:.73rem">${esc(u.email)}</td><td><span class="job-badge ${u.role==='employer'?'badge-active':'badge-draft'}">${esc(u.role)}</span></td><td style="font-family:var(--mono);font-size:.73rem">${fmtDate(u.created_at)}</td></tr>`).join(''))
  tbl('admin-jobs-wrap',['Title','Primary Role','Location','Status','Posted'],
    jobs.map(j=>`<tr><td>${esc(j.title||'&#8212;')}</td><td>${esc(j.primary_role||'&#8212;')}</td><td>${esc(j.location||'&#8212;')}</td><td><span class="job-badge ${j.status==='active'?'badge-active':j.status==='draft'?'badge-draft':'badge-closed'}">${esc(j.status)}</span></td><td style="font-family:var(--mono);font-size:.73rem">${fmtDate(j.created_at)}</td></tr>`).join(''))
  tbl('admin-apps-wrap',['Applicant ID','Job ID','Applied'],
    apps.map(a=>`<tr><td style="font-family:var(--mono);font-size:.73rem">${a.applicant_user_id?.slice(0,12)}&#8230;</td><td style="font-family:var(--mono);font-size:.73rem">${a.job_id?.slice(0,12)}&#8230;</td><td style="font-family:var(--mono);font-size:.73rem">${fmtDate(a.created_at)}</td></tr>`).join(''))

  const { data: logs } = await sb.from('employer_search_log').select('*').order('created_at',{ascending:false}).limit(50)
  const lw = el('admin-logs-wrap')
  if (lw && logs?.length) {
    lw.innerHTML = `<table class="admin-table"><thead><tr><th>Employer</th><th>Role</th><th>Skills</th><th>Location</th><th>Results</th><th>Time</th></tr></thead><tbody>${logs.map(l=>`<tr><td style="font-family:var(--mono);font-size:.73rem">${l.employer_id?.slice(0,10)}&#8230;</td><td>${esc(l.search_role||'&#8212;')}</td><td>${esc(l.search_skills||'&#8212;')}</td><td>${esc(l.search_location||'&#8212;')}</td><td>${l.result_count??'&#8212;'}</td><td style="font-family:var(--mono);font-size:.73rem">${fmtDate(l.created_at)}</td></tr>`).join('')}</tbody></table>`
  } else if (lw) {
    lw.innerHTML = emptyHTML('&#128269;','No search logs yet','Employer searches will be logged here')
  }
}

// ═══════════════════════════════════════════════════
// PUBLIC JOB BOARD
// ═══════════════════════════════════════════════════
async function loadPublicJobs() {
  const { data, error } = await sb
    .from('posted_jobs')
    .select('id,title,primary_role,required_skills,experience,location,employment,salary_min,salary_max,description,status,urgency_level,expires_at,created_at')
    .eq('status', 'active')    // status = 'active', ENUM enforced
    .order('created_at', { ascending: false })
  if (error) { console.error('[PublicJobs]', error.message); return }
  allPublicJobs = data || []
  renderPublicJobs(allPublicJobs)
}

function filterPublicJobs() {
  const q   = v('pub-search').toLowerCase()
  const loc = v('pub-location')
  const emp = v('pub-employment')
  renderPublicJobs(allPublicJobs.filter(j => {
    const txt = `${j.title} ${j.primary_role} ${j.required_skills} ${j.description}`.toLowerCase()
    return (!q||txt.includes(q)) && (!loc||(j.location||'').includes(loc)) && (!emp||j.employment===emp)
  }))
}

function renderPublicJobs(jobs) {
  const grid = el('public-jobs-grid'); if (!grid) return
  if (!jobs.length) { grid.innerHTML = emptyHTML('&#128269;','No jobs found','Try adjusting your search filters'); return }
  grid.innerHTML = `<div class="jobs-grid">${jobs.map(j => buildJobCard(j, false)).join('')}</div>`
}

async function openJobDetail(jobId) {
  const job = allPublicJobs.find(j=>j.id===jobId) || empJobs.find(j=>j.id===jobId)
  if (!job) return
  const sal = fmtSal(job.salary_min, job.salary_max)
  el('job-detail-content').innerHTML = `
    <div style="margin-bottom:1.5rem">
      <div style="font-family:var(--serif);font-size:1.5rem;font-weight:700;margin-bottom:.5rem">${esc(job.title)}</div>
      <div class="job-meta">
        ${job.location   ? `<span class="meta-chip loc">&#128205; ${esc(job.location)}</span>` : ''}
        ${job.employment ? `<span class="meta-chip">${esc(job.employment)}</span>` : ''}
        ${sal            ? `<span class="meta-chip sal">${sal}</span>` : ''}
        ${job.experience ? `<span class="meta-chip">${esc(job.experience)}</span>` : ''}
      </div>
    </div>
    ${job.description ? `<p style="color:var(--text-2);font-size:.9rem;line-height:1.75;margin-bottom:1.5rem">${esc(job.description)}</p>` : ''}
    ${job.required_skills ? `<div style="margin-bottom:1.25rem"><div style="font-family:var(--mono);font-size:.65rem;text-transform:uppercase;letter-spacing:.08em;color:var(--gold);margin-bottom:.5rem">Required Skills</div><div class="skill-tags">${csvSplit(job.required_skills).map(s=>`<span class="skill-tag em">${esc(s)}</span>`).join('')}</div></div>` : ''}
    ${job.expires_at ? `<div style="font-family:var(--mono);font-size:.75rem;color:var(--text-muted);margin-bottom:1.25rem">Applications close: ${fmtDate(job.expires_at)}</div>` : ''}
    <div style="display:flex;gap:.75rem;flex-wrap:wrap">
      ${currentProfile?.role==='jobseeker' ? `<button class="btn btn-gold" onclick="applyToJob('${job.id}');closeModal('job-detail-modal')">Apply Now &#8594;</button>` : `<button class="btn btn-em" onclick="openAuth('login')">Sign In to Apply</button>`}
    </div>`
  openModal('job-detail-modal')
}

// ═══════════════════════════════════════════════════
// LIVE STATS
// ═══════════════════════════════════════════════════
async function loadPublicStats() {
  const [ur, jr, ar] = await Promise.all([
    sb.from('users').select('id,role'),
    sb.from('posted_jobs').select('id,status'),
    sb.from('applications').select('id')
  ])
  const users = ur.data||[], jobs = jr.data||[], apps = ar.data||[]
  const seekers  = users.filter(u=>u.role==='jobseeker').length
  const employers= users.filter(u=>u.role==='employer').length
  const active   = jobs.filter(j=>j.status==='active').length
  updateLiveStats(users.length, seekers, employers, jobs.length, active, apps.length)
}

function updateLiveStats(total, seekers, employers, allJ, activeJ, apps) {
  const fmt = n => n>=1000 ? (n/1000).toFixed(1)+'K' : String(n)
  const set2 = (id, val) => { const e=el(id); if(e) e.textContent=fmt(val) }
  set2('hero-stat-jobs',     activeJ)
  set2('hero-stat-seekers',  seekers)
  set2('hero-stat-employers',employers)
  set2('sb-jobs',            activeJ)
  set2('sb-seekers',         seekers)
  set2('sb-employers',       employers)
  set2('sb-applications',    apps)
  const tk = (id,v2) => { const e=el(id); if(e) e.textContent=fmt(v2) }
  tk('tk-jobs',  activeJ); tk('tk-jobs2',  activeJ)
  tk('tk-talent',seekers); tk('tk-talent2',seekers)
}

// ═══════════════════════════════════════════════════
// UI HELPERS
// ═══════════════════════════════════════════════════
function showPublic() {
  el('public-area').style.display   = 'block'
  el('dashboard-area').style.display= 'none'
  el('main-footer').style.display   = 'block'
  el('vjf-badge') && (el('vjf-badge').style.display='flex')
  el('ticker-wrap').style.display   = 'block'
  loadPublicJobs()
  loadPublicStats()
}
function showDashboard() {
  el('public-area').style.display   = 'none'
  el('dashboard-area').style.display= 'block'
  el('main-footer').style.display   = 'none'
  el('vjf-badge') && (el('vjf-badge').style.display='none')
}
function updateNavAuth(loggedIn) {
  const show = id => { const e=el(id); if(e) e.classList.remove('hidden') }
  const hide = id => { const e=el(id); if(e) e.classList.add('hidden') }
  if (loggedIn) { hide('nav-login-btn'); hide('nav-signup-btn'); show('nav-dash-btn'); show('nav-logout-btn') }
  else          { show('nav-login-btn'); show('nav-signup-btn'); hide('nav-dash-btn'); hide('nav-logout-btn') }
}
function openAuth(tab)  { openModal('auth-modal'); switchAuthTab(tab) }
function switchAuthTab(tab) {
  el('auth-modal-login').classList.toggle('hidden',  tab!=='login')
  el('auth-modal-signup').classList.toggle('hidden', tab!=='signup')
}
function openModal(id)  { el(id).classList.add('open') }
function closeModal(id) { el(id).classList.remove('open') }
function scrollTo2(id)  { const e=el(id); if(e) e.scrollIntoView({behavior:'smooth',block:'start'}) }

let dataSaverOn=false
function toggleDataSaver() {
  dataSaverOn=!dataSaverOn
  el('ds-pill').classList.toggle('on',dataSaverOn)
  el('ticker-wrap').style.display = dataSaverOn ? 'none' : 'block'
  document.body.style.backgroundImage = dataSaverOn ? 'none' : ''
}

document.querySelectorAll('.modal-overlay').forEach(o => {
  o.addEventListener('click', e => { if(e.target===o) o.classList.remove('open') })
})

// ─── Utilities ────────────────────────────────────────
const el     = id => document.getElementById(id)
const v      = id => { const e=el(id); return e?e.value:'' }
const setText = (id,val) => { const e=el(id); if(e) e.textContent=val }

function initials(name) {
  return (name||'?').split(' ').filter(Boolean).map(w=>w[0]).join('').toUpperCase().slice(0,2)
}
function fmtDate(ts) {
  if (!ts) return '&#8212;'
  return new Date(ts).toLocaleDateString('en-GB',{year:'numeric',month:'short',day:'numeric'})
}
function fmtSal(min,max) {
  if (!min&&!max) return ''
  const f=n=>'$'+Number(n).toLocaleString()
  if (min&&max) return f(min)+'&#8211;'+f(max)
  return min?'From '+f(min):'Up to '+f(max)
}
function esc(s) {
  if (s==null) return ''
  return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#39;')
}
function emptyHTML(icon,title,sub) {
  return `<div class="empty-state"><span class="empty-icon">${icon}</span><div class="empty-title">${title}</div><div class="empty-sub">${sub}</div></div>`
}
function showToast(id,msg,type) {
  const e=el(id); if(!e) return
  e.innerHTML=msg; e.className=`toast show ${type}`
  setTimeout(()=>{e.classList.remove('show')},5000)
}
function setBtn(id,disabled,label) {
  const b=el(id); if(!b) return
  b.disabled=disabled
  b.innerHTML=disabled?`<span class="spinner"></span> ${label}`:label
}

// ─── INIT ─────────────────────────────────────────────
loadPublicJobs()
loadPublicStats()
</script>
</body>
</html>